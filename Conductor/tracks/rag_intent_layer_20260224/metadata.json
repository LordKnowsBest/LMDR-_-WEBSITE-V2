{
  "track_id": "rag_intent_layer_20260224",
  "title": "RAG + Intent-Based Agent Intelligence — Knowledge-Augmented Reasoning for All Roles",
  "type": "feature",
  "status": "in_progress",
  "created": "2026-02-24",
  "updated": "2026-02-24",
  "priority": "high",
  "estimated_phases": 5,
  "completed_phases": 4,
  "completion_percentage": 80,
  "dependencies": [
    "ai_intelligence_layer_20260219",
    "agentic_orchestration_20260218",
    "full_agentic_buildout_20260218",
    "semantic_search_polling_20260222",
    "agentService.jsw",
    "agentRuntimeService.jsw",
    "semanticSearchService.jsw",
    "aiRouterService.jsw",
    "services/ai-intelligence/ (Railway microservice)"
  ],
  "owners": [],
  "tags": [
    "rag",
    "intent-classification",
    "knowledge-base",
    "vector-search",
    "pinecone",
    "voyage-ai",
    "agent-intelligence",
    "multi-role",
    "trucking",
    "cdl-recruitment",
    "ai-native",
    "intelligence-flywheel",
    "context-injection",
    "groq",
    "carrier-intel",
    "driver-market"
  ],
  "business_impact": {
    "type": "platform_differentiation_and_agent_quality",
    "description": "Transform LMDR from a matching platform into the most AI-native CDL recruitment intelligence layer in the industry. Intent-aware RAG ensures every agent response is grounded in verified, fresh knowledge — carrier driver sentiment, market pay data, regulatory facts, lane economics, and each user's own history — scoped precisely to what each role needs at the moment they need it. This is the infrastructure that makes LMDR's data network effects compounding: every interaction adds signal, every signal improves the next response."
  },
  "strategic_context": "CDL driver recruitment is an $800-900B industry underserved by intelligence. LMDR's differentiation is not just matching — it is the intelligence layer: knowing what drivers actually want, what carriers actually offer, what the market really pays, why placements succeed, and why they fail. RAG is the mechanism that grounds every agent response in that accumulated reality instead of hallucinated generalities. The intent layer is what makes retrieval precise: not 'what words match' but 'what does this person actually need to know right now.' This track is the intelligence flywheel that compounds with every user on the platform.",
  "architecture_constraint": "All heavy compute (embedding, retrieval, intent classification) runs in the existing Railway microservice (services/ai-intelligence/). Wix Velo remains orchestration and auth only — it fires short fetch() calls with AbortController timeouts. Intent classification and RAG retrieval are collapsed into the existing /v1/agent/turn call via an optional ragConfig param to avoid adding round trips. Knowledge namespaces use a single Pinecone index (lmdr-knowledge) with namespace isolation plus a separate lmdr-memory index for per-user conversation memory.",
  "phases": {
    "1": {
      "name": "Knowledge Base Architecture & Corpus Construction",
      "priority": "yes",
      "framework": "Pinecone namespaces + Airtable-sourced ingestion pipeline",
      "description": "Define the six knowledge namespaces, build ingestion pipelines sourced from existing Airtable data, and add /v1/rag/ingest and /v1/rag/retrieve to the Railway microservice. Seed all namespaces from current platform data."
    },
    "2": {
      "name": "Intent Classification Service",
      "priority": "yes",
      "framework": "Groq llama-3.3-70b fast classification + role-scoped intent taxonomy",
      "description": "Build a sub-150ms intent classifier at /v1/intent/classify. Intent output drives namespace selection, tool priority ordering, and response framing. Falls back gracefully to general_inquiry class. Wix wrapper in intentService.jsw."
    },
    "3": {
      "name": "RAG Retrieval Integration — Extend /v1/agent/turn",
      "priority": "yes",
      "framework": "Voyage AI voyage-3 + Pinecone namespace-scoped retrieval inline in agent turn",
      "description": "Extend /v1/agent/turn to accept an optional ragConfig param. When present, Railway runs retrieval internally before calling Claude — no extra Wix round trip. Retrieved context injected as a structured <knowledge_context> block prepended to the system prompt."
    },
    "4": {
      "name": "Agent Injection Layer — Wire Intent + RAG into All Four Roles",
      "priority": "yes",
      "framework": "agentService.jsw pre-flight + role-scoped system prompt construction",
      "description": "Wire intent classification and RAG retrieval into handleAgentTurn() for all four roles. Each role gets structured system prompt templates with injected slots for intent context, knowledge context, and user context. Context budget manager prevents overflow. Tool priority injection based on intent hints."
    },
    "5": {
      "name": "Knowledge Freshness, Feedback Loop & Admin Analytics",
      "priority": "yes",
      "framework": "Airtable ragDocuments + freshness monitor jobs + admin observability extension",
      "description": "Implement per-namespace TTL-based freshness monitoring with re-ingestion jobs. Track retrieval quality (citation rate, continuation rate, downstream conversion). Surface RAG analytics in the admin observability dashboard. Establish the intelligence flywheel as a trackable platform metric."
    }
  },
  "knowledge_namespaces": {
    "carrier_intel": {
      "pinecone_index": "lmdr-knowledge",
      "pinecone_namespace": "carrier_intel",
      "access_roles": ["driver", "recruiter", "admin", "carrier", "b2b"],
      "primary_source": "carrierEnrichments + carrierSafetyData (Airtable)",
      "ttl_hours": 168
    },
    "driver_market": {
      "pinecone_index": "lmdr-knowledge",
      "pinecone_namespace": "driver_market",
      "access_roles": ["driver", "recruiter", "admin", "carrier"],
      "primary_source": "driverProfiles aggregate — anonymized, never individual PII",
      "ttl_hours": 24
    },
    "platform_ops": {
      "pinecone_index": "lmdr-knowledge",
      "pinecone_namespace": "platform_ops",
      "access_roles": ["driver", "recruiter", "admin", "carrier"],
      "primary_source": "CLAUDE.md, .claude/docs/, FAQ content",
      "ttl_hours": 720
    },
    "industry_regs": {
      "pinecone_index": "lmdr-knowledge",
      "pinecone_namespace": "industry_regs",
      "access_roles": ["driver", "recruiter"],
      "primary_source": "FMCSA public corpus — CDL handbook, HOS rules, endorsements, ELD, Clearinghouse",
      "ttl_hours": 2160
    },
    "lane_market": {
      "pinecone_index": "lmdr-knowledge",
      "pinecone_namespace": "lane_market",
      "access_roles": ["driver", "recruiter", "admin", "carrier"],
      "primary_source": "VelocityMatch DataLake (appt00rHHBOiKx9xl) — fuel prices, DAT rates, freight indices",
      "ttl_hours": 6
    },
    "conversation_memory": {
      "pinecone_index": "lmdr-memory",
      "pinecone_namespace": "per-user (metadata filter: user_id)",
      "access_roles": ["driver", "recruiter", "carrier"],
      "primary_source": "agentTurns — summarized, per-user rolling 90-day window",
      "ttl_hours": 2160,
      "security_note": "CRITICAL: metadata filter user_id is ALWAYS required. Cross-user retrieval is a P0 security bug."
    }
  },
  "new_airtable_collections": [
    { "config_key": "ragDocuments", "table": "v2_RAG Documents", "purpose": "Registry of all indexed documents with freshness metadata" },
    { "config_key": "ragRetrievalLog", "table": "v2_RAG Retrieval Log", "purpose": "Every retrieval event: query, chunks returned, scores, latency, citation telemetry" },
    { "config_key": "ragAnalytics", "table": "v2_RAG Analytics", "purpose": "Weekly rollups of RAG performance — citation rate, freshness %, latency trends" },
    { "config_key": "intentClassificationLog", "table": "v2_Intent Classification Log", "purpose": "Every intent classification for accuracy monitoring and taxonomy refinement" }
  ],
  "new_wix_backend_files": [
    "src/backend/intentService.jsw",
    "src/backend/ragService.jsw",
    "src/backend/ragIngestionService.jsw",
    "src/backend/ragFreshnessJob.jsw"
  ],
  "modified_wix_backend_files": [
    "src/backend/agentService.jsw",
    "src/backend/configData.js",
    "src/backend/jobs.config"
  ],
  "new_railway_files": [
    "services/ai-intelligence/routes/intent.js",
    "services/ai-intelligence/routes/rag.js",
    "services/ai-intelligence/lib/intentClassifier.js",
    "services/ai-intelligence/lib/retrieval.js",
    "services/ai-intelligence/lib/knowledgeCorpus.js",
    "services/ai-intelligence/lib/contextBudget.js"
  ],
  "modified_railway_files": [
    "services/ai-intelligence/routes/agent.js",
    "services/ai-intelligence/routes/health.js",
    "services/ai-intelligence/server.js"
  ],
  "metrics": {
    "target_intent_classification_latency": "< 150ms P95",
    "target_rag_retrieval_latency": "< 200ms P95 (within agent turn 25s budget)",
    "target_context_relevance_score": "> 0.75 cosine similarity for top retrieved chunk vs. user query",
    "target_agent_grounding_rate": "> 60% of agent responses reference retrieved context (30-day target)",
    "target_knowledge_freshness": "< 5% stale documents per namespace at any time",
    "target_hallucination_reduction": "Measurable reduction in factually incorrect carrier data in agent responses vs. pre-RAG baseline"
  },
  "feature_flags": [
    "ragEnabled",
    "ragEnabledDriver",
    "ragEnabledRecruiter",
    "ragEnabledAdmin",
    "ragEnabledCarrier",
    "intentClassificationEnabled",
    "conversationMemoryEnabled"
  ],
  "verification_run": null
}
