<!DOCTYPE html>
<html lang="en" class="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Competitor Intel - VelocityMatch</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"
    crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
    rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'sans-serif'] },
          colors: {
            lmdr: { blue: '#2563eb', dark: '#0f172a', yellow: '#fbbf24', canvas: '#f1f5f9' }
          }
        }
      }
    }
  </script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
    }

    .thin-scroll::-webkit-scrollbar {
      width: 6px;
    }

    .thin-scroll::-webkit-scrollbar-thumb {
      background-color: rgba(156, 163, 175, 0.5);
      border-radius: 4px;
    }

    .card-shadow {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    /* Pay scale slider styles */
    .pay-scale-container {
      position: relative;
      height: 60px;
      margin-top: 20px;
    }

    .pay-scale-line {
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 4px;
      bg-slate-200;
      border-radius: 2px;
      transform: translateY(-50%);
    }

    .pay-scale-marker {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 4px;
      height: 16px;
      background: #cbd5e1;
    }

    .pay-scale-label {
      position: absolute;
      top: 100%;
      transform: translateX(-50%);
      font-size: 10px;
      color: #64748b;
      margin-top: 8px;
    }

    .your-position {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .your-dot {
      width: 16px;
      height: 16px;
      background: #2563eb;
      border: 3px solid white;
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(37, 99, 235, 0.3);
    }

    .your-label {
      background: #2563eb;
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 700;
      margin-bottom: 4px;
      white-space: nowrap;
    }
  </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/recruiter/recruiter-design-system.css">
</head>

<body class="bg-slate-50 text-slate-800 h-screen flex overflow-hidden pt-safe pb-safe">

  <!-- MAIN CONTENT -->
  <div class="flex-1 flex flex-col h-full overflow-hidden">

    <!-- HEADER -->
    <header class="bg-white border-b border-slate-200 h-16 flex-none flex justify-between items-center px-6 z-20">
      <div class="flex items-center gap-4">
        <h1 class="font-bold text-slate-900 text-lg">Competitor Intelligence</h1>
      </div>

      <div class="flex items-center gap-4">
        <button onclick="openAddIntelModal()"
          class="bg-slate-900 text-white px-4 py-2 rounded-lg text-xs font-bold hover:bg-slate-800 transition">
          <i class="fa-solid fa-plus mr-2"></i>Add Intel
        </button>

        <select id="regionFilter" onchange="fetchData()"
          class="bg-slate-50 border border-slate-200 text-slate-700 text-base md:text-sm rounded-lg px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
          <option value="Southeast">Southeast</option>
          <option value="Northeast">Northeast</option>
          <option value="Midwest">Midwest</option>
          <option value="West">West</option>
          <option value="National">National</option>
        </select>

        <select id="jobTypeFilter" onchange="fetchData()"
          class="bg-slate-50 border border-slate-200 text-slate-700 text-base md:text-sm rounded-lg px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
          <option value="OTR">OTR</option>
          <option value="Regional">Regional</option>
          <option value="Local">Local</option>
        </select>
      </div>
    </header>

    <!-- CONTENT SCROLL AREA -->
    <main class="flex-1 overflow-y-auto thin-scroll p-6 bg-slate-50">

      <!-- LOADING STATE -->
      <div id="loading" class="hidden fixed inset-0 bg-white/50 backdrop-blur-sm flex items-center justify-center z-50">
        <div class="w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
      </div>

      <!-- PAY BENCHMARKS -->
      <div class="bg-white p-6 rounded-xl card-shadow border border-slate-100 mb-6">
        <div class="flex justify-between items-center mb-6">
          <div>
            <h3 class="font-bold text-slate-800 text-lg">Market Pay Benchmarks (CPM)</h3>
            <p class="text-xs text-slate-500">Based on <span id="sample-size">--</span> active listings in selected
              region</p>
          </div>
          <div class="text-right">
            <p class="text-xs font-bold text-slate-400 uppercase">Your Position</p>
            <p class="text-xl font-black text-blue-600" id="percentile-text">-- percentile</p>
          </div>
        </div>

        <!-- Pay Scale Visualization -->
        <div class="relative h-24 mx-4">
          <!-- Track -->
          <div class="absolute top-1/2 left-0 right-0 h-3 bg-slate-100 rounded-full transform -translate-y-1/2"></div>

          <!-- Range Fill (p25 to p75) -->
          <div id="range-fill" class="absolute top-1/2 h-3 bg-blue-100 transform -translate-y-1/2"></div>

          <!-- Markers -->
          <div id="marker-min" class="absolute top-1/2 w-0.5 h-6 bg-slate-300 transform -translate-y-1/2">
            <span class="absolute top-8 left-1/2 -translate-x-1/2 text-xs font-bold text-slate-400"
              id="label-min">$0.45</span>
          </div>
          <div id="marker-avg" class="absolute top-1/2 w-0.5 h-8 bg-slate-400 transform -translate-y-1/2">
            <span class="absolute -top-6 left-1/2 -translate-x-1/2 text-xs font-bold text-slate-500">AVG</span>
            <span class="absolute top-8 left-1/2 -translate-x-1/2 text-xs font-bold text-slate-600"
              id="label-avg">$0.58</span>
          </div>
          <div id="marker-max" class="absolute top-1/2 w-0.5 h-6 bg-slate-300 transform -translate-y-1/2">
            <span class="absolute top-8 left-1/2 -translate-x-1/2 text-xs font-bold text-slate-400"
              id="label-max">$0.72</span>
          </div>

          <!-- Your Position Dot -->
          <div id="your-dot"
            class="absolute top-1/2 transform -translate-y-1/2 -translate-x-1/2 flex flex-col items-center z-10 transition-all duration-500">
            <div
              class="bg-blue-600 text-white text-[10px] font-bold px-2 py-0.5 rounded mb-1 shadow-sm whitespace-nowrap">
              YOU</div>
            <div class="w-4 h-4 bg-blue-600 border-2 border-white rounded-full shadow-md"></div>
            <span class="text-xs font-bold text-blue-700 mt-1" id="label-you">$0.60</span>
          </div>
        </div>
      </div>

      <!-- COMPETITOR COMPARISON TABLE -->
      <div class="bg-white rounded-xl card-shadow border border-slate-100 overflow-hidden">
        <div class="p-6 border-b border-slate-100 flex justify-between items-center">
          <h3 class="font-bold text-slate-800">Competitor Offers</h3>
          <button class="text-xs font-bold text-blue-600 hover:text-blue-700">View All</button>
        </div>
        <div class="overflow-x-auto">
          <table class="w-full text-left text-sm">
            <thead class="bg-slate-50 text-slate-500 font-medium uppercase text-xs">
              <tr>
                <th class="px-6 py-4">Carrier</th>
                <th class="px-6 py-4">CPM Range</th>
                <th class="px-6 py-4">Sign-On</th>
                <th class="px-6 py-4">Home Time</th>
                <th class="px-6 py-4">Benefits</th>
                <th class="px-6 py-4 text-center">Verified</th>
              </tr>
            </thead>
            <tbody id="competitor-table-body" class="divide-y divide-slate-100">
              <!-- Rendered by JS -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- RECENT CHANGES ALERTS -->
      <div class="mt-6 bg-white p-6 rounded-xl card-shadow border border-slate-100">
        <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
          <i class="fa-solid fa-bell text-amber-500"></i> Market Alerts
        </h3>
        <div class="space-y-3">
          <div class="p-3 bg-amber-50 border border-amber-100 rounded-lg flex gap-3">
            <i class="fa-solid fa-arrow-trend-up text-amber-600 mt-1"></i>
            <div>
              <p class="text-sm font-bold text-slate-800">Schneider increased sign-on bonus</p>
              <p class="text-xs text-slate-600">Bonus raised from $5,000 to $7,500 for OTR routes in Southeast.</p>
              <p class="text-[10px] text-slate-400 mt-1">Detected today</p>
            </div>
          </div>
          <div class="p-3 bg-blue-50 border border-blue-100 rounded-lg flex gap-3">
            <i class="fa-solid fa-circle-info text-blue-600 mt-1"></i>
            <div>
              <p class="text-sm font-bold text-slate-800">New dedicated lane detected</p>
              <p class="text-xs text-slate-600">Werner advertising new dedicated routes with 70 CPM.</p>
              <p class="text-[10px] text-slate-400 mt-1">Detected 2 days ago</p>
            </div>
          </div>
        </div>
      </div>

    </main>
  </div>

  <!-- ADD INTEL MODAL -->
  <div id="addIntelModal"
    class="hidden fixed inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-center justify-center">
    <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-hidden">
      <div class="p-4 border-b border-slate-100 flex justify-between items-center">
        <h3 class="font-bold text-lg">Add Competitor Intel</h3>
        <button onclick="closeAddIntelModal()" class="text-slate-400 hover:text-slate-600"><i
            class="fa-solid fa-times"></i></button>
      </div>
      <div class="p-6 space-y-4 max-h-[70vh] overflow-y-auto">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Competitor Name</label>
            <input type="text" id="intel-name"
              class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-base md:text-sm">
          </div>
          <div>
            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Region</label>
            <select id="intel-region"
              class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-base md:text-sm">
              <option value="Southeast">Southeast</option>
              <option value="Northeast">Northeast</option>
              <option value="Midwest">Midwest</option>
              <option value="West">West</option>
              <option value="National">National</option>
            </select>
          </div>
        </div>
        <div class="grid grid-cols-3 gap-4">
          <div>
            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Min CPM</label>
            <input type="number" id="intel-cpm-min"
              class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-base md:text-sm"
              placeholder="0.50">
          </div>
          <div>
            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Max CPM</label>
            <input type="number" id="intel-cpm-max"
              class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-base md:text-sm"
              placeholder="0.65">
          </div>
          <div>
            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Sign-On</label>
            <input type="number" id="intel-bonus"
              class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-base md:text-sm"
              placeholder="5000">
          </div>
        </div>
        <div>
          <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Benefits / Notes</label>
          <textarea id="intel-notes" rows="3"
            class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-base md:text-sm"
            placeholder="Summary of benefits..."></textarea>
        </div>
        <div>
          <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Source URL (Optional)</label>
          <input type="text" id="intel-url"
            class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-base md:text-sm"
            placeholder="https://...">
        </div>
      </div>
      <div class="p-4 border-t border-slate-100 bg-slate-50 flex justify-end gap-2">
        <button onclick="closeAddIntelModal()"
          class="px-4 py-2 text-sm font-medium text-slate-600 hover:text-slate-800">Cancel</button>
        <button onclick="saveIntel()"
          class="px-4 py-2 text-sm font-bold text-white bg-slate-900 rounded-lg hover:bg-slate-700">Save Intel</button>
      </div>
    </div>
  </div>

  <script>
    // INIT
    window.addEventListener('DOMContentLoaded', () => {
      window.addEventListener('message', handleMessage);
      sendToWix('competitorIntelReady');
      fetchData();
    });

    // FUNCTIONS
    function fetchData() {
      const region = document.getElementById('regionFilter').value;
      const jobType = document.getElementById('jobTypeFilter').value;

      showLoading(true);
      sendToWix('getCompetitorData', { region, jobType });

      // Dev Mock
      setTimeout(() => {
        if (document.getElementById('loading').classList.contains('hidden')) return;
        // renderDashboard(mockIntelData);
      }, 3000);
    }

    function handleMessage(event) {
      if (window.parent !== window && event.source !== window.parent) return;
      const msg = event.data;
      if (!msg || !msg.type) return;

      switch (msg.type) {
        case 'competitorData':
          showLoading(false);
          renderDashboard(msg.data);
          break;
        case 'intelSaved':
          closeAddIntelModal();
          fetchData();
          break;
      }
    }

    function sendToWix(type, data = {}) {
      if (window.parent) {
        window.parent.postMessage({ type, data }, '*');
      }
    }

    function renderDashboard(data) {
      if (!data) return;

      renderBenchmarks(data.benchmarks);
      renderCompetitors(data.competitors);
    }

    function renderBenchmarks(bench) {
      if (!bench) return;

      document.getElementById('sample-size').textContent = bench.sampleSize || 0;

      // Calculate positions (0 to 100%)
      // Assuming range is min to max with some padding
      const rangeMin = bench.min * 0.9;
      const rangeMax = bench.max * 1.1;
      const rangeSpan = rangeMax - rangeMin;

      function getPercent(val) {
        return Math.max(0, Math.min(100, ((val - rangeMin) / rangeSpan) * 100));
      }

      // Update markers
      document.getElementById('marker-min').style.left = getPercent(bench.min) + '%';
      document.getElementById('label-min').textContent = '$' + bench.min.toFixed(2);

      document.getElementById('marker-max').style.left = getPercent(bench.max) + '%';
      document.getElementById('label-max').textContent = '$' + bench.max.toFixed(2);

      document.getElementById('marker-avg').style.left = getPercent(bench.avg) + '%';
      document.getElementById('label-avg').textContent = '$' + bench.avg.toFixed(2);

      // Range fill
      const p25 = getPercent(bench.percentiles.p25);
      const p75 = getPercent(bench.percentiles.p75);
      const fill = document.getElementById('range-fill');
      fill.style.left = p25 + '%';
      fill.style.width = (p75 - p25) + '%';

      // Your Position (Mocked for now - would come from user's offer)
      const yourCpm = 0.58;
      const yourPercent = getPercent(yourCpm);
      const yourDot = document.getElementById('your-dot');
      yourDot.style.left = yourPercent + '%';
      document.getElementById('label-you').textContent = '$' + yourCpm.toFixed(2);

      // Percentile Calc (approx)
      let percentile = 50;
      if (yourCpm > bench.avg) percentile = 60 + ((yourCpm - bench.avg) / (bench.max - bench.avg)) * 40;
      else percentile = 50 - ((bench.avg - yourCpm) / (bench.avg - bench.min)) * 50;

      document.getElementById('percentile-text').textContent = Math.round(percentile) + 'th percentile';
    }

    function renderCompetitors(competitors) {
      const tbody = document.getElementById('competitor-table-body');
      tbody.innerHTML = '';

      if (!competitors || competitors.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-8 text-center text-slate-400">No data available for this region</td></tr>';
        return;
      }

      competitors.forEach(c => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-slate-50 transition border-b border-slate-50';

        tr.innerHTML = `
          <td class="px-6 py-4 font-bold text-slate-900">${c.name}</td>
          <td class="px-6 py-4 text-slate-600 font-mono">${c.cpmRange}</td>
          <td class="px-6 py-4 text-emerald-600 font-bold">${c.signOn}</td>
          <td class="px-6 py-4 text-slate-500 text-xs">${c.homeTime}</td>
          <td class="px-6 py-4 text-slate-500 text-xs max-w-xs truncate" title="${c.benefits}">${c.benefits}</td>
          <td class="px-6 py-4 text-center">
            ${c.verified
            ? '<i class="fa-solid fa-circle-check text-blue-500" title="Verified"></i>'
            : '<i class="fa-regular fa-circle text-slate-300" title="Unverified"></i>'}
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // MODAL FUNCTIONS
    function openAddIntelModal() {
      document.getElementById('addIntelModal').classList.remove('hidden');
    }

    function closeAddIntelModal() {
      document.getElementById('addIntelModal').classList.add('hidden');
    }

    function saveIntel() {
      const name = document.getElementById('intel-name').value;
      const cpmMin = document.getElementById('intel-cpm-min').value;
      const cpmMax = document.getElementById('intel-cpm-max').value;

      if (!name) {
        alert('Carrier name is required');
        return;
      }

      const data = {
        competitor_name: name,
        region: document.getElementById('intel-region').value,
        cpm_min: parseFloat(cpmMin),
        cpm_max: parseFloat(cpmMax),
        sign_on_bonus: parseFloat(document.getElementById('intel-bonus').value),
        benefits_summary: document.getElementById('intel-notes').value,
        source_url: document.getElementById('intel-url').value,
        source_type: 'manual_entry'
      };

      sendToWix('saveIntel', data);
    }

    function showLoading(show) {
      document.getElementById('loading').classList.toggle('hidden', !show);
    }
  </script>
</body>

</html>


