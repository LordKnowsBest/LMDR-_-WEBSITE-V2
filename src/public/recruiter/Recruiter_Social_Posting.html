<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Posting — LMDR Recruiter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { theme: { extend: { colors: { lmdr: { dark: '#0f172a', blue: '#2563eb', yellow: '#fbbf24' } } } } };</script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/recruiter/recruiter-design-system.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #0f172a;
            color: #e2e8f0;
        }

        .glass {
            background: rgba(30, 41, 59, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(30, 41, 59, 0.9));
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            transition: all 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }

        .btn-fb {
            background: linear-gradient(135deg, #1877f2, #0d5dbf);
            transition: all 0.2s;
        }

        .btn-li {
            background: linear-gradient(135deg, #0a66c2, #084e96);
            transition: all 0.2s;
        }

        .status-badge {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 9999px;
            font-weight: 600;
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }

        .platform-toggle {
            border: 2px solid transparent;
            transition: all 0.2s;
            cursor: pointer;
        }

        .platform-toggle.selected-fb {
            border-color: #1877f2;
            background: rgba(24, 119, 242, 0.1);
        }

        .platform-toggle.selected-li {
            border-color: #0a66c2;
            background: rgba(10, 102, 194, 0.1);
        }

        .post-card {
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.2s;
        }

        .post-card:hover {
            border-color: rgba(139, 92, 246, 0.4);
        }

        .fb-preview {
            background: #18191a;
            border-radius: 8px;
            border: 1px solid #3a3b3c;
        }

        .li-preview {
            background: #1b1f23;
            border-radius: 8px;
            border: 1px solid #2d3748;
        }

        .char-counter {
            transition: color 0.2s;
        }

        .tab-active {
            border-bottom: 2px solid #8b5cf6;
            color: #a78bfa;
        }

        .tab-inactive {
            color: #94a3b8;
            border-bottom: 2px solid transparent;
        }
    </style>
</head>

<body class="min-h-screen">
    <div class="glass border-b border-slate-700/50 px-6 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <div
                class="w-8 h-8 rounded-lg bg-gradient-to-br from-purple-500 to-purple-700 flex items-center justify-center">
                <i class="fas fa-share-alt text-white text-sm"></i>
            </div>
            <div>
                <h1 class="text-lg font-bold text-white">Social Posting</h1>
                <p class="text-xs text-slate-400">Facebook &amp; LinkedIn job distribution</p>
            </div>
        </div>
        <button id="newPostBtn" class="btn-primary px-4 py-2 rounded-lg text-white text-sm font-medium">
            <i class="fas fa-plus mr-2"></i>Create Post
        </button>
    </div>

    <div class="px-6 py-4 grid grid-cols-4 gap-4">
        <div class="stat-card rounded-xl p-4">
            <p class="text-xs text-slate-400 mb-1">Posts Published</p>
            <p class="text-2xl font-bold text-white" id="statPublished">—</p>
        </div>
        <div class="stat-card rounded-xl p-4">
            <p class="text-xs text-slate-400 mb-1">Total Reach</p>
            <p class="text-2xl font-bold text-white" id="statReach">—</p>
        </div>
        <div class="stat-card rounded-xl p-4">
            <p class="text-xs text-slate-400 mb-1">Engagements</p>
            <p class="text-2xl font-bold text-white" id="statEngagement">—</p>
        </div>
        <div class="stat-card rounded-xl p-4">
            <p class="text-xs text-slate-400 mb-1">Accounts Connected</p>
            <p class="text-2xl font-bold text-white" id="statAccounts">—</p>
        </div>
    </div>

    <!-- Account Connection -->
    <div class="px-6 mb-4">
        <h2 class="text-sm font-semibold text-slate-300 mb-3">Connected Accounts</h2>
        <div class="grid grid-cols-2 gap-4">
            <div class="glass rounded-xl p-4 flex items-center justify-between" id="fbCard">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center"><i
                            class="fab fa-facebook-f text-white"></i></div>
                    <div>
                        <p class="font-semibold text-white text-sm">Facebook Page</p>
                        <p class="text-xs text-slate-400" id="fbStatus">Not connected</p>
                    </div>
                </div>
                <button id="fbConnectBtn" onclick="connectAccount('facebook')"
                    class="btn-fb px-3 py-1.5 rounded-lg text-xs text-white">Connect</button>
            </div>
            <div class="glass rounded-xl p-4 flex items-center justify-between" id="liCard">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-blue-700 flex items-center justify-center"><i
                            class="fab fa-linkedin-in text-white"></i></div>
                    <div>
                        <p class="font-semibold text-white text-sm">LinkedIn</p>
                        <p class="text-xs text-slate-400" id="liStatus">Not connected</p>
                    </div>
                </div>
                <button id="liConnectBtn" onclick="connectAccount('linkedin')"
                    class="btn-li px-3 py-1.5 rounded-lg text-xs text-white">Connect</button>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="px-6 flex gap-6 border-b border-slate-700/50">
        <button class="tab-active pb-3 text-sm font-medium" data-tab="posts" onclick="switchTab('posts',this)"><i
                class="fas fa-list mr-2"></i>Posts</button>
        <button class="tab-inactive pb-3 text-sm font-medium" data-tab="scheduled"
            onclick="switchTab('scheduled',this)"><i class="fas fa-clock mr-2"></i>Scheduled</button>
    </div>

    <div id="tab-posts" class="px-6 py-4 fade-in">
        <div class="grid grid-cols-1 gap-3" id="postList">
            <div class="glass rounded-xl p-8 text-center text-slate-500">
                <i class="fas fa-share-alt text-3xl mb-3 block opacity-30"></i>
                <p class="text-sm">No posts yet. Create your first social post.</p>
            </div>
        </div>
    </div>

    <div id="tab-scheduled" class="px-6 py-4 fade-in hidden">
        <div class="grid grid-cols-1 gap-3" id="scheduledList">
            <div class="glass rounded-xl p-8 text-center text-slate-500">
                <i class="fas fa-clock text-3xl mb-3 block opacity-30"></i>
                <p class="text-sm">No scheduled posts.</p>
            </div>
        </div>
    </div>

    <!-- Post Composer Modal -->
    <div id="postModal" class="fixed inset-0 modal-overlay z-50 flex items-center justify-center hidden">
        <div class="glass rounded-2xl w-full max-w-3xl mx-4 max-h-[90vh] overflow-y-auto fade-in">
            <div class="flex items-center justify-between p-5 border-b border-slate-700/50">
                <h2 class="text-base font-bold text-white"><i class="fas fa-share-alt mr-2 text-purple-400"></i>Create
                    Social Post</h2>
                <button onclick="closeModal('postModal')" class="text-slate-400 hover:text-white"><i
                        class="fas fa-times"></i></button>
            </div>
            <div class="p-5 grid grid-cols-2 gap-6">
                <!-- Left: Composer -->
                <div class="space-y-3">
                    <div>
                        <label class="text-xs font-medium text-slate-400 mb-2 block">Platforms</label>
                        <div class="flex gap-3">
                            <div class="platform-toggle rounded-lg p-3 flex items-center gap-2 flex-1" id="toggleFb"
                                onclick="togglePlatform('facebook')">
                                <i class="fab fa-facebook-f text-blue-400"></i>
                                <span class="text-sm text-slate-300">Facebook</span>
                            </div>
                            <div class="platform-toggle rounded-lg p-3 flex items-center gap-2 flex-1" id="toggleLi"
                                onclick="togglePlatform('linkedin')">
                                <i class="fab fa-linkedin-in text-blue-500"></i>
                                <span class="text-sm text-slate-300">LinkedIn</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="flex items-center justify-between mb-1">
                            <label class="text-xs font-medium text-slate-400">Post Content *</label>
                            <span id="charCount" class="text-xs char-counter text-slate-400">0 chars</span>
                        </div>
                        <textarea id="postContent" rows="5"
                            placeholder="Write your post... Use emojis for Facebook, professional tone for LinkedIn."
                            class="w-full px-3 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:border-purple-500 resize-none"
                            oninput="updatePreview()"></textarea>
                    </div>
                    <div>
                        <label class="text-xs font-medium text-slate-400 mb-1 block">Link URL (optional)</label>
                        <input id="postLink" type="url" placeholder="https://..."
                            class="w-full px-3 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:border-purple-500">
                    </div>
                    <div>
                        <label class="text-xs font-medium text-slate-400 mb-1 block">Attach to Job (optional)</label>
                        <select id="postJobId"
                            class="w-full px-3 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-sm text-slate-300 focus:outline-none focus:border-purple-500">
                            <option value="">No job attached</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs font-medium text-slate-400 mb-1 block">Schedule</label>
                        <div class="flex gap-3">
                            <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="postSched"
                                    value="immediate" checked class="text-purple-500"><span
                                    class="text-sm text-slate-300">Now</span></label>
                            <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="postSched"
                                    value="scheduled" class="text-purple-500"><span
                                    class="text-sm text-slate-300">Schedule</span></label>
                        </div>
                        <input id="postSchedTime" type="datetime-local"
                            class="mt-2 px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-sm text-white focus:outline-none focus:border-purple-500 hidden w-full">
                    </div>
                    <button onclick="generateAIContent()"
                        class="w-full px-3 py-2 rounded-lg border border-purple-600/50 text-purple-400 text-sm hover:bg-purple-600/10 transition-all">
                        <i class="fas fa-magic mr-2"></i>Generate AI Content for Selected Job
                    </button>
                </div>
                <!-- Right: Preview -->
                <div>
                    <p class="text-xs font-medium text-slate-400 mb-3">Preview</p>
                    <div id="previewFb" class="fb-preview p-4 mb-3 hidden">
                        <div class="flex items-center gap-2 mb-3">
                            <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center"><i
                                    class="fas fa-truck text-white text-xs"></i></div>
                            <div>
                                <p class="text-xs font-semibold text-white">LMDR Recruiting</p>
                                <p class="text-xs text-slate-400">Just now · <i
                                        class="fas fa-globe-americas text-xs"></i></p>
                            </div>
                        </div>
                        <p class="text-sm text-slate-200 whitespace-pre-wrap" id="fbPreviewText">Your Facebook post will
                            appear here...</p>
                        <div class="mt-3 pt-3 border-t border-slate-700 flex gap-4 text-xs text-slate-400">
                            <span><i class="fas fa-thumbs-up mr-1"></i>Like</span>
                            <span><i class="fas fa-comment mr-1"></i>Comment</span>
                            <span><i class="fas fa-share mr-1"></i>Share</span>
                        </div>
                    </div>
                    <div id="previewLi" class="li-preview p-4 hidden">
                        <div class="flex items-center gap-2 mb-3">
                            <div class="w-8 h-8 rounded-full bg-blue-700 flex items-center justify-center"><i
                                    class="fas fa-truck text-white text-xs"></i></div>
                            <div>
                                <p class="text-xs font-semibold text-white">LMDR Recruiting</p>
                                <p class="text-xs text-slate-400">Just now · <i class="fas fa-globe text-xs"></i></p>
                            </div>
                        </div>
                        <p class="text-sm text-slate-200 whitespace-pre-wrap" id="liPreviewText">Your LinkedIn post will
                            appear here...</p>
                        <div class="mt-3 pt-3 border-t border-slate-700 flex gap-4 text-xs text-slate-400">
                            <span><i class="fas fa-thumbs-up mr-1"></i>Like</span>
                            <span><i class="fas fa-comment mr-1"></i>Comment</span>
                            <span><i class="fas fa-share mr-1"></i>Repost</span>
                        </div>
                    </div>
                    <div id="previewEmpty" class="text-center py-8 text-slate-500 text-xs">
                        <i class="fas fa-eye text-2xl mb-2 block opacity-30"></i>
                        Select a platform to see preview
                    </div>
                </div>
            </div>
            <div class="flex gap-3 p-5 border-t border-slate-700/50">
                <button onclick="closeModal('postModal')"
                    class="flex-1 px-4 py-2 rounded-lg border border-slate-600 text-slate-300 text-sm">Cancel</button>
                <button onclick="savePost('draft')"
                    class="px-4 py-2 rounded-lg border border-purple-600 text-purple-400 text-sm">Save Draft</button>
                <button onclick="savePost('publish')"
                    class="btn-primary flex-1 px-4 py-2 rounded-lg text-white text-sm font-medium"><i
                        class="fas fa-paper-plane mr-2"></i>Publish</button>
            </div>
        </div>
    </div>

    <script>
        let carrierDot = '', posts = [], selectedPlatforms = new Set(), jobs = [];

        window.addEventListener('message', (e) => {
            const { type, data } = e.data || {};
            if (type === 'INIT') { carrierDot = data.carrierDot || ''; loadAll(); }
            if (type === 'SOCIAL_POSTS_LOADED') renderPosts(data.posts || []);
            if (type === 'JOB_POSTINGS_LOADED') populateJobSelect(data.jobs || []);
            if (type === 'SOCIAL_ACCOUNTS_LOADED') updateAccountStatus(data.accounts || []);
            if (type === 'SOCIAL_POST_CREATED') { closeModal('postModal'); loadAll(); showToast('Post published!', 'success'); }
            if (type === 'AI_CONTENT_GENERATED') { document.getElementById('postContent').value = data.content || ''; updatePreview(); }
            if (type === 'ERROR') showToast(data.message || 'Error', 'error');
        });

        function postToVelo(type, data) { window.parent.postMessage({ type, data }, '*'); }
        function loadAll() {
            postToVelo('GET_SOCIAL_POSTS', { carrierDot });
            postToVelo('GET_JOB_POSTINGS', { carrierDot });
            postToVelo('GET_SOCIAL_ACCOUNTS', { carrierDot });
        }

        function switchTab(tab, el) {
            document.querySelectorAll('[data-tab]').forEach(t => { t.classList.remove('tab-active'); t.classList.add('tab-inactive'); });
            el.classList.add('tab-active'); el.classList.remove('tab-inactive');
            document.querySelectorAll('[id^="tab-"]').forEach(p => p.classList.add('hidden'));
            document.getElementById('tab-' + tab).classList.remove('hidden');
        }

        function renderPosts(data) {
            posts = data;
            const published = data.filter(p => p.status === 'published');
            const scheduled = data.filter(p => p.status === 'scheduled');
            document.getElementById('statPublished').textContent = published.length;

            const list = document.getElementById('postList');
            if (!published.length) { list.innerHTML = '<div class="glass rounded-xl p-8 text-center text-slate-500"><i class="fas fa-share-alt text-3xl mb-3 block opacity-30"></i><p class="text-sm">No published posts yet.</p></div>'; return; }
            list.innerHTML = published.map(p => {
                const platforms = p.platforms || [];
                const eng = p.engagement || {};
                const platformIcons = platforms.map(pl => pl === 'facebook' ? '<i class="fab fa-facebook-f text-blue-400 text-xs"></i>' : '<i class="fab fa-linkedin-in text-blue-500 text-xs"></i>').join('');
                return `<div class="post-card glass rounded-xl p-4 flex items-start gap-4">
      <div class="flex gap-1.5 mt-1">${platformIcons}</div>
      <div class="flex-1 min-w-0">
        <p class="text-sm text-slate-200 line-clamp-2">${p.content}</p>
        <div class="flex items-center gap-4 mt-2 text-xs text-slate-400">
          <span><i class="fas fa-thumbs-up mr-1"></i>${eng.likes || 0}</span>
          <span><i class="fas fa-comment mr-1"></i>${eng.comments || 0}</span>
          <span><i class="fas fa-share mr-1"></i>${eng.shares || 0}</span>
          <span class="ml-auto">${p.published_at ? new Date(p.published_at).toLocaleDateString() : '—'}</span>
        </div>
      </div>
      <span class="status-badge bg-green-500/20 text-green-400 flex-shrink-0">published</span>
    </div>`;
            }).join('');

            const schedList = document.getElementById('scheduledList');
            if (!scheduled.length) { schedList.innerHTML = '<div class="glass rounded-xl p-8 text-center text-slate-500"><i class="fas fa-clock text-3xl mb-3 block opacity-30"></i><p class="text-sm">No scheduled posts.</p></div>'; return; }
            schedList.innerHTML = scheduled.map(p => `<div class="post-card glass rounded-xl p-4 flex items-start gap-4">
    <div class="flex-1 min-w-0">
      <p class="text-sm text-slate-200 line-clamp-2">${p.content}</p>
      <p class="text-xs text-yellow-400 mt-1"><i class="fas fa-clock mr-1"></i>Scheduled: ${p.scheduled_time ? new Date(p.scheduled_time).toLocaleString() : '—'}</p>
    </div>
    <button onclick="postToVelo('CANCEL_SOCIAL_POST',{postId:'${p._id}'})" class="px-3 py-1 rounded text-xs bg-red-600/20 text-red-400 hover:bg-red-600/30 flex-shrink-0">Cancel</button>
  </div>`).join('');
        }

        function populateJobSelect(data) {
            jobs = data;
            const sel = document.getElementById('postJobId');
            sel.innerHTML = '<option value="">No job attached</option>' + data.map(j => `<option value="${j._id}">${j.title} — ${j.location}</option>`).join('');
        }

        function updateAccountStatus(accounts) {
            const fb = accounts.find(a => a.platform === 'facebook');
            const li = accounts.find(a => a.platform === 'linkedin');
            if (fb) { document.getElementById('fbStatus').textContent = fb.accountName || 'Connected'; document.getElementById('fbConnectBtn').textContent = 'Disconnect'; document.getElementById('fbConnectBtn').className = 'px-3 py-1.5 rounded-lg text-xs bg-red-600/20 text-red-400 hover:bg-red-600/30'; }
            if (li) { document.getElementById('liStatus').textContent = li.accountName || 'Connected'; document.getElementById('liConnectBtn').textContent = 'Disconnect'; document.getElementById('liConnectBtn').className = 'px-3 py-1.5 rounded-lg text-xs bg-red-600/20 text-red-400 hover:bg-red-600/30'; }
            document.getElementById('statAccounts').textContent = accounts.length;
        }

        function connectAccount(platform) {
            // Initiate OAuth flow via Velo
            postToVelo('INITIATE_SOCIAL_OAUTH', { platform, carrierDot });
        }

        document.getElementById('newPostBtn').addEventListener('click', () => openModal('postModal'));
        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

        document.querySelectorAll('input[name="postSched"]').forEach(r => r.addEventListener('change', () => document.getElementById('postSchedTime').classList.toggle('hidden', r.value !== 'scheduled')));

        function togglePlatform(platform) {
            const el = document.getElementById(platform === 'facebook' ? 'toggleFb' : 'toggleLi');
            const cls = platform === 'facebook' ? 'selected-fb' : 'selected-li';
            if (selectedPlatforms.has(platform)) { selectedPlatforms.delete(platform); el.classList.remove(cls); }
            else { selectedPlatforms.add(platform); el.classList.add(cls); }
            updatePreview();
        }

        function updatePreview() {
            const content = document.getElementById('postContent').value || '';
            document.getElementById('charCount').textContent = content.length + ' chars';
            const hasFb = selectedPlatforms.has('facebook');
            const hasLi = selectedPlatforms.has('linkedin');
            document.getElementById('previewFb').classList.toggle('hidden', !hasFb);
            document.getElementById('previewLi').classList.toggle('hidden', !hasLi);
            document.getElementById('previewEmpty').classList.toggle('hidden', hasFb || hasLi);
            if (hasFb) document.getElementById('fbPreviewText').textContent = content || 'Your Facebook post will appear here...';
            if (hasLi) document.getElementById('liPreviewText').textContent = content || 'Your LinkedIn post will appear here...';
        }

        function generateAIContent() {
            const jobId = document.getElementById('postJobId').value;
            const platform = selectedPlatforms.has('linkedin') ? 'linkedin' : 'facebook';
            if (!jobId) { showToast('Select a job first', 'error'); return; }
            postToVelo('GENERATE_SOCIAL_CONTENT', { jobId, platform });
            showToast('Generating content...', 'info');
        }

        function savePost(action) {
            if (selectedPlatforms.size === 0) { showToast('Select at least one platform', 'error'); return; }
            const sched = document.querySelector('input[name="postSched"]:checked')?.value || 'immediate';
            const data = { carrierDot, content: document.getElementById('postContent').value, platforms: Array.from(selectedPlatforms), linkUrl: document.getElementById('postLink').value, jobId: document.getElementById('postJobId').value, scheduleType: sched, scheduledTime: sched === 'scheduled' ? document.getElementById('postSchedTime').value : null };
            postToVelo(action === 'publish' ? 'PUBLISH_SOCIAL_POST' : 'CREATE_SOCIAL_POST', data);
        }

        function showToast(msg, type = 'info') {
            const colors = { success: 'bg-green-600', error: 'bg-red-600', info: 'bg-purple-600' };
            const t = document.createElement('div');
            t.className = `fixed bottom-4 right-4 ${colors[type]} text-white px-4 py-2.5 rounded-lg text-sm font-medium shadow-lg z-50`;
            t.textContent = msg; document.body.appendChild(t); setTimeout(() => t.remove(), 3000);
        }
    </script>
</body>

</html>