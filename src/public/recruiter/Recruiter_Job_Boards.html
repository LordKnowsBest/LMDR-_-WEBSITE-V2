<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Board Distribution — LMDR Recruiter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { theme: { extend: { colors: { lmdr: { dark: '#0f172a', blue: '#2563eb', yellow: '#fbbf24' } } } } };</script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/recruiter/recruiter-design-system.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #0f172a;
            color: #e2e8f0;
        }

        .glass {
            background: rgba(30, 41, 59, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(30, 41, 59, 0.9));
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            transition: all 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }

        .status-badge {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 9999px;
            font-weight: 600;
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }

        .board-card {
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.2s;
        }

        .board-card:hover {
            border-color: rgba(245, 158, 11, 0.4);
        }

        .board-connected {
            border-color: rgba(16, 185, 129, 0.4);
            background: rgba(16, 185, 129, 0.05);
        }

        .tab-active {
            border-bottom: 2px solid #f59e0b;
            color: #fbbf24;
        }

        .tab-inactive {
            color: #94a3b8;
            border-bottom: 2px solid transparent;
        }
    </style>
</head>

<body class="min-h-screen">
    <div class="glass border-b border-slate-700/50 px-6 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <div
                class="w-8 h-8 rounded-lg bg-gradient-to-br from-yellow-500 to-yellow-700 flex items-center justify-center">
                <i class="fas fa-briefcase text-white text-sm"></i>
            </div>
            <div>
                <h1 class="text-lg font-bold text-white">Job Board Distribution</h1>
                <p class="text-xs text-slate-400">Post to Indeed, ZipRecruiter &amp; CDLjobs</p>
            </div>
        </div>
        <button id="newJobBtn" class="btn-primary px-4 py-2 rounded-lg text-white text-sm font-medium">
            <i class="fas fa-plus mr-2"></i>Post New Job
        </button>
    </div>

    <div class="px-6 py-4 grid grid-cols-4 gap-4">
        <div class="stat-card rounded-xl p-4">
            <p class="text-xs text-slate-400 mb-1">Active Postings</p>
            <p class="text-2xl font-bold text-white" id="statActive">—</p>
        </div>
        <div class="stat-card rounded-xl p-4">
            <p class="text-xs text-slate-400 mb-1">Total Views</p>
            <p class="text-2xl font-bold text-white" id="statViews">—</p>
        </div>
        <div class="stat-card rounded-xl p-4">
            <p class="text-xs text-slate-400 mb-1">Applications</p>
            <p class="text-2xl font-bold text-white" id="statApps">—</p>
        </div>
        <div class="stat-card rounded-xl p-4">
            <p class="text-xs text-slate-400 mb-1">Boards Connected</p>
            <p class="text-2xl font-bold text-white" id="statBoards">—</p>
        </div>
    </div>

    <!-- Board Connection Cards -->
    <div class="px-6 mb-4">
        <h2 class="text-sm font-semibold text-slate-300 mb-3">Connected Job Boards</h2>
        <div class="grid grid-cols-3 gap-4" id="boardCards">
            <div class="board-card rounded-xl p-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 rounded-lg bg-blue-600 flex items-center justify-center font-bold text-white text-sm">
                        In</div>
                    <div>
                        <p class="font-semibold text-white text-sm">Indeed</p>
                        <p class="text-xs text-slate-400" id="indeedStatus">Not connected</p>
                    </div>
                </div>
                <button onclick="connectBoard('indeed')" id="indeedBtn"
                    class="px-3 py-1.5 rounded-lg text-xs bg-slate-700 text-slate-300 hover:bg-slate-600 transition-all">Connect</button>
            </div>
            <div class="board-card rounded-xl p-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 rounded-lg bg-green-600 flex items-center justify-center font-bold text-white text-sm">
                        Zr</div>
                    <div>
                        <p class="font-semibold text-white text-sm">ZipRecruiter</p>
                        <p class="text-xs text-slate-400" id="zipStatus">Not connected</p>
                    </div>
                </div>
                <button onclick="connectBoard('ziprecruiter')" id="zipBtn"
                    class="px-3 py-1.5 rounded-lg text-xs bg-slate-700 text-slate-300 hover:bg-slate-600 transition-all">Connect</button>
            </div>
            <div class="board-card rounded-xl p-4 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 rounded-lg bg-orange-600 flex items-center justify-center font-bold text-white text-sm">
                        Cd</div>
                    <div>
                        <p class="font-semibold text-white text-sm">CDLjobs.com</p>
                        <p class="text-xs text-slate-400" id="cdlStatus">Not connected</p>
                    </div>
                </div>
                <button onclick="connectBoard('cdljobs')" id="cdlBtn"
                    class="px-3 py-1.5 rounded-lg text-xs bg-slate-700 text-slate-300 hover:bg-slate-600 transition-all">Connect</button>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="px-6 flex gap-6 border-b border-slate-700/50">
        <button class="tab-active pb-3 text-sm font-medium" data-tab="postings" onclick="switchTab('postings',this)"><i
                class="fas fa-list mr-2"></i>Job Postings</button>
        <button class="tab-inactive pb-3 text-sm font-medium" data-tab="applications"
            onclick="switchTab('applications',this)"><i class="fas fa-users mr-2"></i>Applications</button>
    </div>

    <div id="tab-postings" class="px-6 py-4 fade-in">
        <div class="glass rounded-xl overflow-hidden">
            <table class="w-full">
                <thead>
                    <tr class="border-b border-slate-700/50">
                        <th class="text-left px-4 py-3 text-xs font-semibold text-slate-400 uppercase">Job Title</th>
                        <th class="text-left px-4 py-3 text-xs font-semibold text-slate-400 uppercase">Location</th>
                        <th class="text-left px-4 py-3 text-xs font-semibold text-slate-400 uppercase">Boards</th>
                        <th class="text-right px-4 py-3 text-xs font-semibold text-slate-400 uppercase">Views</th>
                        <th class="text-right px-4 py-3 text-xs font-semibold text-slate-400 uppercase">Apps</th>
                        <th class="text-right px-4 py-3 text-xs font-semibold text-slate-400 uppercase">Expires</th>
                        <th class="px-4 py-3"></th>
                    </tr>
                </thead>
                <tbody id="jobTableBody">
                    <tr>
                        <td colspan="7" class="text-center py-12 text-slate-500"><i
                                class="fas fa-briefcase text-3xl mb-3 block opacity-30"></i>
                            <p class="text-sm">No job postings yet.</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="tab-applications" class="px-6 py-4 fade-in hidden">
        <div class="glass rounded-xl overflow-hidden">
            <table class="w-full">
                <thead>
                    <tr class="border-b border-slate-700/50">
                        <th class="text-left px-4 py-3 text-xs font-semibold text-slate-400 uppercase">Applicant</th>
                        <th class="text-left px-4 py-3 text-xs font-semibold text-slate-400 uppercase">Job</th>
                        <th class="text-left px-4 py-3 text-xs font-semibold text-slate-400 uppercase">Source</th>
                        <th class="text-left px-4 py-3 text-xs font-semibold text-slate-400 uppercase">Status</th>
                        <th class="text-right px-4 py-3 text-xs font-semibold text-slate-400 uppercase">Applied</th>
                        <th class="px-4 py-3"></th>
                    </tr>
                </thead>
                <tbody id="appTableBody">
                    <tr>
                        <td colspan="6" class="text-center py-12 text-slate-500"><i
                                class="fas fa-users text-3xl mb-3 block opacity-30"></i>
                            <p class="text-sm">No applications yet.</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Job Posting Modal -->
    <div id="jobModal" class="fixed inset-0 modal-overlay z-50 flex items-center justify-center hidden">
        <div class="glass rounded-2xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto fade-in">
            <div class="flex items-center justify-between p-5 border-b border-slate-700/50">
                <h2 class="text-base font-bold text-white"><i class="fas fa-briefcase mr-2 text-yellow-400"></i>Post New
                    Job</h2>
                <button onclick="closeModal('jobModal')" class="text-slate-400 hover:text-white"><i
                        class="fas fa-times"></i></button>
            </div>
            <div class="p-5 space-y-3">
                <div class="grid grid-cols-2 gap-3">
                    <input id="jobTitle" type="text" placeholder="Job Title *"
                        class="px-3 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:border-yellow-500">
                    <input id="jobLocation" type="text" placeholder="Location *"
                        class="px-3 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:border-yellow-500">
                </div>
                <textarea id="jobDesc" rows="4" placeholder="Job description *"
                    class="w-full px-3 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:border-yellow-500 resize-none"></textarea>
                <div class="grid grid-cols-3 gap-3">
                    <select id="jobRouteType"
                        class="px-3 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-sm text-slate-300 focus:outline-none focus:border-yellow-500">
                        <option value="OTR">OTR</option>
                        <option value="Regional">Regional</option>
                        <option value="Local">Local</option>
                    </select>
                    <select id="jobCdlClass"
                        class="px-3 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-sm text-slate-300 focus:outline-none focus:border-yellow-500">
                        <option value="A">CDL-A</option>
                        <option value="B">CDL-B</option>
                    </select>
                    <input id="jobPayRate" type="text" placeholder="Pay (e.g. $0.55/mi)"
                        class="px-3 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:border-yellow-500">
                </div>
                <div>
                    <label class="text-xs font-medium text-slate-400 mb-2 block">Syndicate to Boards</label>
                    <div class="flex gap-3">
                        <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" id="boardIndeed"
                                value="indeed" class="rounded"><span
                                class="text-sm text-slate-300">Indeed</span></label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" id="boardZip"
                                value="ziprecruiter" class="rounded"><span
                                class="text-sm text-slate-300">ZipRecruiter</span></label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" id="boardCdl"
                                value="cdljobs" class="rounded"><span
                                class="text-sm text-slate-300">CDLjobs</span></label>
                    </div>
                </div>
            </div>
            <div class="flex gap-3 p-5 border-t border-slate-700/50">
                <button onclick="closeModal('jobModal')"
                    class="flex-1 px-4 py-2 rounded-lg border border-slate-600 text-slate-300 text-sm">Cancel</button>
                <button onclick="saveJob()"
                    class="btn-primary flex-1 px-4 py-2 rounded-lg text-white text-sm font-medium"><i
                        class="fas fa-paper-plane mr-2"></i>Post Job</button>
            </div>
        </div>
    </div>

    <!-- Connect Board Modal -->
    <div id="connectModal" class="fixed inset-0 modal-overlay z-50 flex items-center justify-center hidden">
        <div class="glass rounded-2xl w-full max-w-md mx-4 fade-in">
            <div class="flex items-center justify-between p-5 border-b border-slate-700/50">
                <h2 class="text-base font-bold text-white" id="connectModalTitle">Connect Job Board</h2>
                <button onclick="closeModal('connectModal')" class="text-slate-400 hover:text-white"><i
                        class="fas fa-times"></i></button>
            </div>
            <div class="p-5 space-y-3">
                <input id="boardApiKey" type="text" placeholder="API Key *"
                    class="w-full px-3 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:border-yellow-500">
                <input id="boardPublisherId" type="text" placeholder="Publisher ID (if required)"
                    class="w-full px-3 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:border-yellow-500">
            </div>
            <div class="flex gap-3 p-5 border-t border-slate-700/50">
                <button onclick="closeModal('connectModal')"
                    class="flex-1 px-4 py-2 rounded-lg border border-slate-600 text-slate-300 text-sm">Cancel</button>
                <button onclick="saveConnection()"
                    class="btn-primary flex-1 px-4 py-2 rounded-lg text-white text-sm font-medium">Connect</button>
            </div>
        </div>
    </div>

    <script>
        let carrierDot = '', jobs = [], apps = [], connectingBoard = '';

        window.addEventListener('message', (e) => {
            const { type, data } = e.data || {};
            if (type === 'INIT') { carrierDot = data.carrierDot || ''; loadAll(); }
            if (type === 'JOB_POSTINGS_LOADED') renderJobs(data.jobs || []);
            if (type === 'JOB_APPLICATIONS_LOADED') renderApps(data.applications || []);
            if (type === 'JOB_CREATED') { closeModal('jobModal'); loadAll(); showToast('Job posted!', 'success'); }
            if (type === 'BOARD_CONNECTED') { closeModal('connectModal'); updateBoardStatus(connectingBoard, true); showToast('Board connected!', 'success'); }
            if (type === 'ERROR') showToast(data.message || 'Error', 'error');
        });

        function postToVelo(type, data) { window.parent.postMessage({ type, data }, '*'); }
        function loadAll() { postToVelo('GET_JOB_POSTINGS', { carrierDot }); postToVelo('GET_JOB_APPLICATIONS', { carrierDot }); }

        function switchTab(tab, el) {
            document.querySelectorAll('[data-tab]').forEach(t => { t.classList.remove('tab-active'); t.classList.add('tab-inactive'); });
            el.classList.add('tab-active'); el.classList.remove('tab-inactive');
            document.querySelectorAll('[id^="tab-"]').forEach(p => p.classList.add('hidden'));
            document.getElementById('tab-' + tab).classList.remove('hidden');
        }

        function renderJobs(data) {
            jobs = data;
            const tbody = document.getElementById('jobTableBody');
            if (!data.length) { tbody.innerHTML = '<tr><td colspan="7" class="text-center py-12 text-slate-500"><i class="fas fa-briefcase text-3xl mb-3 block opacity-30"></i><p class="text-sm">No job postings yet.</p></td></tr>'; return; }
            tbody.innerHTML = data.map(j => {
                const syn = j.syndication || {};
                const liveBoards = Object.keys(syn).filter(b => syn[b]?.status === 'live');
                const boardBadges = liveBoards.map(b => `<span class="text-xs px-1.5 py-0.5 rounded bg-green-500/20 text-green-400">${b}</span>`).join(' ');
                return `<tr class="border-b border-slate-700/30 hover:bg-slate-800/30 cursor-pointer">
      <td class="px-4 py-3"><p class="text-sm font-medium text-white">${j.title}</p><p class="text-xs text-slate-400">${j.route_type} · CDL-${j.cdl_class_required}</p></td>
      <td class="px-4 py-3 text-sm text-slate-300">${j.location}</td>
      <td class="px-4 py-3"><div class="flex gap-1">${boardBadges || '<span class="text-xs text-slate-500">None</span>'}</div></td>
      <td class="px-4 py-3 text-right text-sm text-slate-300">${(j.view_count || 0).toLocaleString()}</td>
      <td class="px-4 py-3 text-right text-sm text-yellow-400">${(j.application_count || 0).toLocaleString()}</td>
      <td class="px-4 py-3 text-right text-xs text-slate-400">${j.expires_at ? new Date(j.expires_at).toLocaleDateString() : '—'}</td>
      <td class="px-4 py-3 text-right"><button onclick="syndicateJob('${j._id}')" class="px-3 py-1 rounded text-xs bg-yellow-600/20 text-yellow-400 hover:bg-yellow-600/30">Syndicate</button></td>
    </tr>`;
            }).join('');
            document.getElementById('statActive').textContent = data.filter(j => j.status === 'active').length;
            document.getElementById('statViews').textContent = data.reduce((s, j) => s + (j.view_count || 0), 0).toLocaleString();
            document.getElementById('statApps').textContent = data.reduce((s, j) => s + (j.application_count || 0), 0).toLocaleString();
        }

        function renderApps(data) {
            apps = data;
            const tbody = document.getElementById('appTableBody');
            if (!data.length) { tbody.innerHTML = '<tr><td colspan="6" class="text-center py-12 text-slate-500"><i class="fas fa-users text-3xl mb-3 block opacity-30"></i><p class="text-sm">No applications yet.</p></td></tr>'; return; }
            tbody.innerHTML = data.map(a => `<tr class="border-b border-slate-700/30 hover:bg-slate-800/30">
    <td class="px-4 py-3"><p class="text-sm font-medium text-white">${a.applicant_name || 'Unknown'}</p><p class="text-xs text-slate-400">${a.applicant_email || ''}</p></td>
    <td class="px-4 py-3 text-sm text-slate-300">${a.job_title || a.job_id}</td>
    <td class="px-4 py-3"><span class="text-xs px-2 py-0.5 rounded bg-blue-500/20 text-blue-400">${a.source_board}</span></td>
    <td class="px-4 py-3"><span class="text-xs px-2 py-0.5 rounded bg-slate-700 text-slate-300">${a.status}</span></td>
    <td class="px-4 py-3 text-right text-xs text-slate-400">${a.applied_at ? new Date(a.applied_at).toLocaleDateString() : '—'}</td>
    <td class="px-4 py-3 text-right"><button class="px-3 py-1 rounded text-xs bg-slate-700 text-slate-300 hover:bg-slate-600">Review</button></td>
  </tr>`).join('');
        }

        document.getElementById('newJobBtn').addEventListener('click', () => openModal('jobModal'));
        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

        function connectBoard(board) {
            connectingBoard = board;
            const names = { indeed: 'Indeed', ziprecruiter: 'ZipRecruiter', cdljobs: 'CDLjobs.com' };
            document.getElementById('connectModalTitle').textContent = 'Connect ' + names[board];
            document.getElementById('boardApiKey').value = '';
            document.getElementById('boardPublisherId').value = '';
            openModal('connectModal');
        }

        function saveConnection() {
            postToVelo('CONNECT_JOB_BOARD', { carrierDot, board: connectingBoard, credentials: { apiKey: document.getElementById('boardApiKey').value, publisherId: document.getElementById('boardPublisherId').value } });
        }

        function updateBoardStatus(board, connected) {
            const statusEl = document.getElementById(board.replace('recruiter', '') + 'Status');
            const btnEl = document.getElementById(board.replace('recruiter', '') + 'Btn');
            if (statusEl) statusEl.textContent = connected ? 'Connected' : 'Not connected';
            if (btnEl) { btnEl.textContent = connected ? 'Disconnect' : 'Connect'; btnEl.className = connected ? 'px-3 py-1.5 rounded-lg text-xs bg-red-600/20 text-red-400 hover:bg-red-600/30 transition-all' : 'px-3 py-1.5 rounded-lg text-xs bg-slate-700 text-slate-300 hover:bg-slate-600 transition-all'; }
            document.getElementById('statBoards').textContent = document.querySelectorAll('[id$="Status"]').length;
        }

        function saveJob() {
            const boards = [];
            if (document.getElementById('boardIndeed').checked) boards.push('indeed');
            if (document.getElementById('boardZip').checked) boards.push('ziprecruiter');
            if (document.getElementById('boardCdl').checked) boards.push('cdljobs');
            const data = { carrierDot, title: document.getElementById('jobTitle').value, location: document.getElementById('jobLocation').value, description: document.getElementById('jobDesc').value, routeType: document.getElementById('jobRouteType').value, cdlClassRequired: document.getElementById('jobCdlClass').value, payRate: document.getElementById('jobPayRate').value, boards };
            postToVelo('CREATE_JOB_POSTING', data);
        }

        function syndicateJob(jobId) { postToVelo('SYNDICATE_JOB', { jobId, boards: ['indeed', 'ziprecruiter', 'cdljobs'] }); }

        function showToast(msg, type = 'info') {
            const colors = { success: 'bg-green-600', error: 'bg-red-600', info: 'bg-blue-600' };
            const t = document.createElement('div');
            t.className = `fixed bottom-4 right-4 ${colors[type]} text-white px-4 py-2.5 rounded-lg text-sm font-medium shadow-lg z-50`;
            t.textContent = msg; document.body.appendChild(t); setTimeout(() => t.remove(), 3000);
        }
    </script>
</body>

</html>