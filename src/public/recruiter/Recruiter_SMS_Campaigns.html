<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMS Campaigns — LMDR Recruiter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { theme: { extend: { colors: { lmdr: { dark: '#0f172a', blue: '#2563eb', yellow: '#fbbf24' } } } } };</script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/recruiter/recruiter-design-system.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #0f172a;
            color: #e2e8f0;
        }

        .glass {
            background: rgba(30, 41, 59, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(30, 41, 59, 0.9));
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, #10b981, #059669);
            transition: all 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        .status-badge {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 9999px;
            font-weight: 600;
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }

        .phone-preview {
            background: #1e293b;
            border: 2px solid #334155;
            border-radius: 24px;
            padding: 20px 16px;
            max-width: 280px;
        }

        .sms-bubble {
            background: #2563eb;
            border-radius: 18px 18px 4px 18px;
            padding: 10px 14px;
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .char-counter {
            transition: color 0.2s;
        }

        .tcpa-badge {
            background: rgba(245, 158, 11, 0.15);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 8px;
            padding: 8px 12px;
        }
    </style>
</head>

<body class="min-h-screen">
    <div class="glass border-b border-slate-700/50 px-6 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <div
                class="w-8 h-8 rounded-lg bg-gradient-to-br from-green-500 to-green-700 flex items-center justify-center">
                <i class="fas fa-sms text-white text-sm"></i>
            </div>
            <div>
                <h1 class="text-lg font-bold text-white">SMS Campaigns</h1>
                <p class="text-xs text-slate-400">TCPA-compliant text messaging</p>
            </div>
        </div>
        <button id="newCampaignBtn" class="btn-primary px-4 py-2 rounded-lg text-white text-sm font-medium">
            <i class="fas fa-plus mr-2"></i>New SMS Campaign
        </button>
    </div>

    <!-- TCPA Notice -->
    <div class="px-6 pt-4">
        <div class="tcpa-badge flex items-start gap-3">
            <i class="fas fa-shield-alt text-yellow-400 mt-0.5"></i>
            <div>
                <p class="text-xs font-semibold text-yellow-400">TCPA Compliance Active</p>
                <p class="text-xs text-slate-400 mt-0.5">Messages only sent 9am–8pm CST. STOP/UNSUBSCRIBE handled
                    automatically. Opt-out list enforced on every send.</p>
            </div>
        </div>
    </div>

    <div class="px-6 py-4 grid grid-cols-4 gap-4">
        <div class="stat-card rounded-xl p-4">
            <p class="text-xs text-slate-400 mb-1">Total Sent</p>
            <p class="text-2xl font-bold text-white" id="statSent">—</p>
        </div>
        <div class="stat-card rounded-xl p-4">
            <p class="text-xs text-slate-400 mb-1">Delivery Rate</p>
            <p class="text-2xl font-bold text-white" id="statDelivery">—</p>
        </div>
        <div class="stat-card rounded-xl p-4">
            <p class="text-xs text-slate-400 mb-1">Reply Rate</p>
            <p class="text-2xl font-bold text-white" id="statReply">—</p>
        </div>
        <div class="stat-card rounded-xl p-4">
            <p class="text-xs text-slate-400 mb-1">Opt-Outs</p>
            <p class="text-2xl font-bold text-white" id="statOptOut">—</p>
        </div>
    </div>

    <div class="px-6 pb-6">
        <div class="glass rounded-xl overflow-hidden">
            <table class="w-full">
                <thead>
                    <tr class="border-b border-slate-700/50">
                        <th class="text-left px-4 py-3 text-xs font-semibold text-slate-400 uppercase">Campaign</th>
                        <th class="text-left px-4 py-3 text-xs font-semibold text-slate-400 uppercase">Status</th>
                        <th class="text-right px-4 py-3 text-xs font-semibold text-slate-400 uppercase">Sent</th>
                        <th class="text-right px-4 py-3 text-xs font-semibold text-slate-400 uppercase">Delivered</th>
                        <th class="text-right px-4 py-3 text-xs font-semibold text-slate-400 uppercase">Replies</th>
                        <th class="text-right px-4 py-3 text-xs font-semibold text-slate-400 uppercase">Est. Cost</th>
                        <th class="px-4 py-3"></th>
                    </tr>
                </thead>
                <tbody id="campaignTableBody">
                    <tr>
                        <td colspan="7" class="text-center py-12 text-slate-500"><i
                                class="fas fa-sms text-3xl mb-3 block opacity-30"></i>
                            <p class="text-sm">No SMS campaigns yet.</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Campaign Modal -->
    <div id="campaignModal" class="fixed inset-0 modal-overlay z-50 flex items-center justify-center hidden">
        <div class="glass rounded-2xl w-full max-w-3xl mx-4 max-h-[90vh] overflow-y-auto fade-in">
            <div class="flex items-center justify-between p-5 border-b border-slate-700/50">
                <h2 class="text-base font-bold text-white"><i class="fas fa-sms mr-2 text-green-400"></i>New SMS
                    Campaign</h2>
                <button onclick="closeModal()" class="text-slate-400 hover:text-white"><i
                        class="fas fa-times"></i></button>
            </div>
            <div class="p-5 grid grid-cols-2 gap-6">
                <!-- Left: Form -->
                <div class="space-y-3">
                    <input id="campName" type="text" placeholder="Campaign Name *"
                        class="w-full px-3 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:border-green-500">
                    <div>
                        <div class="flex items-center justify-between mb-1">
                            <label class="text-xs font-medium text-slate-400">Message Body *</label>
                            <span id="charCount" class="text-xs char-counter text-slate-400">0/160</span>
                        </div>
                        <textarea id="campBody" rows="4"
                            placeholder="Hi {{firstName}}, we have CDL-A openings near you! Reply STOP to opt out."
                            class="w-full px-3 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:border-green-500 resize-none"
                            oninput="updatePreview()"></textarea>
                        <p class="text-xs text-slate-500 mt-1">Use {{firstName}}, {{state}} for personalization. STOP
                            opt-out is auto-appended.</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="abEnabled" class="rounded" onchange="toggleAB()">
                            <span class="text-sm text-slate-300">A/B Test</span>
                        </label>
                    </div>
                    <div id="abSection" class="hidden">
                        <label class="text-xs font-medium text-slate-400 mb-1 block">Variant B Message</label>
                        <textarea id="campBodyB" rows="3" placeholder="Variant B message..."
                            class="w-full px-3 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:border-green-500 resize-none"></textarea>
                        <div class="flex items-center gap-2 mt-2">
                            <span class="text-xs text-slate-400">A/B Split:</span>
                            <input type="range" id="abSplit" min="10" max="90" value="50" class="flex-1">
                            <span id="abSplitLabel" class="text-xs text-slate-300">50/50</span>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <select id="campCdlClass"
                            class="px-3 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-sm text-slate-300 focus:outline-none focus:border-green-500">
                            <option value="">All CDL Classes</option>
                            <option value="A">CDL-A</option>
                            <option value="B">CDL-B</option>
                        </select>
                        <input id="campState" type="text" placeholder="State filter"
                            class="px-3 py-2.5 bg-slate-800 border border-slate-700 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:border-green-500">
                    </div>
                    <div>
                        <label class="text-xs font-medium text-slate-400 mb-1 block">Schedule</label>
                        <div class="flex gap-3">
                            <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="sched"
                                    value="immediate" checked class="text-green-500"><span
                                    class="text-sm text-slate-300">Now</span></label>
                            <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="sched"
                                    value="scheduled" class="text-green-500"><span
                                    class="text-sm text-slate-300">Schedule</span></label>
                        </div>
                        <input id="schedTime" type="datetime-local"
                            class="mt-2 px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-sm text-white focus:outline-none focus:border-green-500 hidden w-full">
                    </div>
                </div>
                <!-- Right: Preview -->
                <div class="flex flex-col items-center">
                    <p class="text-xs font-medium text-slate-400 mb-3">Live Preview</p>
                    <div class="phone-preview">
                        <div class="flex items-center gap-2 mb-4">
                            <div class="w-6 h-6 rounded-full bg-green-600 flex items-center justify-center"><i
                                    class="fas fa-truck text-white text-xs"></i></div>
                            <span class="text-xs text-slate-300 font-medium">LMDR Recruiting</span>
                        </div>
                        <div class="sms-bubble text-white" id="smsPreview">Your message will appear here...</div>
                        <p class="text-xs text-slate-500 mt-3 text-center">Reply STOP to opt out</p>
                    </div>
                    <div class="mt-4 p-3 bg-slate-800/50 rounded-lg w-full">
                        <p class="text-xs text-slate-400 mb-1">Estimated Audience</p>
                        <p class="text-lg font-bold text-white" id="audienceEst">—</p>
                        <p class="text-xs text-slate-500">drivers with phone numbers</p>
                    </div>
                </div>
            </div>
            <div class="flex gap-3 p-5 border-t border-slate-700/50">
                <button onclick="closeModal()"
                    class="flex-1 px-4 py-2 rounded-lg border border-slate-600 text-slate-300 text-sm">Cancel</button>
                <button onclick="saveCampaign('draft')"
                    class="px-4 py-2 rounded-lg border border-green-600 text-green-400 text-sm">Save Draft</button>
                <button onclick="saveCampaign('send')"
                    class="btn-primary flex-1 px-4 py-2 rounded-lg text-white text-sm font-medium"><i
                        class="fas fa-paper-plane mr-2"></i>Send Campaign</button>
            </div>
        </div>
    </div>

    <script>
        let carrierDot = '', campaigns = [];

        window.addEventListener('message', (e) => {
            const { type, data } = e.data || {};
            if (type === 'INIT') { carrierDot = data.carrierDot || ''; loadCampaigns(); }
            if (type === 'SMS_CAMPAIGNS_LOADED') renderCampaigns(data.campaigns || []);
            if (type === 'SMS_CAMPAIGN_CREATED') { closeModal(); loadCampaigns(); showToast('Campaign created!', 'success'); }
            if (type === 'ERROR') showToast(data.message || 'Error', 'error');
        });

        function postToVelo(type, data) { window.parent.postMessage({ type, data }, '*'); }
        function loadCampaigns() { postToVelo('GET_SMS_CAMPAIGNS', { carrierDot }); }

        function renderCampaigns(data) {
            campaigns = data;
            const tbody = document.getElementById('campaignTableBody');
            if (!data.length) { tbody.innerHTML = '<tr><td colspan="7" class="text-center py-12 text-slate-500"><i class="fas fa-sms text-3xl mb-3 block opacity-30"></i><p class="text-sm">No SMS campaigns yet.</p></td></tr>'; return; }
            const colors = { draft: 'bg-slate-700 text-slate-300', sent: 'bg-green-500/20 text-green-400', sending: 'bg-blue-500/20 text-blue-400', scheduled: 'bg-yellow-500/20 text-yellow-400', paused: 'bg-orange-500/20 text-orange-400' };
            tbody.innerHTML = data.map(c => `<tr class="border-b border-slate-700/30 hover:bg-slate-800/30 cursor-pointer">
    <td class="px-4 py-3"><p class="text-sm font-medium text-white">${c.campaign_name}</p><p class="text-xs text-slate-400">${c.segments_per_message || 1} segment(s)</p></td>
    <td class="px-4 py-3"><span class="status-badge ${colors[c.status] || 'bg-slate-700 text-slate-300'}">${c.status}</span></td>
    <td class="px-4 py-3 text-right text-sm text-slate-300">${(c.audience_count || 0).toLocaleString()}</td>
    <td class="px-4 py-3 text-right text-sm text-green-400">${c.sent_count ? Math.round((c.sent_count / c.audience_count) * 100) + '%' : '—'}</td>
    <td class="px-4 py-3 text-right text-sm text-blue-400">—</td>
    <td class="px-4 py-3 text-right text-sm text-yellow-400">$${(c.estimated_cost || 0).toFixed(2)}</td>
    <td class="px-4 py-3 text-right">${c.status === 'draft' ? `<button onclick="postToVelo('SEND_SMS_CAMPAIGN',{campaignId:'${c._id}'})" class="px-3 py-1 rounded text-xs bg-green-600 text-white hover:bg-green-700">Send</button>` : ''}</td>
  </tr>`).join('');
            document.getElementById('statSent').textContent = data.reduce((s, c) => s + (c.sent_count || 0), 0).toLocaleString();
        }

        document.getElementById('newCampaignBtn').addEventListener('click', () => document.getElementById('campaignModal').classList.remove('hidden'));
        function closeModal() { document.getElementById('campaignModal').classList.add('hidden'); }

        document.querySelectorAll('input[name="sched"]').forEach(r => r.addEventListener('change', () => document.getElementById('schedTime').classList.toggle('hidden', r.value !== 'scheduled')));
        document.getElementById('abSplit').addEventListener('input', function () { const v = this.value; document.getElementById('abSplitLabel').textContent = v + '/' + (100 - v); });
        function toggleAB() { document.getElementById('abSection').classList.toggle('hidden', !document.getElementById('abEnabled').checked); }

        function updatePreview() {
            const body = document.getElementById('campBody').value || 'Your message will appear here...';
            document.getElementById('smsPreview').textContent = body;
            const len = body.length;
            const counter = document.getElementById('charCount');
            counter.textContent = len + '/160';
            counter.className = 'text-xs char-counter ' + (len > 160 ? 'text-red-400' : len > 120 ? 'text-yellow-400' : 'text-slate-400');
        }

        function saveCampaign(action) {
            const sched = document.querySelector('input[name="sched"]:checked')?.value || 'immediate';
            const abOn = document.getElementById('abEnabled').checked;
            const split = parseInt(document.getElementById('abSplit').value) || 50;
            const data = { carrierDot, campaignName: document.getElementById('campName').value, messageBody: document.getElementById('campBody').value, messageBodyB: abOn ? document.getElementById('campBodyB').value : '', abTestEnabled: abOn, abSplitPercent: split, audienceFilter: { cdlClass: document.getElementById('campCdlClass').value, state: document.getElementById('campState').value }, scheduleType: sched, scheduledTime: sched === 'scheduled' ? document.getElementById('schedTime').value : null };
            postToVelo(action === 'send' ? 'SEND_SMS_CAMPAIGN_NEW' : 'CREATE_SMS_CAMPAIGN', data);
        }

        function showToast(msg, type = 'info') {
            const colors = { success: 'bg-green-600', error: 'bg-red-600', info: 'bg-blue-600' };
            const t = document.createElement('div');
            t.className = `fixed bottom-4 right-4 ${colors[type]} text-white px-4 py-2.5 rounded-lg text-sm font-medium shadow-lg z-50`;
            t.textContent = msg; document.body.appendChild(t); setTimeout(() => t.remove(), 3000);
        }
    </script>
</body>

</html>