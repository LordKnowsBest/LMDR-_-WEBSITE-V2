<!DOCTYPE html>
<html lang="en" class="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recruiter Leaderboard | VelocityMatch</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        lmdr: {
                            blue: '#2563eb',
                            dark: '#0f172a',
                            yellow: '#fbbf24',
                            canvas: '#f1f5f9'
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        .podium-1 {
            @apply bg-gradient-to-b from-yellow-400 to-amber-500;
        }
        .podium-2 {
            @apply bg-gradient-to-b from-slate-300 to-slate-400;
        }
        .podium-3 {
            @apply bg-gradient-to-b from-amber-500 to-amber-700;
        }

        .crown-gold { @apply text-yellow-500; }
        .crown-silver { @apply text-slate-400; }
        .crown-bronze { @apply text-amber-600; }

        .rank-change-up { @apply text-green-500; }
        .rank-change-down { @apply text-red-500; }
        .rank-change-same { @apply text-slate-400; }

        .tab-btn {
            @apply px-4 py-2 text-sm font-bold rounded-lg transition;
        }
        .tab-btn.active {
            @apply bg-white text-purple-600 shadow-sm;
        }
        .tab-btn:not(.active) {
            @apply text-slate-500 hover:text-slate-700;
        }

        .period-btn {
            @apply px-3 py-1.5 text-xs font-bold rounded-lg transition;
        }
        .period-btn.active {
            @apply bg-purple-600 text-white;
        }
        .period-btn:not(.active) {
            @apply bg-slate-100 text-slate-600 hover:bg-slate-200;
        }

        .leaderboard-row {
            @apply flex items-center gap-4 p-4 bg-white rounded-xl border border-slate-100 transition;
        }
        .leaderboard-row:hover {
            @apply border-purple-200 shadow-sm;
        }
        .leaderboard-row.current-user {
            @apply bg-purple-50 border-purple-200 ring-2 ring-purple-100;
        }

        /* Dark mode */
        html.dark body { background: #0f172a; }
        html.dark .bg-white { background-color: #1e293b; }
        html.dark .bg-slate-50 { background-color: #0f172a; }
        html.dark .bg-slate-100 { background-color: #1e293b; }
        html.dark .text-slate-900 { color: #f1f5f9; }
        html.dark .text-slate-700 { color: #cbd5e1; }
        html.dark .text-slate-500 { color: #94a3b8; }
        html.dark .text-slate-400 { color: #64748b; }
        html.dark .border-slate-100 { border-color: #334155; }
        html.dark .border-slate-200 { border-color: #475569; }
        html.dark .leaderboard-row { background-color: #1e293b; border-color: #334155; }
        html.dark .leaderboard-row:hover { border-color: #7c3aed; }
        html.dark .leaderboard-row.current-user { background-color: rgba(139, 92, 246, 0.1); border-color: #7c3aed; }
        html.dark .tab-btn.active { background-color: #1e293b; color: #a78bfa; }
        html.dark .period-btn:not(.active) { background-color: #334155; color: #94a3b8; }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/recruiter/recruiter-design-system.css">
</head>

<body class="text-slate-800 antialiased min-h-screen p-4 md:p-8 pt-safe pb-safe">

    <div class="max-w-4xl mx-auto">

        <!-- HEADER -->
        <header class="mb-8">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h1 class="text-2xl md:text-3xl font-black text-slate-900 mb-1">Leaderboard</h1>
                    <p class="text-slate-500 text-sm font-medium">See how you rank against other recruiters</p>
                </div>
                <button onclick="refreshLeaderboard()"
                    class="p-2 rounded-lg hover:bg-slate-100 text-slate-400 transition" title="Refresh">
                    <i class="fa-solid fa-arrows-rotate"></i>
                </button>
            </div>

            <!-- LEADERBOARD TYPE TABS -->
            <div class="flex gap-2 p-1 bg-slate-100 rounded-xl mb-4">
                <button onclick="setType('overall')" class="tab-btn active flex-1" data-type="overall">
                    <i class="fa-solid fa-trophy mr-1.5"></i>Overall
                </button>
                <button onclick="setType('hires')" class="tab-btn flex-1" data-type="hires">
                    <i class="fa-solid fa-user-check mr-1.5"></i>Hires
                </button>
                <button onclick="setType('response_time')" class="tab-btn flex-1" data-type="response_time">
                    <i class="fa-solid fa-bolt mr-1.5"></i>Speed
                </button>
                <button onclick="setType('retention')" class="tab-btn flex-1" data-type="retention">
                    <i class="fa-solid fa-heart mr-1.5"></i>Retention
                </button>
            </div>

            <!-- PERIOD SELECTOR -->
            <div class="flex justify-center gap-2">
                <button onclick="setPeriod('weekly')" class="period-btn active" data-period="weekly">This Week</button>
                <button onclick="setPeriod('monthly')" class="period-btn" data-period="monthly">This Month</button>
                <button onclick="setPeriod('all_time')" class="period-btn" data-period="all_time">All Time</button>
            </div>
        </header>

        <!-- LOADING STATE -->
        <div id="loading-state" class="py-20 text-center">
            <div
                class="w-12 h-12 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-4">
            </div>
            <p class="text-slate-400 font-medium">Loading leaderboard...</p>
        </div>

        <!-- MAIN CONTENT -->
        <div id="main-content" class="hidden">

            <!-- TOP 3 PODIUM -->
            <div id="podium" class="flex justify-center items-end gap-4 mb-8">
                <!-- 2nd Place -->
                <div class="text-center">
                    <div class="w-16 h-16 md:w-20 md:h-20 rounded-full bg-slate-200 mx-auto mb-2 flex items-center justify-center text-xl font-bold text-slate-500 border-4 border-slate-300"
                        id="podium-2-avatar">
                        --
                    </div>
                    <div class="text-sm font-bold text-slate-700 mb-1 truncate max-w-[100px]" id="podium-2-name">--
                    </div>
                    <div class="text-xs text-slate-500" id="podium-2-score">-- pts</div>
                    <div class="w-16 md:w-20 h-16 podium-2 rounded-t-lg mt-2 flex items-center justify-center">
                        <span class="text-2xl font-black text-white">2</span>
                    </div>
                </div>

                <!-- 1st Place -->
                <div class="text-center">
                    <i class="fa-solid fa-crown crown-gold text-2xl mb-2"></i>
                    <div class="w-20 h-20 md:w-24 md:h-24 rounded-full bg-yellow-100 mx-auto mb-2 flex items-center justify-center text-2xl font-bold text-yellow-600 border-4 border-yellow-400 shadow-lg shadow-yellow-200"
                        id="podium-1-avatar">
                        --
                    </div>
                    <div class="text-base font-bold text-slate-900 mb-1 truncate max-w-[120px]" id="podium-1-name">--
                    </div>
                    <div class="text-sm font-bold text-yellow-600" id="podium-1-score">-- pts</div>
                    <div
                        class="w-20 md:w-24 h-24 podium-1 rounded-t-lg mt-2 flex items-center justify-center shadow-lg">
                        <span class="text-3xl font-black text-white">1</span>
                    </div>
                </div>

                <!-- 3rd Place -->
                <div class="text-center">
                    <div class="w-16 h-16 md:w-20 md:h-20 rounded-full bg-amber-100 mx-auto mb-2 flex items-center justify-center text-xl font-bold text-amber-700 border-4 border-amber-500"
                        id="podium-3-avatar">
                        --
                    </div>
                    <div class="text-sm font-bold text-slate-700 mb-1 truncate max-w-[100px]" id="podium-3-name">--
                    </div>
                    <div class="text-xs text-slate-500" id="podium-3-score">-- pts</div>
                    <div class="w-16 md:w-20 h-12 podium-3 rounded-t-lg mt-2 flex items-center justify-center">
                        <span class="text-2xl font-black text-white">3</span>
                    </div>
                </div>
            </div>

            <!-- YOUR POSITION BANNER -->
            <div id="your-position-banner"
                class="hidden mb-6 p-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl text-white">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-full bg-white/20 flex items-center justify-center text-lg font-bold"
                            id="your-avatar">
                            --
                        </div>
                        <div>
                            <div class="text-sm opacity-80">Your Position</div>
                            <div class="text-2xl font-black" id="your-position">#--</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm opacity-80">Your Score</div>
                        <div class="text-xl font-bold" id="your-score">-- pts</div>
                    </div>
                </div>
                <div class="mt-3 pt-3 border-t border-white/20 flex items-center justify-between text-sm">
                    <span id="your-rank-change" class="flex items-center gap-1">
                        <i class="fa-solid fa-minus"></i> Same as last week
                    </span>
                    <span id="points-to-next">-- pts to next rank</span>
                </div>
            </div>

            <!-- LEADERBOARD LIST -->
            <div id="leaderboard-list" class="space-y-3">
                <!-- Rows rendered by JS -->
            </div>

            <!-- LOAD MORE -->
            <div id="load-more-container" class="hidden text-center mt-6">
                <button onclick="loadMore()"
                    class="px-6 py-3 bg-slate-100 text-slate-600 font-bold rounded-xl hover:bg-slate-200 transition">
                    Load More
                </button>
            </div>

            <!-- EMPTY STATE -->
            <div id="empty-state" class="hidden py-20 text-center">
                <div
                    class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6 text-slate-300 text-3xl">
                    <i class="fa-solid fa-trophy"></i>
                </div>
                <h2 class="text-xl font-bold text-slate-900 mb-2">No rankings yet</h2>
                <p class="text-slate-500 max-w-sm mx-auto">Be the first to make a hire and claim the top spot!</p>
            </div>

        </div>

    </div>

    <script>
        // ==========================================
        // STATE
        // ==========================================
        let currentType = 'overall';
        let currentPeriod = 'weekly';
        let leaderboardData = [];
        let currentUserPosition = null;
        let currentPage = 1;
        let hasMore = false;

        // ==========================================
        // MESSAGE HANDLING
        // ==========================================
        function isValidOrigin(event) {
            if (window.parent === window) return false;
            if (event.source !== window.parent) return false;
            return true;
        }

        function validateMessageSchema(msg) {
            if (!msg || typeof msg !== 'object') return false;
            if (typeof msg.type !== 'string' || msg.type.length === 0) return false;
            return true;
        }

        function stripHtml(str) {
            if (typeof str !== 'string') return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function sendToVelo(type, data = {}) {
            console.log(`ðŸ“¤ [HTMLâ†’Velo] ${type}`, data);
            window.parent.postMessage({ type, data }, '*');
        }

        window.addEventListener('message', (event) => {
            if (!isValidOrigin(event)) return;
            const msg = event.data;
            if (!validateMessageSchema(msg)) return;

            console.log(`ðŸ“¥ [Veloâ†’HTML] ${msg.type}`, msg.data);

            switch (msg.type) {
                case 'leaderboardData':
                    handleLeaderboardData(msg.data);
                    break;
                case 'leaderboardPage':
                    handleLeaderboardPage(msg.data);
                    break;
                case 'error':
                    console.error('Leaderboard error:', msg.data?.message);
                    break;
            }
        });

        console.log('LMDR Recruiter Leaderboard Ready');
        sendToVelo('leaderboardReady');

        // ==========================================
        // DATA HANDLERS
        // ==========================================
        function handleLeaderboardData(data) {
            if (!data) return;

            leaderboardData = data.rankings || [];
            currentUserPosition = data.currentUser || null;
            hasMore = data.hasMore || false;
            currentPage = 1;

            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');

            if (leaderboardData.length === 0) {
                document.getElementById('empty-state').classList.remove('hidden');
                document.getElementById('podium').classList.add('hidden');
                document.getElementById('leaderboard-list').classList.add('hidden');
            } else {
                document.getElementById('empty-state').classList.add('hidden');
                document.getElementById('podium').classList.remove('hidden');
                document.getElementById('leaderboard-list').classList.remove('hidden');
                renderPodium();
                renderCurrentUser();
                renderLeaderboard();
            }

            document.getElementById('load-more-container').classList.toggle('hidden', !hasMore);
        }

        function handleLeaderboardPage(data) {
            if (!data || !data.rankings) return;

            leaderboardData = [...leaderboardData, ...data.rankings];
            hasMore = data.hasMore || false;
            currentPage++;

            renderLeaderboard();
            document.getElementById('load-more-container').classList.toggle('hidden', !hasMore);
        }

        // ==========================================
        // RENDER FUNCTIONS
        // ==========================================
        function renderPodium() {
            const top3 = leaderboardData.slice(0, 3);

            // 1st place
            if (top3[0]) {
                document.getElementById('podium-1-avatar').textContent = getInitials(top3[0].name);
                document.getElementById('podium-1-name').textContent = top3[0].name || 'Unknown';
                document.getElementById('podium-1-score').textContent = formatScore(top3[0].score);
            }

            // 2nd place
            if (top3[1]) {
                document.getElementById('podium-2-avatar').textContent = getInitials(top3[1].name);
                document.getElementById('podium-2-name').textContent = top3[1].name || 'Unknown';
                document.getElementById('podium-2-score').textContent = formatScore(top3[1].score);
            }

            // 3rd place
            if (top3[2]) {
                document.getElementById('podium-3-avatar').textContent = getInitials(top3[2].name);
                document.getElementById('podium-3-name').textContent = top3[2].name || 'Unknown';
                document.getElementById('podium-3-score').textContent = formatScore(top3[2].score);
            }
        }

        function renderCurrentUser() {
            const banner = document.getElementById('your-position-banner');

            if (!currentUserPosition) {
                banner.classList.add('hidden');
                return;
            }

            banner.classList.remove('hidden');

            document.getElementById('your-avatar').textContent = getInitials(currentUserPosition.name);
            document.getElementById('your-position').textContent = `#${currentUserPosition.position}`;
            document.getElementById('your-score').textContent = formatScore(currentUserPosition.score);

            // Rank change
            const changeEl = document.getElementById('your-rank-change');
            const change = currentUserPosition.rankChange || 0;

            if (change > 0) {
                changeEl.innerHTML = `<i class="fa-solid fa-arrow-up text-green-300"></i> Up ${change} from last week`;
            } else if (change < 0) {
                changeEl.innerHTML = `<i class="fa-solid fa-arrow-down text-red-300"></i> Down ${Math.abs(change)} from last week`;
            } else {
                changeEl.innerHTML = `<i class="fa-solid fa-minus"></i> Same as last week`;
            }

            // Points to next
            const pointsToNext = currentUserPosition.pointsToNext || 0;
            if (currentUserPosition.position === 1) {
                document.getElementById('points-to-next').textContent = 'You\'re #1!';
            } else {
                document.getElementById('points-to-next').textContent = `${pointsToNext} pts to next rank`;
            }
        }

        function renderLeaderboard() {
            const container = document.getElementById('leaderboard-list');

            // Skip top 3 since they're in the podium
            const rest = leaderboardData.slice(3);

            if (rest.length === 0) {
                container.innerHTML = '';
                return;
            }

            container.innerHTML = rest.map((entry, idx) => {
                const position = idx + 4;
                const isCurrentUser = currentUserPosition && entry._id === currentUserPosition._id;
                const change = entry.rankChange || 0;

                let changeIcon = '';
                let changeClass = 'rank-change-same';
                if (change > 0) {
                    changeIcon = '<i class="fa-solid fa-caret-up"></i>';
                    changeClass = 'rank-change-up';
                } else if (change < 0) {
                    changeIcon = '<i class="fa-solid fa-caret-down"></i>';
                    changeClass = 'rank-change-down';
                }

                return `
                    <div class="leaderboard-row ${isCurrentUser ? 'current-user' : ''}">
                        <div class="w-10 text-center">
                            <span class="text-lg font-black text-slate-400">${position}</span>
                        </div>
                        <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-sm font-bold text-slate-500">
                            ${getInitials(entry.name)}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="font-bold text-slate-900 truncate">${stripHtml(entry.name || 'Unknown')}</div>
                            <div class="text-xs text-slate-500">${entry.company || ''}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-slate-900">${formatScore(entry.score)}</div>
                            <div class="text-xs ${changeClass} flex items-center justify-end gap-1">
                                ${changeIcon}
                                ${change !== 0 ? Math.abs(change) : '-'}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ==========================================
        // HELPERS
        // ==========================================
        function getInitials(name) {
            if (!name) return '??';
            const parts = name.split(' ');
            if (parts.length >= 2) {
                return (parts[0][0] + parts[1][0]).toUpperCase();
            }
            return name.substring(0, 2).toUpperCase();
        }

        function formatScore(score) {
            if (currentType === 'response_time') {
                // Format as time
                if (score < 60) return `${score}m`;
                return `${(score / 60).toFixed(1)}h`;
            }
            if (currentType === 'retention') {
                return `${score}%`;
            }
            return `${(score || 0).toLocaleString()} pts`;
        }

        // ==========================================
        // ACTIONS
        // ==========================================
        function setType(type) {
            currentType = type;
            currentPage = 1;

            // Update tab styles
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.type === type);
            });

            // Show loading and fetch
            document.getElementById('main-content').classList.add('hidden');
            document.getElementById('loading-state').classList.remove('hidden');
            sendToVelo('getLeaderboard', { type, period: currentPeriod, page: 1 });
        }

        function setPeriod(period) {
            currentPeriod = period;
            currentPage = 1;

            // Update period styles
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.period === period);
            });

            // Show loading and fetch
            document.getElementById('main-content').classList.add('hidden');
            document.getElementById('loading-state').classList.remove('hidden');
            sendToVelo('getLeaderboard', { type: currentType, period, page: 1 });
        }

        function loadMore() {
            sendToVelo('getLeaderboard', {
                type: currentType,
                period: currentPeriod,
                page: currentPage + 1
            });
        }

        function refreshLeaderboard() {
            currentPage = 1;
            document.getElementById('main-content').classList.add('hidden');
            document.getElementById('loading-state').classList.remove('hidden');
            sendToVelo('getLeaderboard', { type: currentType, period: currentPeriod, page: 1 });
        }

        // ==========================================
        // THEME
        // ==========================================
        const THEME_KEY = 'lmdr-recruiter-theme';

        function initTheme() {
            const saved = localStorage.getItem(THEME_KEY);
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = saved || (prefersDark ? 'dark' : 'light');
            applyTheme(theme);
        }

        function applyTheme(theme) {
            document.documentElement.classList.remove('light', 'dark');
            document.documentElement.classList.add(theme);
        }

        window.addEventListener('message', (event) => {
            if (event.data?.type === 'themeChange') {
                applyTheme(event.data.theme);
            }
        });

        initTheme();
    </script>

</body>

</html>


