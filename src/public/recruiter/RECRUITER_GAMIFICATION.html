<!DOCTYPE html>
<html lang="en" class="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recruiter Gamification | VelocityMatch</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        lmdr: {
                            blue: '#2563eb',
                            dark: '#0f172a',
                            yellow: '#fbbf24',
                            canvas: '#f1f5f9'
                        },
                        rank: {
                            associate: '#64748b',
                            specialist: '#3b82f6',
                            senior: '#8b5cf6',
                            lead: '#f59e0b',
                            director: '#ef4444',
                            vp: '#ec4899'
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        body {
            font-family: 'Inter', sans-serif;
            background-color: transparent;
        }

        .points-bar {
            @apply h-3 rounded-full bg-slate-200 overflow-hidden;
        }

        .points-bar-fill {
            @apply h-full rounded-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-500;
        }

        .badge-showcase {
            @apply flex items-center justify-center w-14 h-14 rounded-xl text-2xl;
        }

        .badge-tier-bronze { @apply bg-gradient-to-br from-amber-600 to-amber-800 text-amber-100; }
        .badge-tier-silver { @apply bg-gradient-to-br from-slate-300 to-slate-500 text-white; }
        .badge-tier-gold { @apply bg-gradient-to-br from-yellow-400 to-amber-500 text-white shadow-lg shadow-amber-200; }
        .badge-tier-platinum { @apply bg-gradient-to-br from-slate-100 to-slate-300 text-slate-700 ring-2 ring-slate-400; }

        .rank-badge {
            @apply inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold;
        }

        .rank-associate { @apply bg-slate-100 text-slate-600; }
        .rank-specialist { @apply bg-blue-100 text-blue-700; }
        .rank-senior { @apply bg-purple-100 text-purple-700; }
        .rank-lead { @apply bg-amber-100 text-amber-700; }
        .rank-director { @apply bg-red-100 text-red-700; }
        .rank-vp { @apply bg-gradient-to-r from-pink-500 to-rose-500 text-white; }

        .leaderboard-position {
            @apply text-4xl font-black;
        }

        .position-1 { @apply text-yellow-500; }
        .position-2 { @apply text-slate-400; }
        .position-3 { @apply text-amber-600; }
        .position-other { @apply text-slate-700; }

        .card {
            @apply bg-white rounded-2xl p-5 shadow-sm border border-slate-100;
        }

        .card-header {
            @apply flex items-center justify-between mb-4;
        }

        .card-title {
            @apply text-sm font-bold text-slate-400 uppercase tracking-wider;
        }

        .stat-card {
            @apply bg-slate-50 rounded-xl p-4 text-center;
        }

        .challenge-progress-bar {
            @apply h-2 rounded-full bg-slate-200 overflow-hidden;
        }

        .challenge-progress-fill {
            @apply h-full rounded-full transition-all duration-300;
        }

        .challenge-daily { @apply bg-blue-100 text-blue-700; }
        .challenge-weekly { @apply bg-purple-100 text-purple-700; }
        .challenge-monthly { @apply bg-amber-100 text-amber-700; }
        .challenge-event { @apply bg-gradient-to-r from-pink-500 to-rose-500 text-white; }

        /* Dark mode */
        html.dark body { background: transparent; }
        html.dark .card { background-color: #1e293b; border-color: #334155; }
        html.dark .card-title { color: #64748b; }
        html.dark .stat-card { background-color: #0f172a; }
        html.dark .text-slate-900 { color: #f1f5f9; }
        html.dark .text-slate-700 { color: #cbd5e1; }
        html.dark .text-slate-500 { color: #94a3b8; }
        html.dark .text-slate-400 { color: #64748b; }
        html.dark .bg-slate-50 { background-color: #0f172a; }
        html.dark .bg-slate-100 { background-color: #1e293b; }
        html.dark .bg-slate-200 { background-color: #334155; }
        html.dark .border-slate-100 { border-color: #334155; }
        html.dark .border-slate-200 { border-color: #475569; }
        html.dark .points-bar { background-color: #334155; }
        html.dark .challenge-progress-bar { background-color: #334155; }
        html.dark .position-other { color: #e2e8f0; }
    </style>
</head>

<body class="text-slate-800 antialiased p-4">

    <!-- Branding Header -->
    <div class="flex items-center gap-2 mb-4 opacity-70 px-1">
        <div class="h-5 w-5 bg-gradient-to-br from-blue-600 to-indigo-600 rounded flex items-center justify-center text-white font-black text-[10px]">VM</div>
        <span class="font-bold text-slate-400 text-[10px] tracking-wider uppercase">VelocityMatch Recruiter OS</span>
    </div>

    <!-- LOADING STATE -->
    <div id="loading-state" class="py-12 text-center">
        <div class="w-10 h-10 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-3"></div>
        <p class="text-slate-400 text-sm font-medium">Loading your stats...</p>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main-content" class="hidden space-y-4">

        <!-- RANK & POINTS WIDGET -->
        <div class="card" id="progression-widget">
            <div class="flex items-start justify-between gap-4">
                <!-- Rank & Points -->
                <div class="flex-1">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-purple-500 to-pink-600 flex items-center justify-center text-white shadow-lg shadow-purple-200" id="rank-icon">
                            <i class="fa-solid fa-crown text-2xl"></i>
                        </div>
                        <div>
                            <span class="rank-badge rank-associate" id="rank-badge">
                                <i class="fa-solid fa-briefcase"></i>
                                <span id="rank-title">Associate</span>
                            </span>
                            <div class="text-xs text-slate-400 mt-1" id="rank-label">0 Points</div>
                        </div>
                    </div>

                    <!-- Points Bar -->
                    <div class="mb-1">
                        <div class="flex justify-between text-xs mb-1">
                            <span class="font-bold text-slate-600" id="points-current">0 Points</span>
                            <span class="text-slate-400" id="points-next">1,000 to Specialist</span>
                        </div>
                        <div class="points-bar">
                            <div class="points-bar-fill" id="points-fill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- Leaderboard Position -->
                <div class="text-center px-5 py-3 bg-slate-50 rounded-xl border border-slate-100 cursor-pointer hover:border-purple-300 transition" onclick="viewLeaderboard()" id="leaderboard-widget">
                    <div class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1">Rank</div>
                    <div class="leaderboard-position position-other" id="leaderboard-position">#--</div>
                    <div class="text-[10px] text-slate-400 mt-1" id="leaderboard-period">This Week</div>
                </div>
            </div>
        </div>

        <!-- BADGES SHOWCASE -->
        <div class="card" id="badges-widget">
            <div class="card-header">
                <span class="card-title">
                    <i class="fa-solid fa-shield-halved mr-1.5"></i>Your Badges
                </span>
                <button onclick="viewAllBadges()" class="text-xs font-bold text-purple-600 hover:underline">View All</button>
            </div>

            <div id="badges-grid" class="grid grid-cols-4 gap-3">
                <!-- Badges rendered by JS -->
            </div>

            <div id="badges-empty" class="hidden text-center py-6 text-slate-400 text-sm">
                <i class="fa-solid fa-shield mb-2 block text-2xl opacity-30"></i>
                Complete actions to earn badges!
            </div>
        </div>

        <!-- THIS WEEK'S STATS -->
        <div class="card" id="stats-widget">
            <div class="card-header">
                <span class="card-title">
                    <i class="fa-solid fa-chart-line mr-1.5"></i>This Week
                </span>
            </div>

            <div class="grid grid-cols-4 gap-3">
                <div class="stat-card">
                    <div class="text-2xl font-black text-slate-900" id="stat-hires">0</div>
                    <div class="text-[10px] font-bold text-slate-400 uppercase">Hires</div>
                </div>
                <div class="stat-card">
                    <div class="text-2xl font-black text-slate-900" id="stat-responses">0</div>
                    <div class="text-[10px] font-bold text-slate-400 uppercase">Responses</div>
                </div>
                <div class="stat-card">
                    <div class="text-2xl font-black text-slate-900" id="stat-interviews">0</div>
                    <div class="text-[10px] font-bold text-slate-400 uppercase">Interviews</div>
                </div>
                <div class="stat-card">
                    <div class="text-2xl font-black text-slate-900" id="stat-messages">0</div>
                    <div class="text-[10px] font-bold text-slate-400 uppercase">Messages</div>
                </div>
            </div>

            <!-- Points Earned This Week -->
            <div class="mt-4 p-3 bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-100 rounded-xl flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <i class="fa-solid fa-bolt text-purple-500"></i>
                    <span class="text-sm font-bold text-purple-700">Points This Week</span>
                </div>
                <span class="text-lg font-black text-purple-600" id="stat-points-week">+0</span>
            </div>
        </div>

        <!-- ACTIVE CHALLENGES -->
        <div class="card" id="challenges-widget">
            <div class="card-header">
                <span class="card-title">
                    <i class="fa-solid fa-bullseye mr-1.5"></i>Active Challenges
                </span>
                <button onclick="viewAllChallenges()" class="text-xs font-bold text-purple-600 hover:underline">View All</button>
            </div>

            <div id="challenges-list" class="space-y-3">
                <!-- Challenges rendered by JS -->
            </div>
        </div>

    </div>

    <!-- TOAST CONTAINER -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

    <!-- CELEBRATION MODAL -->
    <div id="celebration-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4">
        <div class="bg-white rounded-3xl shadow-2xl max-w-sm w-full p-8 text-center animate-bounce-in">
            <div class="w-20 h-20 mx-auto mb-4 rounded-full flex items-center justify-center text-4xl" id="celebration-icon"></div>
            <h2 class="text-2xl font-black text-slate-900 mb-2" id="celebration-title">Congratulations!</h2>
            <p class="text-slate-500 mb-6" id="celebration-message">You've achieved something great!</p>
            <div class="text-sm font-bold text-purple-600 mb-6" id="celebration-reward">+100 Points</div>
            <button onclick="closeCelebration()" class="w-full py-3 bg-lmdr-dark text-white rounded-xl font-bold hover:bg-slate-800 transition">
                Awesome!
            </button>
        </div>
    </div>

    <style>
        @keyframes bounce-in {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-bounce-in { animation: bounce-in 0.4s ease-out; }
    </style>

    <script>
        // ==========================================
        // STATE
        // ==========================================
        let progression = null;
        let badges = [];
        let weeklyStats = null;
        let leaderboard = null;
        let challenges = [];

        const RANK_STYLES = {
            'Associate': 'rank-associate',
            'Recruiting Associate': 'rank-associate',
            'Specialist': 'rank-specialist',
            'Recruiting Specialist': 'rank-specialist',
            'Senior': 'rank-senior',
            'Senior Recruiter': 'rank-senior',
            'Lead': 'rank-lead',
            'Lead Recruiter': 'rank-lead',
            'Director': 'rank-director',
            'Recruiting Director': 'rank-director',
            'VP': 'rank-vp',
            'VP of Recruiting': 'rank-vp'
        };

        const BADGE_TIERS = {
            'bronze': 'badge-tier-bronze',
            'silver': 'badge-tier-silver',
            'gold': 'badge-tier-gold',
            'platinum': 'badge-tier-platinum'
        };

        const CHALLENGE_STYLES = {
            'daily': 'challenge-daily',
            'weekly': 'challenge-weekly',
            'monthly': 'challenge-monthly',
            'event': 'challenge-event'
        };

        // ==========================================
        // MESSAGE HANDLING
        // ==========================================
        const MESSAGE_REGISTRY = {
            inbound: [
                'recruiterGamificationData',
                'progressionUpdate',
                'badgeEarned',
                'rankUp',
                'leaderboardUpdate',
                'pointsAwarded',
                'challengeUpdate',
                'challengeComplete',
                'error',
                'pong'
            ],
            outbound: [
                'recruiterGamificationReady',
                'refreshGamification',
                'viewLeaderboard',
                'viewBadges',
                'viewChallenges',
                'claimReward',
                'ping'
            ]
        };

        function isValidOrigin(event) {
            if (window.parent === window) return false;
            if (event.source !== window.parent) return false;
            return true;
        }

        function validateMessageSchema(msg) {
            if (!msg || typeof msg !== 'object') return false;
            if (typeof msg.type !== 'string' || msg.type.length === 0) return false;
            return true;
        }

        function stripHtml(str) {
            if (typeof str !== 'string') return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function sendToVelo(type, data = {}) {
            console.log(`ðŸ“¤ [HTMLâ†’Velo] ${type}`, data);
            window.parent.postMessage({ type, data }, '*');
        }

        window.addEventListener('message', (event) => {
            if (!isValidOrigin(event)) return;
            const msg = event.data;
            if (!validateMessageSchema(msg)) return;

            console.log(`ðŸ“¥ [Veloâ†’HTML] ${msg.type}`, msg.data);

            switch (msg.type) {
                case 'recruiterGamificationData':
                    handleGamificationData(msg.data);
                    break;
                case 'progressionUpdate':
                    updateProgression(msg.data);
                    break;
                case 'badgeEarned':
                    showBadgeEarned(msg.data);
                    break;
                case 'rankUp':
                    showRankUp(msg.data);
                    break;
                case 'leaderboardUpdate':
                    updateLeaderboard(msg.data);
                    break;
                case 'pointsAwarded':
                    showPointsToast(msg.data);
                    break;
                case 'challengeUpdate':
                    updateChallenge(msg.data);
                    break;
                case 'challengeComplete':
                    showChallengeComplete(msg.data);
                    break;
                case 'error':
                    console.error('Gamification error:', msg.data?.message);
                    break;
            }
        });

        console.log('LMDR Recruiter Gamification Widget Ready');
        sendToVelo('recruiterGamificationReady');

        // ==========================================
        // DATA HANDLERS
        // ==========================================
        function handleGamificationData(data) {
            if (!data) return;

            progression = data.progression;
            badges = data.badges || [];
            weeklyStats = data.weeklyStats || {};
            leaderboard = data.leaderboard;
            challenges = data.challenges || [];

            document.getElementById('loading-state').classList.add('hidden');
            document.getElementById('main-content').classList.remove('hidden');

            renderProgression();
            renderBadges();
            renderWeeklyStats();
            renderLeaderboard();
            renderChallenges();
        }

        // ==========================================
        // RENDER FUNCTIONS
        // ==========================================
        function renderProgression() {
            if (!progression) return;

            const rank = progression.rank || 'Associate';
            const points = progression.total_points || 0;
            const pointsForNext = progression.points_for_next_rank || 1000;
            const progressPercent = progression.progress_percent || 0;
            const nextRank = progression.next_rank || 'Specialist';

            // Rank badge
            const rankBadge = document.getElementById('rank-badge');
            rankBadge.className = `rank-badge ${RANK_STYLES[rank] || 'rank-associate'}`;
            document.getElementById('rank-title').textContent = rank;
            document.getElementById('rank-label').textContent = `${points.toLocaleString()} Points`;

            // Points bar
            document.getElementById('points-current').textContent = `${points.toLocaleString()} Points`;
            document.getElementById('points-next').textContent = `${pointsForNext.toLocaleString()} to ${nextRank}`;
            document.getElementById('points-fill').style.width = `${progressPercent}%`;
        }

        function renderBadges() {
            const grid = document.getElementById('badges-grid');
            const empty = document.getElementById('badges-empty');

            if (!badges || badges.length === 0) {
                grid.classList.add('hidden');
                empty.classList.remove('hidden');
                return;
            }

            grid.classList.remove('hidden');
            empty.classList.add('hidden');

            grid.innerHTML = badges.slice(0, 4).map(badge => {
                const tierStyle = BADGE_TIERS[badge.tier] || 'badge-tier-bronze';
                return `
                    <div class="text-center cursor-pointer group" onclick="showBadgeDetail('${badge._id}')" title="${stripHtml(badge.name)}">
                        <div class="badge-showcase mx-auto mb-2 ${tierStyle} group-hover:scale-110 transition-transform">
                            <i class="fa-solid ${badge.icon || 'fa-shield'}"></i>
                        </div>
                        <div class="text-[10px] font-bold text-slate-700 truncate">${stripHtml(badge.name)}</div>
                        <div class="text-[9px] font-bold uppercase ${tierStyle.replace('badge-tier-', 'text-')}">${badge.tier}</div>
                    </div>
                `;
            }).join('');
        }

        function renderWeeklyStats() {
            if (!weeklyStats) return;

            document.getElementById('stat-hires').textContent = weeklyStats.hires || 0;
            document.getElementById('stat-responses').textContent = weeklyStats.responses || 0;
            document.getElementById('stat-interviews').textContent = weeklyStats.interviews || 0;
            document.getElementById('stat-messages').textContent = weeklyStats.messages || 0;
            document.getElementById('stat-points-week').textContent = `+${(weeklyStats.points || 0).toLocaleString()}`;
        }

        function renderLeaderboard() {
            if (!leaderboard) return;

            const position = leaderboard.position || '--';
            const positionEl = document.getElementById('leaderboard-position');
            positionEl.textContent = `#${position}`;

            // Style based on position
            positionEl.className = 'leaderboard-position';
            if (position === 1) positionEl.classList.add('position-1');
            else if (position === 2) positionEl.classList.add('position-2');
            else if (position === 3) positionEl.classList.add('position-3');
            else positionEl.classList.add('position-other');

            document.getElementById('leaderboard-period').textContent = leaderboard.period || 'This Week';
        }

        function renderChallenges() {
            const container = document.getElementById('challenges-list');

            if (!challenges || challenges.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-6 text-slate-400 text-sm">
                        <i class="fa-solid fa-trophy mb-2 block text-2xl opacity-30"></i>
                        No active challenges
                    </div>
                `;
                return;
            }

            container.innerHTML = challenges.slice(0, 3).map(challenge => {
                const progress = challenge.progress || 0;
                const target = challenge.target || 1;
                const percent = Math.min((progress / target) * 100, 100);
                const typeStyle = CHALLENGE_STYLES[challenge.type] || 'challenge-daily';
                const isComplete = progress >= target;
                const canClaim = isComplete && !challenge.claimed;

                return `
                    <div class="p-3 bg-slate-50 rounded-xl border border-slate-100 ${isComplete ? 'ring-2 ring-purple-400 ring-opacity-50' : ''}">
                        <div class="flex items-start justify-between gap-3 mb-2">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-[10px] font-bold px-2 py-0.5 rounded-full ${typeStyle} uppercase">${challenge.type}</span>
                                    ${challenge.expires_in ? `<span class="text-[10px] text-slate-400"><i class="fa-regular fa-clock mr-1"></i>${challenge.expires_in}</span>` : ''}
                                </div>
                                <h4 class="text-sm font-bold text-slate-900">${stripHtml(challenge.title)}</h4>
                                <p class="text-xs text-slate-500 mt-0.5">${stripHtml(challenge.description || '')}</p>
                            </div>
                            <div class="text-right flex-shrink-0">
                                <div class="text-xs font-bold text-purple-600">+${challenge.points_reward} pts</div>
                                ${canClaim ? `
                                    <button onclick="claimReward('${challenge._id}')" class="mt-1 px-3 py-1 bg-purple-600 text-white text-xs font-bold rounded-lg hover:bg-purple-700 transition">
                                        Claim
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="challenge-progress-bar flex-1">
                                <div class="challenge-progress-fill ${isComplete ? 'bg-green-500' : 'bg-purple-500'}" style="width: ${percent}%"></div>
                            </div>
                            <span class="text-xs font-bold ${isComplete ? 'text-green-600' : 'text-slate-500'}">${progress}/${target}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ==========================================
        // UPDATE HANDLERS
        // ==========================================
        function updateProgression(data) {
            if (data) {
                progression = { ...progression, ...data };
                renderProgression();
            }
        }

        function updateLeaderboard(data) {
            if (data) {
                leaderboard = { ...leaderboard, ...data };
                renderLeaderboard();
            }
        }

        function updateChallenge(data) {
            if (!data || !data._id) return;
            const index = challenges.findIndex(c => c._id === data._id);
            if (index >= 0) {
                challenges[index] = { ...challenges[index], ...data };
            } else {
                challenges.unshift(data);
            }
            renderChallenges();
        }

        // ==========================================
        // CELEBRATIONS & TOASTS
        // ==========================================
        function showBadgeEarned(data) {
            showCelebration({
                icon: `<i class="fa-solid ${data.icon || 'fa-shield'} text-purple-500"></i>`,
                iconBg: 'bg-purple-100',
                title: 'Badge Earned!',
                message: `${data.name || 'New Badge'} - ${data.tier || 'Bronze'} Tier`,
                reward: `+${data.points_reward || 50} Points`
            });
            triggerConfetti();
        }

        function showRankUp(data) {
            showCelebration({
                icon: '<i class="fa-solid fa-crown text-amber-500"></i>',
                iconBg: 'bg-amber-100',
                title: 'Rank Up!',
                message: `You are now a ${data.rank || 'Specialist'}!`,
                reward: data.unlocks ? `Unlocked: ${data.unlocks}` : ''
            });
            triggerConfetti();
        }

        function showChallengeComplete(data) {
            showCelebration({
                icon: '<i class="fa-solid fa-check-circle text-green-500"></i>',
                iconBg: 'bg-green-100',
                title: 'Challenge Complete!',
                message: data.title || 'You completed a challenge!',
                reward: `+${data.points_reward || 100} Points`
            });
        }

        function showCelebration({ icon, iconBg, title, message, reward }) {
            const modal = document.getElementById('celebration-modal');
            document.getElementById('celebration-icon').innerHTML = icon;
            document.getElementById('celebration-icon').className = `w-20 h-20 mx-auto mb-4 rounded-full flex items-center justify-center text-4xl ${iconBg}`;
            document.getElementById('celebration-title').textContent = title;
            document.getElementById('celebration-message').textContent = message;
            document.getElementById('celebration-reward').textContent = reward;
            modal.classList.remove('hidden');
        }

        function closeCelebration() {
            document.getElementById('celebration-modal').classList.add('hidden');
        }

        function showPointsToast(data) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'bg-white rounded-xl shadow-lg border border-slate-100 p-4 flex items-center gap-3 animate-slide-in';
            toast.innerHTML = `
                <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center text-purple-600">
                    <i class="fa-solid fa-bolt"></i>
                </div>
                <div>
                    <div class="text-sm font-bold text-slate-900">+${data.points || 0} Points</div>
                    <div class="text-xs text-slate-500">${stripHtml(data.reason || 'Action completed')}</div>
                </div>
            `;
            container.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('animate-fade-out');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function triggerConfetti() {
            const colors = ['#a855f7', '#ec4899', '#fbbf24', '#10b981', '#3b82f6'];
            for (let i = 0; i < 50; i++) {
                const piece = document.createElement('div');
                piece.className = 'confetti-piece';
                piece.style.left = Math.random() * 100 + 'vw';
                piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                piece.style.animationDelay = Math.random() * 0.5 + 's';
                piece.style.animationDuration = (2 + Math.random() * 2) + 's';
                document.body.appendChild(piece);
                setTimeout(() => piece.remove(), 4000);
            }
        }

        // ==========================================
        // ACTIONS
        // ==========================================
        function viewLeaderboard() {
            sendToVelo('viewLeaderboard');
        }

        function viewAllBadges() {
            sendToVelo('viewBadges');
        }

        function viewAllChallenges() {
            sendToVelo('viewChallenges');
        }

        function claimReward(challengeId) {
            sendToVelo('claimReward', { challengeId });
        }

        function showBadgeDetail(badgeId) {
            console.log('Show badge:', badgeId);
        }

        // ==========================================
        // THEME
        // ==========================================
        const THEME_KEY = 'lmdr-recruiter-theme';

        function initTheme() {
            const saved = localStorage.getItem(THEME_KEY);
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = saved || (prefersDark ? 'dark' : 'light');
            applyTheme(theme);
        }

        function applyTheme(theme) {
            document.documentElement.classList.remove('light', 'dark');
            document.documentElement.classList.add(theme);
        }

        window.addEventListener('message', (event) => {
            if (event.data?.type === 'themeChange') {
                applyTheme(event.data.theme);
            }
        });

        initTheme();
    </script>

    <style>
        @keyframes slide-in {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fade-out {
            from { opacity: 1; }
            to { opacity: 0; transform: translateY(-10px); }
        }
        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        .animate-slide-in { animation: slide-in 0.3s ease-out; }
        .animate-fade-out { animation: fade-out 0.3s ease-out forwards; }
        .confetti-piece {
            position: fixed;
            width: 10px;
            height: 10px;
            top: -10px;
            animation: confetti 3s ease-in-out forwards;
        }
    </style>

</body>

</html>
