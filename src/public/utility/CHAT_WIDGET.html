<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
    <title>Support Widget</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'lmdr-blue': '#2563eb',
                        'lmdr-dark': '#0f172a'
                    }
                }
            }
        };
    </script>
</head>
<body class="bg-transparent font-sans">
    <!-- Floating Button -->
    <div id="supportLauncher" class="fixed bottom-6 right-6 z-50">
        <button onclick="SupportUI.toggle()" class="w-14 h-14 rounded-full bg-lmdr-blue text-white shadow-2xl flex items-center justify-center hover:scale-110 transition-transform duration-300 group">
            <span id="launcherIcon" class="material-symbols-outlined text-3xl group-hover:rotate-12 transition-transform">support_agent</span>
        </button>
    </div>

    <!-- Panel -->
    <div id="supportPanel" class="fixed bottom-24 right-6 w-[380px] h-[600px] bg-white rounded-3xl shadow-2xl border border-slate-100 overflow-hidden flex flex-col z-50 transform translate-y-10 opacity-0 pointer-events-none transition-all duration-300">
        <!-- Header -->
        <header class="bg-lmdr-blue p-6 text-white shrink-0">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-bold">LMDR Support</h3>
                <button onclick="SupportUI.toggle()" class="hover:bg-white/20 p-1 rounded-lg">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <p class="text-sm opacity-90">How can we help you today?</p>
        </header>

        <!-- Navigation / Content Area -->
        <div id="widgetContent" class="flex-1 overflow-y-auto bg-slate-50 scrollbar-hide">
            <!-- Home View -->
            <div id="viewHome" class="p-6 space-y-4">
                <button onclick="SupportUI.setView('chat')" class="w-full p-4 bg-white rounded-2xl border border-slate-100 shadow-sm flex items-center gap-4 hover:border-lmdr-blue transition-all group">
                    <div class="w-12 h-12 rounded-xl bg-blue-50 text-lmdr-blue flex items-center justify-center group-hover:bg-lmdr-blue group-hover:text-white transition-colors">
                        <span class="material-symbols-outlined">forum</span>
                    </div>
                    <div class="text-left">
                        <div class="font-bold text-slate-900">Chat with us</div>
                        <div class="text-xs text-slate-500">Instant help from our team</div>
                    </div>
                </button>

                <button onclick="SupportUI.setView('ticket')" class="w-full p-4 bg-white rounded-2xl border border-slate-100 shadow-sm flex items-center gap-4 hover:border-lmdr-blue transition-all group">
                    <div class="w-12 h-12 rounded-xl bg-purple-50 text-purple-600 flex items-center justify-center group-hover:bg-purple-600 group-hover:text-white transition-colors">
                        <span class="material-symbols-outlined">assignment</span>
                    </div>
                    <div class="text-left">
                        <div class="font-bold text-slate-900">Submit a Ticket</div>
                        <div class="text-xs text-slate-500">For less urgent inquiries</div>
                    </div>
                </button>

                <div class="pt-4">
                    <h4 class="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-3 px-2">Popular Articles</h4>
                    <div id="popularArticles" class="space-y-2">
                        <!-- Rendered articles -->
                    </div>
                </div>
            </div>

            <!-- Chat View -->
            <div id="viewChat" class="hidden flex flex-col h-full bg-white">
                <!-- Messages will go here -->
                <div id="chatMessages" class="flex-1 p-4 space-y-4 overflow-y-auto"></div>
                <div class="p-4 border-t border-slate-100">
                    <div class="relative">
                        <input id="chatInput" type="text" placeholder="Type a message..." class="w-full pl-4 pr-12 py-3 bg-slate-100 border-none rounded-2xl text-sm focus:ring-2 focus:ring-lmdr-blue" />
                        <button onclick="SupportUI.sendChatMessage()" class="absolute right-2 top-1/2 -translate-y-1/2 text-lmdr-blue p-2">
                            <span class="material-symbols-outlined">send</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Ticket View -->
            <div id="viewTicket" class="hidden p-6 bg-white h-full">
                <button onclick="SupportUI.setView('home')" class="text-xs font-bold text-lmdr-blue mb-6 flex items-center gap-1">
                    <span class="material-symbols-outlined text-sm">arrow_back</span>
                    Back to options
                </button>
                <h4 class="text-lg font-bold mb-4">Create a Ticket</h4>
                <form id="ticketForm" onsubmit="SupportUI.submitTicket(event)" class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">Subject</label>
                        <input type="text" name="subject" required class="w-full px-4 py-2 bg-slate-50 border-slate-100 rounded-xl text-sm" />
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">Category</label>
                        <select name="category" class="w-full px-4 py-2 bg-slate-50 border-slate-100 rounded-xl text-sm">
                            <option value="general">General Support</option>
                            <option value="billing">Billing Issue</option>
                            <option value="technical">Technical Bug</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1">Message</label>
                        <textarea name="description" rows="4" required class="w-full px-4 py-2 bg-slate-50 border-slate-100 rounded-xl text-sm"></textarea>
                    </div>
                    <button type="submit" class="w-full py-3 bg-lmdr-blue text-white font-bold rounded-xl shadow-lg shadow-blue-500/20 mt-4">Send Ticket</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        const SupportUI = {
            isOpen: false,
            currentView: 'home',
            
            toggle() {
                this.isOpen = !this.isOpen;
                const panel = document.getElementById('supportPanel');
                const icon = document.getElementById('launcherIcon');
                
                if (this.isOpen) {
                    panel.classList.remove('translate-y-10', 'opacity-0', 'pointer-events-none');
                    icon.textContent = 'close';
                } else {
                    panel.classList.add('translate-y-10', 'opacity-0', 'pointer-events-none');
                    icon.textContent = 'support_agent';
                }
            },

            setView(view) {
                this.currentView = view;
                ['viewHome', 'viewChat', 'viewTicket'].forEach(v => {
                    document.getElementById(v).classList.add('hidden');
                });
                document.getElementById('view' + view.charAt(0).toUpperCase() + view.slice(1)).classList.remove('hidden');
            },

            submitTicket(e) {
                e.preventDefault();
                const formData = new FormData(e.target);
                const data = {
                    subject: formData.get('subject'),
                    category: formData.get('category'),
                    description: formData.get('description')
                };
                window.parent.postMessage({ action: 'createTicket', ticketData: data }, '*');
                e.target.reset();
                this.setView('home');
                alert('Ticket submitted successfully!');
            }
        };
    </script>
</body>
</html>
