<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
    <title>VelocityMatch | Prompt Library</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>

    <!-- Tailwind CDN + INLINE config -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'primary': '#8b5cf6', 'primary-dark': '#7c3aed',
                        'background-dark': '#0f172a', 'background-light': '#f8fafc',
                        'surface-dark': '#1e293b', 'surface-light': '#ffffff',
                        'surface-darker': '#0f172a', 'border-dark': '#334155',
                        'border-light': '#e2e8f0', 'text-muted': '#94a3b8',
                        'lmdr-blue': '#2563eb', 'lmdr-deep': '#1e40af',
                        'lmdr-yellow': '#fbbf24', 'lmdr-dark': '#0f172a',
                        'beige': '#F5F5DC', 'beige-d': '#E8E0C8',
                        'tan': '#C8B896', 'ivory': '#FFFFF5', 'sg': '#859900'
                    },
                    fontFamily: {
                        'display': ['Inter', 'sans-serif'],
                        'mono': ['JetBrains Mono', 'monospace'],
                        'd': ['Inter', 'sans-serif']
                    }
                }
            }
        };
    </script>

    <!-- External CSS via CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/admin/css/admin-prompts.css"/>
</head>
<body class="font-display antialiased transition-colors duration-300 bg-background-dark text-white">

<!-- Toast Container -->
<div id="toastContainer" class="fixed top-4 right-4 left-4 md:left-auto z-[100] space-y-2"></div>

<!-- Main Container -->
<div class="flex flex-col h-full">

    <!-- Header -->
    <header class="flex-shrink-0 border-b border-border-dark bg-surface-darker px-4 md:px-6 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
                <span class="material-symbols-outlined text-primary text-[28px]">psychology</span>
                <div>
                    <h1 class="text-xl md:text-2xl font-black tracking-tight">Prompt Library</h1>
                    <p class="text-xs md:text-sm text-text-muted">Manage AI prompts (Super Admin)</p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="toggleTheme()" class="flex items-center justify-center w-10 h-10 rounded-lg bg-surface-dark border border-border-dark hover:bg-slate-700 transition-colors" title="Toggle theme">
                    <span id="themeIconSun" class="material-symbols-outlined text-[20px] text-amber-400 hidden">light_mode</span>
                    <span id="themeIconMoon" class="material-symbols-outlined text-[20px] text-slate-400">dark_mode</span>
                </button>
                <button onclick="openCreateModal()" class="flex items-center gap-2 px-4 py-2 bg-primary hover:bg-primary-dark rounded-lg font-medium text-sm transition-colors">
                    <span class="material-symbols-outlined text-[18px]">add</span>
                    New Prompt
                </button>
            </div>
        </div>
    </header>

    <!-- Toolbar -->
    <div class="flex-shrink-0 px-4 md:px-6 py-3 border-b border-border-dark bg-surface-dark">
        <div class="flex flex-wrap items-center gap-3">
            <select id="categoryFilter" onchange="filterPrompts()" class="bg-surface-darker border border-border-dark rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-primary">
                <option value="">All Categories</option>
            </select>
            <select id="statusFilter" onchange="filterPrompts()" class="bg-surface-darker border border-border-dark rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-primary">
                <option value="">All Status</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
            </select>
            <div class="flex-1 min-w-[200px]">
                <input type="text" id="searchInput" placeholder="Search prompts..."
                    class="w-full bg-surface-darker border border-border-dark rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-primary"
                    oninput="debounceSearch()">
            </div>
            <button onclick="seedDefaults()" class="flex items-center gap-2 px-3 py-2 bg-amber-600 hover:bg-amber-700 rounded-lg font-medium text-sm transition-colors">
                <span class="material-symbols-outlined text-[16px]">download</span>
                Seed Defaults
            </button>
        </div>
    </div>

    <!-- Content -->
    <div class="flex-1 overflow-y-auto scrollbar-thin">
        <div class="px-4 md:px-6 py-4 md:py-6">
            <div id="promptsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="text-center py-12 col-span-full text-text-muted">Loading prompts...</div>
            </div>
        </div>
    </div>
</div>

<!-- Edit/Create Modal -->
<div id="promptModal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeModal()"></div>
    <div class="absolute inset-4 md:inset-8 lg:inset-16 bg-surface-dark rounded-2xl border border-border-dark overflow-hidden flex flex-col">
        <div class="flex items-center justify-between px-6 py-4 border-b border-border-dark">
            <h2 id="modalTitle" class="text-lg font-bold">Create Prompt</h2>
            <button onclick="closeModal()" class="text-text-muted hover:text-white"><span class="material-symbols-outlined">close</span></button>
        </div>
        <div class="flex-1 overflow-y-auto scrollbar-thin p-6">
            <form id="promptForm" class="space-y-4">
                <input type="hidden" id="editingPromptId" value="">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-text-muted mb-1">Prompt ID</label>
                        <input type="text" id="promptIdInput" placeholder="carrier_synthesis" class="w-full bg-surface-darker border border-border-dark rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-primary font-mono">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-text-muted mb-1">Name</label>
                        <input type="text" id="promptNameInput" placeholder="Carrier Synthesis" class="w-full bg-surface-darker border border-border-dark rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-primary">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-text-muted mb-1">Category</label>
                        <select id="promptCategoryInput" class="w-full bg-surface-darker border border-border-dark rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-primary"></select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-text-muted mb-1">Provider</label>
                        <select id="promptProviderInput" class="w-full bg-surface-darker border border-border-dark rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-primary">
                            <option value="anthropic">Anthropic (Claude)</option>
                            <option value="openai">OpenAI (GPT)</option>
                            <option value="groq">Groq</option>
                            <option value="perplexity">Perplexity</option>
                            <option value="google">Google (Gemini)</option>
                            <option value="mistral">Mistral</option>
                            <option value="cohere">Cohere</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-text-muted mb-1">Model</label>
                        <input type="text" id="promptModelInput" placeholder="claude-sonnet-4-20250514" class="w-full bg-surface-darker border border-border-dark rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-primary font-mono">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-text-muted mb-1">Description</label>
                    <input type="text" id="promptDescInput" placeholder="What this prompt does..." class="w-full bg-surface-darker border border-border-dark rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-primary">
                </div>
                <div>
                    <label class="block text-sm font-medium text-text-muted mb-1">System Prompt</label>
                    <textarea id="systemPromptInput" rows="8" placeholder="You are a..." class="w-full bg-surface-darker border border-border-dark rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-primary code-editor resize-y"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-text-muted mb-1">
                        User Prompt Template
                        <span class="text-xs text-violet-400">(Use {{variable}} for placeholders)</span>
                    </label>
                    <textarea id="userPromptInput" rows="6" placeholder="Analyze {{carrierName}} with DOT {{dotNumber}}..." class="w-full bg-surface-darker border border-border-dark rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-primary code-editor resize-y"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-text-muted mb-1">Variables (comma-separated)</label>
                    <input type="text" id="promptVarsInput" placeholder="carrierName, dotNumber, location" class="w-full bg-surface-darker border border-border-dark rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-primary font-mono">
                </div>
                <div id="changeNoteWrapper" class="hidden">
                    <label class="block text-sm font-medium text-text-muted mb-1">Change Note</label>
                    <input type="text" id="changeNoteInput" placeholder="Describe what changed..." class="w-full bg-surface-darker border border-border-dark rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-primary">
                </div>
            </form>
        </div>
        <div class="flex items-center justify-end gap-3 px-6 py-4 border-t border-border-dark">
            <button onclick="closeModal()" class="px-4 py-2 text-text-muted hover:text-white font-medium text-sm transition-colors">Cancel</button>
            <button onclick="savePrompt()" class="px-4 py-2 bg-primary hover:bg-primary-dark rounded-lg font-medium text-sm transition-colors">Save Prompt</button>
        </div>
    </div>
</div>

<!-- Version History Modal -->
<div id="versionModal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeVersionModal()"></div>
    <div class="absolute inset-8 md:inset-16 bg-surface-dark rounded-2xl border border-border-dark overflow-hidden flex flex-col">
        <div class="flex items-center justify-between px-6 py-4 border-b border-border-dark">
            <h2 class="text-lg font-bold">Version History</h2>
            <button onclick="closeVersionModal()" class="text-text-muted hover:text-white"><span class="material-symbols-outlined">close</span></button>
        </div>
        <div id="versionList" class="flex-1 overflow-y-auto scrollbar-thin p-6">Loading versions...</div>
    </div>
</div>

<!-- Module Loading (ordered by dependency) -->
<script src="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/admin/js/admin-prompts-config.js"></script>
<script src="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/admin/js/admin-prompts-bridge.js"></script>
<script src="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/admin/js/admin-prompts-render.js"></script>
<script src="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/admin/js/admin-prompts-logic.js"></script>

<!-- Bootstrap -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        AdminPromptsLogic.exposeGlobals();
        AdminPromptsLogic.init();
    });
</script>
</body>
</html>
