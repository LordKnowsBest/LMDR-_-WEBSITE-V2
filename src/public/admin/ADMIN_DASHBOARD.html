<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
    <title>VelocityMatch Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        lmdr: { dark: '#0f172a', blue: '#2563eb', yellow: '#fbbf24', canvas: '#f8fafc' }
                    },
                    animation: { 'float': 'float 6s ease-in-out infinite' },
                    keyframes: { float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } } }
                }
            }
        };
    </script>

    <!-- External CSS via CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/admin/css/admin-dashboard.css" />
</head>

<body class="font-display antialiased transition-colors duration-300 bg-background-dark dark:bg-background-dark dark:text-white text-text-dark">

    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-4 right-4 left-4 md:left-auto z-[100] space-y-2"></div>

    <!-- Main Container -->
    <div class="flex flex-col h-full">

        <!-- Header -->
        <header class="flex-shrink-0 border-b border-border-dark bg-surface-darker px-4 md:px-6 py-4 safe-top">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-xl md:text-2xl font-black tracking-tight">Admin Dashboard</h1>
                    <p class="text-xs md:text-sm text-text-muted mt-0.5">System overview and management</p>
                </div>
                <div class="flex items-center gap-2 md:gap-3">
                    <div id="healthIndicator" class="hidden md:flex items-center gap-2 px-3 py-1.5 rounded-lg bg-surface-dark border border-border-dark">
                        <span class="w-2 h-2 rounded-full bg-emerald-400 pulse-dot"></span>
                        <span class="text-xs font-medium text-emerald-400">Healthy</span>
                    </div>
                    <button onclick="toggleTheme()" class="touch-target touch-active flex items-center justify-center w-10 h-10 rounded-lg bg-surface-dark border border-border-dark hover:bg-slate-700 transition-colors" title="Toggle light/dark mode">
                        <span id="themeIconSun" class="material-symbols-outlined text-[20px] text-amber-400 hidden">light_mode</span>
                        <span id="themeIconMoon" class="material-symbols-outlined text-[20px] text-slate-400">dark_mode</span>
                    </button>
                    <button onclick="refreshDashboard()" class="touch-target touch-active flex items-center justify-center w-10 h-10 rounded-lg bg-surface-dark border border-border-dark hover:bg-slate-700 transition-colors">
                        <span class="material-symbols-outlined text-[20px]">refresh</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Scrollable Content -->
        <div class="flex-1 overflow-y-auto scrollbar-thin">
            <div class="px-4 md:px-6 py-4 md:py-6 space-y-4 md:space-y-6">

                <!-- Quick Stats Row -->
                <div class="flex md:grid md:grid-cols-4 gap-3 md:gap-4 overflow-x-auto scrollbar-hide -mx-4 px-4 md:mx-0 md:px-0 pb-1">
                    <div onclick="navigateTo('drivers')" class="nav-card flex-shrink-0 w-40 md:w-auto bg-surface-dark border border-border-dark rounded-xl p-4 cursor-pointer">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-10 h-10 bg-violet-500/20 rounded-xl flex items-center justify-center"><span class="material-symbols-outlined text-violet-400">person</span></div>
                            <span class="material-symbols-outlined text-text-muted text-[18px]">arrow_forward</span>
                        </div>
                        <div class="text-2xl font-bold" id="statDrivers">--</div>
                        <div class="text-xs text-text-muted">Total Drivers</div>
                        <div class="flex items-center gap-1 mt-2 text-xs"><span class="text-emerald-400" id="statDriversNew">+0</span><span class="text-text-muted">this week</span></div>
                    </div>
                    <div onclick="navigateTo('carriers')" class="nav-card flex-shrink-0 w-40 md:w-auto bg-surface-dark border border-border-dark rounded-xl p-4 cursor-pointer">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-10 h-10 bg-blue-500/20 rounded-xl flex items-center justify-center"><span class="material-symbols-outlined text-blue-400">local_shipping</span></div>
                            <span class="material-symbols-outlined text-text-muted text-[18px]">arrow_forward</span>
                        </div>
                        <div class="text-2xl font-bold" id="statCarriers">--</div>
                        <div class="text-xs text-text-muted">Total Carriers</div>
                        <div class="flex items-center gap-1 mt-2 text-xs"><span class="text-emerald-400" id="statCarriersNew">+0</span><span class="text-text-muted">this week</span></div>
                    </div>
                    <div class="nav-card flex-shrink-0 w-40 md:w-auto bg-surface-dark border border-border-dark rounded-xl p-4 cursor-pointer">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-10 h-10 bg-emerald-500/20 rounded-xl flex items-center justify-center"><span class="material-symbols-outlined text-emerald-400">handshake</span></div>
                            <span class="material-symbols-outlined text-text-muted text-[18px]">trending_up</span>
                        </div>
                        <div class="text-2xl font-bold" id="statMatches">--</div>
                        <div class="text-xs text-text-muted">Matches Today</div>
                        <div class="flex items-center gap-1 mt-2 text-xs"><span class="text-text-muted" id="statMatchesWeek">0 this week</span></div>
                    </div>
                    <div class="nav-card flex-shrink-0 w-40 md:w-auto bg-surface-dark border border-border-dark rounded-xl p-4 cursor-pointer">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-10 h-10 bg-amber-500/20 rounded-xl flex items-center justify-center"><span class="material-symbols-outlined text-amber-400">warning</span></div>
                            <span id="attentionBadge" class="hidden px-2 py-0.5 bg-amber-500 text-white text-[10px] font-bold rounded-full">!</span>
                        </div>
                        <div class="text-2xl font-bold" id="statAttention">--</div>
                        <div class="text-xs text-text-muted">Needs Attention</div>
                        <div class="flex items-center gap-1 mt-2 text-xs text-amber-400" id="attentionBreakdown">--</div>
                    </div>
                    <div onclick="scrollToAIUsage()" class="nav-card flex-shrink-0 w-40 md:w-auto bg-surface-dark border border-border-dark rounded-xl p-4 cursor-pointer">
                        <div class="flex items-center justify-between mb-3">
                            <div class="w-10 h-10 bg-cyan-500/20 rounded-xl flex items-center justify-center"><span class="material-symbols-outlined text-cyan-400">smart_toy</span></div>
                            <span id="aiBudgetBadge" class="hidden px-2 py-0.5 bg-amber-500 text-white text-[10px] font-bold rounded-full">$</span>
                        </div>
                        <div class="text-2xl font-bold" id="statAICost">$--</div>
                        <div class="text-xs text-text-muted">AI Spend (Week)</div>
                        <div class="flex items-center gap-1 mt-2 text-xs" id="aiTokenCount"><span class="text-cyan-400">--</span><span class="text-text-muted">tokens</span></div>
                    </div>
                </div>

                <!-- Main Content Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-6">

                    <!-- Left Column -->
                    <div class="lg:col-span-2 space-y-4 md:space-y-6">

                        <!-- Activity Chart -->
                        <div class="bg-surface-dark border border-border-dark rounded-xl p-4 md:p-5">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-base md:text-lg font-bold">Activity Overview</h2>
                                <div class="flex gap-1 bg-surface-darker rounded-lg p-1">
                                    <button onclick="loadChartData('week')" id="chartWeekBtn" class="px-3 py-1.5 text-xs font-medium rounded-md bg-primary text-white">Week</button>
                                    <button onclick="loadChartData('month')" id="chartMonthBtn" class="px-3 py-1.5 text-xs font-medium rounded-md text-text-muted hover:text-white">Month</button>
                                </div>
                            </div>
                            <div class="h-48 md:h-64"><canvas id="activityChart"></canvas></div>
                            <div class="flex justify-center gap-6 mt-4 text-xs">
                                <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-emerald-400"></span><span class="text-text-muted">Matches</span></div>
                                <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-violet-400"></span><span class="text-text-muted">New Drivers</span></div>
                            </div>
                        </div>

                        <!-- Quick Navigation Cards -->
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                            <button onclick="navigateTo('drivers')" class="nav-card bg-surface-dark border border-border-dark rounded-xl p-4 text-left"><span class="material-symbols-outlined text-violet-400 mb-2">manage_accounts</span><div class="text-sm font-semibold">Manage Drivers</div><div class="text-xs text-text-muted mt-1">Verify, suspend, review</div></button>
                            <button onclick="navigateTo('carriers')" class="nav-card bg-surface-dark border border-border-dark rounded-xl p-4 text-left"><span class="material-symbols-outlined text-blue-400 mb-2">inventory_2</span><div class="text-sm font-semibold">Manage Carriers</div><div class="text-xs text-text-muted mt-1">Enrichment, flags</div></button>
                            <button onclick="navigateTo('audit-log')" class="nav-card bg-surface-dark border border-border-dark rounded-xl p-4 text-left"><span class="material-symbols-outlined text-amber-400 mb-2">history</span><div class="text-sm font-semibold">Audit Log</div><div class="text-xs text-text-muted mt-1">Admin activity</div></button>
                            <button onclick="navigateTo('settings')" class="nav-card bg-surface-dark border border-border-dark rounded-xl p-4 text-left"><span class="material-symbols-outlined text-slate-400 mb-2">settings</span><div class="text-sm font-semibold">Settings</div><div class="text-xs text-text-muted mt-1">System config</div></button>
                            <button onclick="navigateTo('ai-router')" class="nav-card bg-surface-dark border border-border-dark rounded-xl p-4 text-left"><span class="material-symbols-outlined text-cyan-400 mb-2">smart_toy</span><div class="text-sm font-semibold">AI Router</div><div class="text-xs text-text-muted mt-1">LLM configuration</div></button>
                            <button onclick="navigateTo('admin-feature-flags')" class="nav-card bg-surface-dark border border-border-dark rounded-xl p-4 text-left"><span class="material-symbols-outlined text-emerald-400 mb-2">flag</span><div class="text-sm font-semibold">Feature Flags</div><div class="text-xs text-text-muted mt-1">Rollouts & toggles</div></button>
                            <button onclick="navigateTo('admin-email-templates')" class="nav-card bg-surface-dark border border-border-dark rounded-xl p-4 text-left"><span class="material-symbols-outlined text-blue-400 mb-2">email</span><div class="text-sm font-semibold">Email Templates</div><div class="text-xs text-text-muted mt-1">WYSIWYG editor</div></button>
                            <button onclick="navigateTo('admin-tickets')" class="nav-card bg-surface-dark border border-border-dark rounded-xl p-4 text-left"><span class="material-symbols-outlined text-rose-400 mb-2">support_agent</span><div class="text-sm font-semibold">Support Tickets</div><div class="text-xs text-text-muted mt-1">Manage user issues</div></button>
                            <button onclick="navigateTo('admin-kb')" class="nav-card bg-surface-dark border border-border-dark rounded-xl p-4 text-left"><span class="material-symbols-outlined text-emerald-400 mb-2">menu_book</span><div class="text-sm font-semibold">Knowledge Base</div><div class="text-xs text-text-muted mt-1">Help articles</div></button>
                        </div>

                        <!-- Enrichment Status -->
                        <div class="bg-surface-dark border border-border-dark rounded-xl p-4 md:p-5">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-base md:text-lg font-bold">Enrichment Status</h2>
                                <span class="text-xs text-text-muted" id="enrichmentCoverage">--% coverage</span>
                            </div>
                            <div class="grid grid-cols-3 gap-3">
                                <div class="text-center p-3 bg-surface-darker rounded-lg"><div class="text-xl md:text-2xl font-bold text-emerald-400" id="enrichmentFresh">--</div><div class="text-[10px] md:text-xs text-text-muted">Fresh (&lt;7d)</div></div>
                                <div class="text-center p-3 bg-surface-darker rounded-lg"><div class="text-xl md:text-2xl font-bold text-amber-400" id="enrichmentStale">--</div><div class="text-[10px] md:text-xs text-text-muted">Stale (7-14d)</div></div>
                                <div class="text-center p-3 bg-surface-darker rounded-lg"><div class="text-xl md:text-2xl font-bold text-rose-400" id="enrichmentExpired">--</div><div class="text-[10px] md:text-xs text-text-muted">Expired (&gt;14d)</div></div>
                            </div>
                        </div>

                        <!-- AI/LLM Usage Panel -->
                        <div id="aiUsagePanel" class="bg-surface-dark border border-border-dark rounded-xl p-4 md:p-5">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-2"><span class="material-symbols-outlined text-cyan-400">smart_toy</span><h2 class="text-base md:text-lg font-bold">AI/LLM Usage</h2></div>
                                <div class="flex gap-1 bg-surface-darker rounded-lg p-1">
                                    <button onclick="loadAIUsage('day')" id="aiDayBtn" class="px-2 py-1 text-[10px] font-medium rounded text-text-muted hover:text-white">24h</button>
                                    <button onclick="loadAIUsage('week')" id="aiWeekBtn" class="px-2 py-1 text-[10px] font-medium rounded bg-primary text-white">Week</button>
                                    <button onclick="loadAIUsage('month')" id="aiMonthBtn" class="px-2 py-1 text-[10px] font-medium rounded text-text-muted hover:text-white">Month</button>
                                </div>
                            </div>
                            <div id="aiBudgetStatus" class="mb-4 p-3 rounded-lg bg-surface-darker">
                                <div class="flex items-center justify-between mb-2"><span class="text-xs text-text-muted">Monthly Budget</span><span class="text-xs font-medium" id="aiBudgetPercent">--% of $100</span></div>
                                <div class="h-2 bg-slate-700 rounded-full overflow-hidden"><div id="aiBudgetBar" class="h-full bg-cyan-400 rounded-full transition-all duration-500" style="width: 0%"></div></div>
                                <div class="flex justify-between mt-1 text-[10px] text-text-muted"><span>$0</span><span id="aiBudgetProjection">Projected: $--</span><span>$100</span></div>
                            </div>
                            <div class="grid grid-cols-4 gap-2 mb-4">
                                <div class="text-center p-2 bg-surface-darker rounded-lg"><div class="text-lg font-bold text-cyan-400" id="aiTotalCost">$--</div><div class="text-[9px] text-text-muted">Total Cost</div></div>
                                <div class="text-center p-2 bg-surface-darker rounded-lg"><div class="text-lg font-bold text-violet-400" id="aiTotalTokens">--</div><div class="text-[9px] text-text-muted">Tokens</div></div>
                                <div class="text-center p-2 bg-surface-darker rounded-lg"><div class="text-lg font-bold text-emerald-400" id="aiTotalRequests">--</div><div class="text-[9px] text-text-muted">Requests</div></div>
                                <div class="text-center p-2 bg-surface-darker rounded-lg"><div class="text-lg font-bold" id="aiAvgLatency">--</div><div class="text-[9px] text-text-muted">Avg Latency</div></div>
                            </div>
                            <div class="mb-4"><h3 class="text-xs font-semibold text-text-muted mb-2">Cost by Provider</h3><div id="aiProviderBars" class="space-y-2"><div class="text-center py-3 text-text-muted text-xs">Loading...</div></div></div>
                            <div class="mb-4"><h3 class="text-xs font-semibold text-text-muted mb-2">Usage Trend</h3><div class="h-32"><canvas id="aiUsageChart"></canvas></div></div>
                            <div><h3 class="text-xs font-semibold text-text-muted mb-2">Usage by Function</h3><div id="aiFunctionList" class="space-y-1 max-h-32 overflow-y-auto scrollbar-thin"><div class="text-center py-3 text-text-muted text-xs">Loading...</div></div></div>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="space-y-4 md:space-y-6">

                        <!-- System Alerts -->
                        <div class="bg-surface-dark border border-border-dark rounded-xl p-4 md:p-5">
                            <div class="flex items-center justify-between mb-4"><h2 class="text-base md:text-lg font-bold">System Alerts</h2><span id="alertCount" class="px-2 py-0.5 bg-amber-500/20 text-amber-400 text-xs font-bold rounded-full">0</span></div>
                            <div id="alertsList" class="space-y-3 max-h-64 overflow-y-auto scrollbar-thin"><div class="text-center py-6 text-text-muted text-sm"><span class="material-symbols-outlined text-3xl mb-2 block">check_circle</span>No alerts</div></div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="bg-surface-dark border border-border-dark rounded-xl p-4 md:p-5">
                            <div class="flex items-center justify-between mb-4"><h2 class="text-base md:text-lg font-bold">Recent Activity</h2><span class="text-xs text-text-muted">Last 15 events</span></div>
                            <div id="activityFeed" class="space-y-3 max-h-80 overflow-y-auto scrollbar-thin"><div class="text-center py-6 text-text-muted text-sm">Loading activity...</div></div>
                        </div>

                        <!-- Platform Health -->
                        <div class="bg-surface-dark border border-border-dark rounded-xl p-4 md:p-5">
                            <div class="flex items-center justify-between mb-4"><h2 class="text-base md:text-lg font-bold">Platform Health</h2><span id="healthStatus" class="px-2 py-0.5 bg-emerald-500/20 text-emerald-400 text-xs font-bold rounded-full">Healthy</span></div>
                            <div id="servicesList" class="space-y-2"></div>
                        </div>

                        <!-- Meta Ads Integration Health -->
                        <div class="bg-surface-dark border border-border-dark rounded-xl p-4 md:p-5">
                            <div class="flex items-center justify-between mb-4"><h2 class="text-base md:text-lg font-bold">Meta Ads Health</h2><span id="metaPostureBadge" class="px-2 py-0.5 bg-slate-500/20 text-slate-300 text-xs font-bold rounded-full">Unknown</span></div>
                            <div class="grid grid-cols-2 gap-3 mb-4">
                                <div class="bg-surface-darker rounded-lg p-3"><div class="text-[10px] text-text-muted">Integrations</div><div class="text-2xl font-bold" id="metaIntegrationsTotal">--</div><div class="text-[10px] text-emerald-400" id="metaIntegrationsActive">-- active</div></div>
                                <div class="bg-surface-darker rounded-lg p-3"><div class="text-[10px] text-text-muted">Ad Accounts</div><div class="text-2xl font-bold" id="metaAdAccountsTotal">--</div><div class="text-[10px] text-text-muted">discovered</div></div>
                            </div>
                            <div class="space-y-2 text-xs">
                                <div class="flex items-center justify-between"><span class="text-text-muted">Healthy Tokens</span><span class="text-emerald-400 font-semibold" id="metaTokenHealthy">--</span></div>
                                <div class="flex items-center justify-between"><span class="text-text-muted">Expiring Soon</span><span class="text-amber-400 font-semibold" id="metaTokenExpiring">--</span></div>
                                <div class="flex items-center justify-between"><span class="text-text-muted">Expired / Quarantined</span><span class="text-rose-400 font-semibold" id="metaTokenCritical">--</span></div>
                            </div>
                            <div class="mt-4 pt-4 border-t border-border-dark space-y-3">
                                <div class="flex items-center justify-between"><h3 class="text-xs font-semibold text-text-muted">Pending Execute-High Approvals</h3><span id="metaApprovalInboxCount" class="px-2 py-0.5 bg-slate-500/20 text-slate-300 text-[10px] font-bold rounded-full">0</span></div>
                                <div id="metaApprovalInboxList" class="max-h-28 overflow-y-auto scrollbar-thin space-y-1 text-[11px] text-text-muted"><div>No pending approvals</div></div>
                            </div>
                            <div class="mt-3 pt-3 border-t border-border-dark space-y-2">
                                <h3 class="text-xs font-semibold text-text-muted">Policy Editor</h3>
                                <div class="grid grid-cols-2 gap-2">
                                    <input id="metaLaunchThresholdInput" type="number" placeholder="Launch threshold" class="bg-surface-darker border border-border-dark rounded-lg px-2 py-1.5 text-xs" />
                                    <input id="metaBudgetCapInput" type="number" placeholder="Daily budget cap" class="bg-surface-darker border border-border-dark rounded-lg px-2 py-1.5 text-xs" />
                                </div>
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="saveMetaApprovalThresholds()" class="px-2 py-1.5 rounded-lg text-xs font-medium bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 transition-colors">Save Thresholds</button>
                                    <button onclick="saveMetaBudgetCaps()" class="px-2 py-1.5 rounded-lg text-xs font-medium bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 transition-colors">Save Budget Caps</button>
                                </div>
                                <button onclick="saveMetaCampaignGuardrails()" class="w-full px-2 py-1.5 rounded-lg text-xs font-medium bg-violet-500/20 text-violet-400 hover:bg-violet-500/30 transition-colors">Save Guardrails</button>
                            </div>
                            <div class="mt-3 pt-3 border-t border-border-dark space-y-2">
                                <h3 class="text-xs font-semibold text-text-muted">Error / Rate-Limit Posture</h3>
                                <div class="grid grid-cols-2 gap-2 text-[11px]">
                                    <div class="bg-surface-darker rounded-lg p-2"><div class="text-text-muted">Error Events (24h)</div><div class="text-sm font-bold" id="metaErrorEventsCount">--</div></div>
                                    <div class="bg-surface-darker rounded-lg p-2"><div class="text-text-muted">Throttled (24h)</div><div class="text-sm font-bold" id="metaThrottledCount">--</div></div>
                                </div>
                            </div>
                            <div class="mt-3 pt-3 border-t border-border-dark space-y-2">
                                <h3 class="text-xs font-semibold text-text-muted">Integration Quarantine / Recovery</h3>
                                <input id="metaIntegrationIdInput" type="text" placeholder="integration_id" class="w-full bg-surface-darker border border-border-dark rounded-lg px-2 py-1.5 text-xs" />
                                <input id="metaAdAccountIdInput" type="text" placeholder="ad_account_id (for rebind)" class="w-full bg-surface-darker border border-border-dark rounded-lg px-2 py-1.5 text-xs" />
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="quarantineMetaIntegration()" class="px-2 py-1.5 rounded-lg text-xs font-medium bg-amber-500/20 text-amber-400 hover:bg-amber-500/30 transition-colors">Quarantine</button>
                                    <button onclick="refreshMetaToken()" class="px-2 py-1.5 rounded-lg text-xs font-medium bg-emerald-500/20 text-emerald-400 hover:bg-emerald-500/30 transition-colors">Refresh Token</button>
                                </div>
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="rebindMetaAdAccount()" class="px-2 py-1.5 rounded-lg text-xs font-medium bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 transition-colors">Rebind Ad Account</button>
                                    <button onclick="disableMetaIntegration()" class="px-2 py-1.5 rounded-lg text-xs font-medium bg-rose-500/20 text-rose-400 hover:bg-rose-500/30 transition-colors">Disable</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Feature Adoption Section -->
                <div id="featureAdoptionSection" class="bg-surface-dark border border-border-dark rounded-xl p-4 md:p-6">
                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-purple-500/20 rounded-xl flex items-center justify-center"><span class="material-symbols-outlined text-purple-400">analytics</span></div>
                            <div><h2 class="text-lg md:text-xl font-bold">Feature Adoption Dashboard</h2><p class="text-xs text-text-muted">Track feature lifecycle, health scores, and conversion funnels</p></div>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="flex gap-1 bg-surface-darker rounded-lg p-1">
                                <button onclick="setFeatureTimeRange(7)" id="featRange7d" class="px-2 py-1 text-[10px] font-medium rounded tab-active">7d</button>
                                <button onclick="setFeatureTimeRange(14)" id="featRange14d" class="px-2 py-1 text-[10px] font-medium rounded tab-inactive">14d</button>
                                <button onclick="setFeatureTimeRange(30)" id="featRange30d" class="px-2 py-1 text-[10px] font-medium rounded tab-inactive">30d</button>
                            </div>
                            <button onclick="refreshFeatureAdoption()" class="p-2 bg-surface-darker rounded-lg hover:bg-slate-700 transition-colors" title="Refresh data"><span class="material-symbols-outlined text-[18px]">refresh</span></button>
                        </div>
                    </div>

                    <div class="flex gap-1 bg-surface-darker rounded-lg p-1 mb-6 overflow-x-auto">
                        <button onclick="setFeatureTab('overview')" id="featTabOverview" class="flex-1 md:flex-none px-4 py-2 text-xs font-medium rounded-md tab-active whitespace-nowrap"><span class="material-symbols-outlined text-[14px] mr-1 align-middle">dashboard</span>Overview</button>
                        <button onclick="setFeatureTab('funnels')" id="featTabFunnels" class="flex-1 md:flex-none px-4 py-2 text-xs font-medium rounded-md tab-inactive whitespace-nowrap"><span class="material-symbols-outlined text-[14px] mr-1 align-middle">filter_alt</span>Funnels</button>
                        <button onclick="setFeatureTab('at-risk')" id="featTabAtRisk" class="flex-1 md:flex-none px-4 py-2 text-xs font-medium rounded-md tab-inactive whitespace-nowrap"><span class="material-symbols-outlined text-[14px] mr-1 align-middle">warning</span>At-Risk<span id="atRiskBadge" class="hidden ml-1 px-1.5 py-0.5 bg-rose-500 text-white text-[9px] font-bold rounded-full">0</span></button>
                    </div>

                    <!-- Overview Tab -->
                    <div id="featContentOverview" class="space-y-6">
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <div class="p-4 bg-surface-darker rounded-xl text-center"><div class="text-2xl md:text-3xl font-bold text-purple-400" id="featTotalFeatures">--</div><div class="text-xs text-text-muted">Total Features</div></div>
                            <div class="p-4 bg-surface-darker rounded-xl text-center"><div class="text-2xl md:text-3xl font-bold text-emerald-400" id="featHealthyCount">--</div><div class="text-xs text-text-muted">Healthy (70+)</div></div>
                            <div class="p-4 bg-surface-darker rounded-xl text-center"><div class="text-2xl md:text-3xl font-bold text-amber-400" id="featWarningCount">--</div><div class="text-xs text-text-muted">Warning (40-69)</div></div>
                            <div class="p-4 bg-surface-darker rounded-xl text-center"><div class="text-2xl md:text-3xl font-bold text-rose-400" id="featCriticalCount">--</div><div class="text-xs text-text-muted">Critical (&lt;40)</div></div>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                            <div class="bg-surface-darker rounded-xl p-4"><h3 class="text-sm font-semibold mb-4">Lifecycle Status Distribution</h3><div class="flex items-center justify-center"><div class="relative w-48 h-48"><canvas id="featureStatusChart"></canvas><div class="donut-center"><div class="text-2xl font-bold" id="featStatusTotal">--</div><div class="text-[10px] text-text-muted">Features</div></div></div></div><div class="flex flex-wrap justify-center gap-3 mt-4"><div class="flex items-center gap-1.5"><span class="w-3 h-3 rounded-full bg-violet-400"></span><span class="text-[10px] text-text-muted">Beta</span></div><div class="flex items-center gap-1.5"><span class="w-3 h-3 rounded-full bg-emerald-400"></span><span class="text-[10px] text-text-muted">Active</span></div><div class="flex items-center gap-1.5"><span class="w-3 h-3 rounded-full bg-amber-400"></span><span class="text-[10px] text-text-muted">Deprecated</span></div><div class="flex items-center gap-1.5"><span class="w-3 h-3 rounded-full bg-rose-400"></span><span class="text-[10px] text-text-muted">Sunset</span></div></div></div>
                            <div class="bg-surface-darker rounded-xl p-4"><h3 class="text-sm font-semibold mb-4">Health Score Distribution</h3><div class="h-48"><canvas id="featureHealthChart"></canvas></div></div>
                        </div>
                        <div>
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-sm font-semibold">Feature Health Overview</h3>
                                <div class="flex gap-2">
                                    <select id="featFilterStatus" onchange="filterFeatures()" class="px-2 py-1 text-xs bg-surface-darker border border-border-dark rounded-lg text-text-muted"><option value="all">All Statuses</option><option value="beta">Beta</option><option value="active">Active</option><option value="deprecated">Deprecated</option><option value="sunset">Sunset</option></select>
                                    <select id="featSortBy" onchange="sortFeatures()" class="px-2 py-1 text-xs bg-surface-darker border border-border-dark rounded-lg text-text-muted"><option value="health-desc">Health (High to Low)</option><option value="health-asc">Health (Low to High)</option><option value="users-desc">Users (High to Low)</option><option value="name-asc">Name (A-Z)</option></select>
                                </div>
                            </div>
                            <div id="featureHealthGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 max-h-96 overflow-y-auto scrollbar-thin pr-2"><div class="col-span-full text-center py-8 text-text-muted text-sm"><span class="material-symbols-outlined text-4xl mb-2 block">hourglass_empty</span>Loading features...</div></div>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                            <div class="bg-surface-darker rounded-xl p-4"><div class="flex items-center gap-2 mb-4"><span class="material-symbols-outlined text-emerald-400 text-[18px]">trending_up</span><h3 class="text-sm font-semibold">Top Performers</h3></div><div id="topFeaturesTable" class="space-y-2"><div class="text-center py-4 text-text-muted text-xs">Loading...</div></div></div>
                            <div class="bg-surface-darker rounded-xl p-4"><div class="flex items-center gap-2 mb-4"><span class="material-symbols-outlined text-rose-400 text-[18px]">trending_down</span><h3 class="text-sm font-semibold">Needs Attention</h3></div><div id="bottomFeaturesTable" class="space-y-2"><div class="text-center py-4 text-text-muted text-xs">Loading...</div></div></div>
                        </div>
                    </div>

                    <!-- Funnels Tab -->
                    <div id="featContentFunnels" class="hidden space-y-6">
                        <div class="flex flex-col md:flex-row md:items-center gap-4">
                            <div class="flex-1"><label class="text-xs text-text-muted block mb-1">Select Funnel</label><select id="funnelSelector" onchange="loadFunnelData(this.value)" class="w-full px-3 py-2 bg-surface-darker border border-border-dark rounded-lg text-sm"><option value="">-- Select a funnel --</option></select></div>
                            <button onclick="refreshFunnelList()" class="px-3 py-2 bg-surface-darker border border-border-dark rounded-lg text-xs hover:bg-slate-700 transition-colors"><span class="material-symbols-outlined text-[14px] mr-1 align-middle">refresh</span>Refresh</button>
                        </div>
                        <div id="funnelVisualization" class="bg-surface-darker rounded-xl p-6"><div class="text-center py-12 text-text-muted"><span class="material-symbols-outlined text-5xl mb-3 block">filter_alt</span><p class="text-sm">Select a funnel to view conversion data</p></div></div>
                        <div id="funnelDetails" class="hidden">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <div class="bg-surface-darker rounded-xl p-4 text-center"><div class="text-2xl font-bold text-blue-400" id="funnelTotalEntered">--</div><div class="text-xs text-text-muted">Total Entered</div></div>
                                <div class="bg-surface-darker rounded-xl p-4 text-center"><div class="text-2xl font-bold text-emerald-400" id="funnelTotalCompleted">--</div><div class="text-xs text-text-muted">Completed</div></div>
                                <div class="bg-surface-darker rounded-xl p-4 text-center"><div class="text-2xl font-bold text-purple-400" id="funnelConversionRate">--%</div><div class="text-xs text-text-muted">Overall Conversion</div></div>
                            </div>
                            <div class="bg-surface-darker rounded-xl p-4"><h4 class="text-sm font-semibold mb-4">Step-by-Step Analysis</h4><div id="funnelStepsTable" class="space-y-3"></div></div>
                        </div>
                    </div>

                    <!-- At-Risk Tab -->
                    <div id="featContentAtRisk" class="hidden space-y-6">
                        <div id="atRiskAlertBanner" class="at-risk-alert rounded-xl p-4 hidden">
                            <div class="flex items-start gap-3"><span class="material-symbols-outlined text-rose-400 text-2xl">error</span><div class="flex-1"><h4 class="font-semibold text-rose-400">Critical Features Detected</h4><p class="text-sm text-text-muted mt-1" id="atRiskAlertMessage">Some features are below retirement threshold and require immediate attention.</p></div></div>
                        </div>
                        <div id="atRiskFeaturesList" class="space-y-4"><div class="text-center py-12 text-text-muted"><span class="material-symbols-outlined text-5xl mb-3 block text-emerald-400">verified</span><p class="text-sm">No at-risk features detected</p><p class="text-xs mt-1">All features are performing within healthy thresholds</p></div></div>
                    </div>
                </div>

                <div class="h-4 md:h-0"></div>
            </div>
        </div>
    </div>

    <!-- CDN Module Loading (ordered by dependency) -->
    <script src="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/admin/js/admin-dashboard-config.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/admin/js/admin-dashboard-bridge.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/admin/js/admin-dashboard-render.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/admin/js/admin-dashboard-logic.js"></script>

    <!-- Voice & Agent Modules -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/css/voice-agent.css">
    <script src="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/js/voice-agent-ui.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/js/voice-agent-bridge.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/admin/js/admin-agent.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/admin/js/admin-agent-kpis.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/admin/js/admin-run-monitor.js"></script>

    <!-- Bootstrap -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            AdminDashboardLogic.init();
        });
    </script>

</body>
</html>
