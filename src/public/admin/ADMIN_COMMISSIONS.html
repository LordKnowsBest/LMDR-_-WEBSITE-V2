<!DOCTYPE html>
<html class="dark" lang="en">
<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
    <title>VelocityMatch | Commission Tracking</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: { lmdr: { dark: '#0f172a', blue: '#2563eb', yellow: '#fbbf24', canvas: '#f8fafc' } },
                    animation: { 'float': 'float 6s ease-in-out infinite' },
                    keyframes: { float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } } }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/admin/css/admin-commissions.css"/>
</head>

<body class="bg-slate-900 text-white font-sans">
    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 flex flex-col gap-2"></div>

    <!-- Main Container -->
    <div class="h-screen flex flex-col overflow-hidden">
        <!-- Header -->
        <header class="flex-none bg-slate-800 border-b border-slate-700 px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center font-bold text-sm">VM</div>
                    <h1 class="text-xl font-bold">Commission Tracking</h1>
                </div>
                <div class="flex items-center gap-3">
                    <select id="periodSelector" class="bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="month">This Month</option>
                        <option value="quarter">This Quarter</option>
                        <option value="year">This Year</option>
                    </select>
                    <button id="btnRecordCommission" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors">
                        <span class="material-symbols-outlined text-lg">add</span>
                        Record Commission
                    </button>
                </div>
            </div>
        </header>

        <!-- Summary Cards -->
        <div class="flex-none px-6 py-4 grid grid-cols-3 gap-4" id="summaryCards">
            <div class="bg-slate-800 rounded-xl p-5 border border-slate-700">
                <div class="flex items-center gap-2 mb-2">
                    <span class="material-symbols-outlined text-green-400">trending_up</span>
                    <span class="text-sm text-slate-400">Total Earned</span>
                </div>
                <div class="text-2xl font-bold text-green-400" id="totalEarned">$0.00</div>
                <div class="text-xs text-slate-500 mt-1"><span id="earnedCount">0</span> deals</div>
            </div>
            <div class="bg-slate-800 rounded-xl p-5 border border-slate-700">
                <div class="flex items-center gap-2 mb-2">
                    <span class="material-symbols-outlined text-yellow-400">hourglass_top</span>
                    <span class="text-sm text-slate-400">Pending Approval</span>
                </div>
                <div class="text-2xl font-bold text-yellow-400" id="totalPending">$0.00</div>
                <div class="text-xs text-slate-500 mt-1"><span id="pendingCount">0</span> commissions</div>
            </div>
            <div class="bg-slate-800 rounded-xl p-5 border border-slate-700">
                <div class="flex items-center gap-2 mb-2">
                    <span class="material-symbols-outlined text-blue-400">payments</span>
                    <span class="text-sm text-slate-400">Paid This Period</span>
                </div>
                <div class="text-2xl font-bold text-blue-400" id="totalPaid">$0.00</div>
                <div class="text-xs text-slate-500 mt-1"><span id="paidCount">0</span> payouts</div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="flex-none px-6 border-b border-slate-700 flex gap-6">
            <button class="tab-btn tab-active pb-3 text-sm font-medium" data-tab="leaderboard">Leaderboard</button>
            <button class="tab-btn tab-inactive pb-3 text-sm font-medium" data-tab="commissions">Commissions</button>
            <button class="tab-btn tab-inactive pb-3 text-sm font-medium" data-tab="rules">Rules</button>
            <button class="tab-btn tab-inactive pb-3 text-sm font-medium" data-tab="reps">Sales Reps</button>
        </div>

        <!-- Tab Content -->
        <div class="flex-1 overflow-auto scrollbar-thin p-6">
            <!-- Leaderboard Tab -->
            <div id="tab-leaderboard" class="tab-content">
                <div class="bg-slate-800 rounded-xl border border-slate-700 overflow-hidden">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-slate-700">
                                <th class="text-left px-4 py-3 text-slate-400 font-medium">#</th>
                                <th class="text-left px-4 py-3 text-slate-400 font-medium">Rep Name</th>
                                <th class="text-right px-4 py-3 text-slate-400 font-medium">Deals</th>
                                <th class="text-right px-4 py-3 text-slate-400 font-medium">Revenue Generated</th>
                                <th class="text-right px-4 py-3 text-slate-400 font-medium">Commission Earned</th>
                                <th class="text-right px-4 py-3 text-slate-400 font-medium">Avg Deal Size</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboardBody">
                            <tr><td colspan="6" class="text-center py-8 text-slate-500">Loading leaderboard...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Commissions Tab -->
            <div id="tab-commissions" class="tab-content hidden">
                <div class="flex items-center gap-3 mb-4 flex-wrap">
                    <select id="filterStatus" class="bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm">
                        <option value="all">All Statuses</option>
                        <option value="pending">Pending</option>
                        <option value="approved">Approved</option>
                        <option value="paid">Paid</option>
                    </select>
                    <input type="date" id="filterDateFrom" class="bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm" />
                    <input type="date" id="filterDateTo" class="bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm" />
                    <select id="filterRep" class="bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm">
                        <option value="all">All Reps</option>
                    </select>
                    <div class="flex-1"></div>
                    <button id="btnBulkApprove" class="hidden bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg text-sm font-medium transition-colors">Approve Selected</button>
                    <button id="btnPayoutReport" class="bg-slate-700 hover:bg-slate-600 px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
                        <span class="material-symbols-outlined text-lg">receipt_long</span>
                        Generate Payout Report
                    </button>
                </div>
                <div class="bg-slate-800 rounded-xl border border-slate-700 overflow-hidden">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-slate-700">
                                <th class="px-4 py-3 w-8"><input type="checkbox" id="checkAll" class="rounded bg-slate-700 border-slate-600" /></th>
                                <th class="text-left px-4 py-3 text-slate-400 font-medium">Date</th>
                                <th class="text-left px-4 py-3 text-slate-400 font-medium">Rep</th>
                                <th class="text-left px-4 py-3 text-slate-400 font-medium">Carrier</th>
                                <th class="text-left px-4 py-3 text-slate-400 font-medium">Type</th>
                                <th class="text-right px-4 py-3 text-slate-400 font-medium">Deal Value</th>
                                <th class="text-right px-4 py-3 text-slate-400 font-medium">Rate</th>
                                <th class="text-right px-4 py-3 text-slate-400 font-medium">Commission</th>
                                <th class="text-center px-4 py-3 text-slate-400 font-medium">Status</th>
                                <th class="text-center px-4 py-3 text-slate-400 font-medium">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="commissionsBody">
                            <tr><td colspan="10" class="text-center py-8 text-slate-500">Loading commissions...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Rules Tab -->
            <div id="tab-rules" class="tab-content hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">Commission Rules</h2>
                    <button id="btnAddRule" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors">
                        <span class="material-symbols-outlined text-lg">add</span> Add Rule
                    </button>
                </div>
                <div class="bg-slate-800 rounded-xl border border-slate-700 overflow-hidden">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-slate-700">
                                <th class="text-left px-4 py-3 text-slate-400 font-medium">Rule Name</th>
                                <th class="text-left px-4 py-3 text-slate-400 font-medium">Event Type</th>
                                <th class="text-right px-4 py-3 text-slate-400 font-medium">Base Rate</th>
                                <th class="text-center px-4 py-3 text-slate-400 font-medium">Priority</th>
                                <th class="text-center px-4 py-3 text-slate-400 font-medium">Status</th>
                                <th class="text-center px-4 py-3 text-slate-400 font-medium">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="rulesBody">
                            <tr><td colspan="6" class="text-center py-8 text-slate-500">Loading rules...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Sales Reps Tab -->
            <div id="tab-reps" class="tab-content hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold">Sales Representatives</h2>
                    <button id="btnAddRep" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-colors">
                        <span class="material-symbols-outlined text-lg">person_add</span> Add Rep
                    </button>
                </div>
                <div class="bg-slate-800 rounded-xl border border-slate-700 overflow-hidden">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-slate-700">
                                <th class="text-left px-4 py-3 text-slate-400 font-medium">Name</th>
                                <th class="text-left px-4 py-3 text-slate-400 font-medium">Email</th>
                                <th class="text-left px-4 py-3 text-slate-400 font-medium">Role</th>
                                <th class="text-center px-4 py-3 text-slate-400 font-medium">Status</th>
                                <th class="text-right px-4 py-3 text-slate-400 font-medium">Total Deals</th>
                                <th class="text-right px-4 py-3 text-slate-400 font-medium">Total Revenue</th>
                                <th class="text-right px-4 py-3 text-slate-400 font-medium">Total Earned</th>
                                <th class="text-center px-4 py-3 text-slate-400 font-medium">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="repsBody">
                            <tr><td colspan="8" class="text-center py-8 text-slate-500">Loading reps...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Commission Detail Modal -->
    <div id="commissionDetailModal" class="fixed inset-0 modal-backdrop z-40 hidden flex items-center justify-center">
        <div class="bg-slate-800 rounded-2xl border border-slate-700 w-full max-w-lg mx-4 max-h-[80vh] overflow-auto scrollbar-thin">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold">Commission Detail</h3>
                    <button onclick="closeModal('commissionDetailModal')" class="text-slate-400 hover:text-white">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div id="commissionDetailContent"></div>
            </div>
        </div>
    </div>

    <!-- Record Commission Modal -->
    <div id="recordCommissionModal" class="fixed inset-0 modal-backdrop z-40 hidden flex items-center justify-center">
        <div class="bg-slate-800 rounded-2xl border border-slate-700 w-full max-w-lg mx-4 max-h-[80vh] overflow-auto scrollbar-thin">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold">Record Commission</h3>
                    <button onclick="closeModal('recordCommissionModal')" class="text-slate-400 hover:text-white">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <form id="recordCommissionForm" class="space-y-4">
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Sales Rep</label>
                        <select id="formRepId" required class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm"><option value="">Select rep...</option></select>
                    </div>
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Carrier DOT</label>
                        <input type="text" id="formCarrierDot" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm" placeholder="e.g., 1234567" />
                    </div>
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Event Type</label>
                        <select id="formEventType" required class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm">
                            <option value="new_subscription">New Subscription</option>
                            <option value="upgrade">Upgrade</option>
                            <option value="renewal">Renewal</option>
                            <option value="placement">Placement</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-slate-400 mb-1">Deal Value ($)</label>
                            <input type="number" id="formDealValue" required step="0.01" min="0" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm" placeholder="0.00" />
                        </div>
                        <div>
                            <label class="block text-sm text-slate-400 mb-1">Commission Rate (%)</label>
                            <input type="number" id="formRate" step="0.01" min="0" max="100" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm" placeholder="10" />
                        </div>
                    </div>
                    <div class="bg-slate-750 rounded-lg p-3 border border-slate-600">
                        <div class="text-sm text-slate-400">Calculated Commission</div>
                        <div class="text-xl font-bold text-green-400" id="formCalculatedAmount">$0.00</div>
                    </div>
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Notes</label>
                        <textarea id="formNotes" rows="3" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm" placeholder="Optional notes..."></textarea>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-3 rounded-lg text-sm font-medium transition-colors">Submit Commission</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Rule Modal -->
    <div id="ruleModal" class="fixed inset-0 modal-backdrop z-40 hidden flex items-center justify-center">
        <div class="bg-slate-800 rounded-2xl border border-slate-700 w-full max-w-lg mx-4 max-h-[80vh] overflow-auto scrollbar-thin">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold" id="ruleModalTitle">Add Rule</h3>
                    <button onclick="closeModal('ruleModal')" class="text-slate-400 hover:text-white"><span class="material-symbols-outlined">close</span></button>
                </div>
                <form id="ruleForm" class="space-y-4">
                    <input type="hidden" id="ruleId" />
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Rule Name</label>
                        <input type="text" id="ruleName" required class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm" />
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-slate-400 mb-1">Event Type</label>
                            <select id="ruleEventType" required class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm">
                                <option value="new_subscription">New Subscription</option>
                                <option value="upgrade">Upgrade</option>
                                <option value="renewal">Renewal</option>
                                <option value="placement">Placement</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-slate-400 mb-1">Base Rate (%)</label>
                            <input type="number" id="ruleBaseRate" required step="0.01" min="0" max="100" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm" />
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Priority (lower = higher priority)</label>
                        <input type="number" id="rulePriority" min="1" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm" value="10" />
                    </div>
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Tier Bonuses (JSON)</label>
                        <textarea id="ruleTierBonuses" rows="3" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm font-mono" placeholder='[{"min_value": 10000, "rate": 0.12}]'></textarea>
                    </div>
                    <div class="flex items-center gap-3">
                        <label class="text-sm text-slate-400">Status</label>
                        <select id="ruleStatus" class="bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-3 rounded-lg text-sm font-medium transition-colors">Save Rule</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Rep Modal -->
    <div id="repModal" class="fixed inset-0 modal-backdrop z-40 hidden flex items-center justify-center">
        <div class="bg-slate-800 rounded-2xl border border-slate-700 w-full max-w-lg mx-4 max-h-[80vh] overflow-auto scrollbar-thin">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold" id="repModalTitle">Add Sales Rep</h3>
                    <button onclick="closeModal('repModal')" class="text-slate-400 hover:text-white"><span class="material-symbols-outlined">close</span></button>
                </div>
                <form id="repForm" class="space-y-4">
                    <input type="hidden" id="repId" />
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-slate-400 mb-1">Name</label>
                            <input type="text" id="repName" required class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm" />
                        </div>
                        <div>
                            <label class="block text-sm text-slate-400 mb-1">Email</label>
                            <input type="email" id="repEmail" required class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm" />
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-slate-400 mb-1">Phone</label>
                            <input type="tel" id="repPhone" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm" />
                        </div>
                        <div>
                            <label class="block text-sm text-slate-400 mb-1">Role</label>
                            <input type="text" id="repRole" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm" placeholder="e.g., Account Executive" />
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-slate-400 mb-1">Payment Method</label>
                            <select id="repPaymentMethod" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm">
                                <option value="direct_deposit">Direct Deposit</option>
                                <option value="check">Check</option>
                                <option value="paypal">PayPal</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-slate-400 mb-1">Status</label>
                            <select id="repStatus" class="bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm w-full">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Payment Details</label>
                        <input type="text" id="repPaymentDetails" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm" placeholder="Account number or PayPal email" />
                    </div>
                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-3 rounded-lg text-sm font-medium transition-colors">Save Rep</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Payout Report Modal -->
    <div id="payoutModal" class="fixed inset-0 modal-backdrop z-40 hidden flex items-center justify-center">
        <div class="bg-slate-800 rounded-2xl border border-slate-700 w-full max-w-2xl mx-4 max-h-[80vh] overflow-auto scrollbar-thin">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold">Payout Report</h3>
                    <button onclick="closeModal('payoutModal')" class="text-slate-400 hover:text-white"><span class="material-symbols-outlined">close</span></button>
                </div>
                <div id="payoutReportContent"></div>
                <div class="mt-4 flex items-center gap-3">
                    <input type="text" id="payoutReference" class="flex-1 bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-sm" placeholder="Payout reference (e.g., check #, transfer ID)" />
                    <button id="btnMarkAllPaid" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg text-sm font-medium transition-colors">Mark All Paid</button>
                    <button id="btnExportCSV" class="bg-slate-700 hover:bg-slate-600 px-4 py-2 rounded-lg text-sm font-medium transition-colors">Export CSV</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JS Modules via CDN -->
    <script src="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/admin/js/admin-commissions-config.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/admin/js/admin-commissions-bridge.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/admin/js/admin-commissions-render.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/LordKnowsBest/LMDR-_-WEBSITE-V2@main/src/public/admin/js/admin-commissions-logic.js"></script>

    <!-- Bootstrap -->
    <script>
      CommissionsLogic.exposeGlobals();
      document.addEventListener('DOMContentLoaded', function () { CommissionsLogic.init(); });
    </script>
</body>
</html>
