<!DOCTYPE html>
<html class="dark" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>VelocityMatch | API Status</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-slate-100 font-['Inter'] min-h-screen p-6">
  <header class="mb-5">
    <h1 class="text-2xl font-bold">API Status</h1>
    <p class="text-sm text-slate-400">Health snapshot derived from gateway request and webhook delivery telemetry.</p>
  </header>

  <section class="bg-slate-900 border border-slate-800 rounded-xl p-4 mb-4">
    <div class="flex gap-2 items-end">
      <label class="text-xs text-slate-400">Window (hours)
        <input id="windowHours" type="number" min="1" max="168" value="24" class="block mt-1 w-24 bg-slate-950 border border-slate-700 rounded px-2 py-1" />
      </label>
      <button id="refreshStatus" class="px-3 py-2 bg-blue-600 rounded text-sm">Refresh Status</button>
    </div>
  </section>

  <section class="bg-slate-900 border border-slate-800 rounded-xl p-4">
    <pre id="statusPane" class="text-xs text-slate-300 whitespace-pre-wrap">Loading...</pre>
  </section>

  <script>
    const $ = (id) => document.getElementById(id);

    function post(action, extra = {}) {
      window.parent.postMessage({ action, ...extra }, '*');
    }

    function show(value) {
      $('statusPane').textContent = JSON.stringify(value, null, 2);
    }

    window.addEventListener('message', (event) => {
      const data = event.data || {};
      if (data.action === 'init') {
        post('getApiStatus', { windowHours: Number($('windowHours').value || 24) });
      }
      if (data.action === 'apiStatusLoaded') {
        show(data.payload || {});
      }
    });

    $('refreshStatus').addEventListener('click', () => {
      post('getApiStatus', { windowHours: Number($('windowHours').value || 24) });
    });
  </script>
</body>
</html>
