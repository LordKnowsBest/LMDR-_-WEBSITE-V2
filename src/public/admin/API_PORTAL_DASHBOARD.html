<!DOCTYPE html>
<html class="dark" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>VelocityMatch | API Portal Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            vm: { deep: '#0f172a', blue: '#2563eb', mint: '#14b8a6', panel: '#111827', edge: '#1f2937' }
          },
          fontFamily: { sans: ['Inter', 'sans-serif'] }
        }
      }
    };
  </script>
</head>
<body class="bg-vm-deep text-slate-100 font-sans min-h-screen p-6">
  <header class="mb-6">
    <h1 class="text-2xl font-bold">API Partner Portal</h1>
    <p class="text-sm text-slate-400">Usage, key management, environment, and billing actions.</p>
  </header>

  <section class="bg-vm-panel border border-vm-edge rounded-xl p-4 mb-6">
    <div class="flex flex-wrap gap-3 items-end">
      <label class="text-xs text-slate-400">Partner ID <input id="partnerId" class="block mt-1 bg-slate-900 border border-slate-700 rounded px-2 py-1" placeholder="ptn_..." /></label>
      <label class="text-xs text-slate-400">Period
        <select id="period" class="block mt-1 bg-slate-900 border border-slate-700 rounded px-2 py-1"><option value="">Current</option><option value="2026-01">2026-01</option><option value="2026-02">2026-02</option></select>
      </label>
      <button id="loadSnapshot" class="px-3 py-2 bg-vm-blue rounded text-sm">Load Snapshot</button>
      <button id="listKeys" class="px-3 py-2 bg-slate-700 rounded text-sm">List Keys</button>
      <button id="createKey" class="px-3 py-2 bg-vm-mint text-slate-900 rounded text-sm font-semibold">Create Sandbox Key</button>
    </div>
  </section>

  <section class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
    <div class="bg-vm-panel border border-vm-edge rounded-xl p-4"><h2 class="font-semibold mb-2">Partner</h2><pre id="partnerPane" class="text-xs text-slate-300 whitespace-pre-wrap">No data</pre></div>
    <div class="bg-vm-panel border border-vm-edge rounded-xl p-4"><h2 class="font-semibold mb-2">Usage</h2><pre id="usagePane" class="text-xs text-slate-300 whitespace-pre-wrap">No data</pre></div>
  </section>

  <section class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div class="bg-vm-panel border border-vm-edge rounded-xl p-4"><h2 class="font-semibold mb-2">API Keys</h2><pre id="keysPane" class="text-xs text-slate-300 whitespace-pre-wrap">No data</pre></div>
    <div class="bg-vm-panel border border-vm-edge rounded-xl p-4"><h2 class="font-semibold mb-2">Billing/Webhooks</h2><pre id="billingPane" class="text-xs text-slate-300 whitespace-pre-wrap">No data</pre></div>
  </section>

  <script>
    const $ = (id) => document.getElementById(id);
    function post(action, extra = {}) { window.parent.postMessage({ action, ...extra }, '*'); }
    function partnerId() { return $('partnerId').value.trim(); }
    function periodKey() { return $('period').value || null; }
    function show(id, value) { $(id).textContent = JSON.stringify(value, null, 2); }

    window.addEventListener('message', (event) => {
      const data = event.data || {};
      if (data.action === 'init') post('getSnapshot', { partnerId: partnerId(), periodKey: periodKey() });
      if (data.action === 'snapshotLoaded') {
        show('partnerPane', data.payload?.partner || data.payload);
        show('usagePane', { usage: data.payload?.usage, subscription: data.payload?.subscription, environment: data.payload?.environment });
        show('keysPane', data.payload?.api_keys || []);
        show('billingPane', { billing: data.payload?.billing, webhook_deliveries: data.payload?.webhook_deliveries });
      }
      if (data.action === 'keysLoaded' || data.action === 'keyCreated' || data.action === 'keyRevoked' || data.action === 'keyRotated') {
        show('keysPane', data.payload);
      }
      if (data.action === 'billingHistoryLoaded' || data.action === 'webhookTestResult' || data.action === 'checkoutCreated' || data.action === 'billingPortalCreated') {
        show('billingPane', data.payload);
      }
    });

    $('loadSnapshot').addEventListener('click', () => post('getSnapshot', { partnerId: partnerId(), periodKey: periodKey() }));
    $('listKeys').addEventListener('click', () => post('listKeys', { partnerId: partnerId() }));
    $('createKey').addEventListener('click', () => post('createKey', { partnerId: partnerId(), options: { environment: 'sandbox', name: 'Portal Sandbox Key' } }));
  </script>
</body>
</html>
