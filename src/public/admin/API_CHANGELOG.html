<!DOCTYPE html>
<html class="dark" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>VelocityMatch | API Changelog</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-slate-100 font-['Inter'] min-h-screen p-6">
  <header class="mb-5">
    <h1 class="text-2xl font-bold">API Changelog</h1>
    <p class="text-sm text-slate-400">Versioned updates for external API platform changes.</p>
  </header>

  <section class="bg-slate-900 border border-slate-800 rounded-xl p-4 mb-4">
    <div class="flex gap-2 items-end">
      <label class="text-xs text-slate-400">Limit
        <input id="limit" type="number" min="1" max="100" value="20" class="block mt-1 w-24 bg-slate-950 border border-slate-700 rounded px-2 py-1" />
      </label>
      <button id="refresh" class="px-3 py-2 bg-blue-600 rounded text-sm">Refresh Changelog</button>
    </div>
  </section>

  <section class="bg-slate-900 border border-slate-800 rounded-xl p-4">
    <div id="entries" class="space-y-3 text-sm">Loading...</div>
  </section>

  <script>
    const $ = (id) => document.getElementById(id);

    function post(action, extra = {}) {
      window.parent.postMessage({ action, ...extra }, '*');
    }

    function renderEntries(payload) {
      const host = $('entries');
      const items = payload?.items || [];
      host.innerHTML = '';
      if (!items.length) {
        host.textContent = 'No changelog entries available.';
        return;
      }

      items.forEach((item) => {
        const row = document.createElement('div');
        row.className = 'border border-slate-700 rounded p-3';
        row.innerHTML = '<div class="flex justify-between"><strong>' + (item.version || 'unknown') + '</strong><span class="text-slate-400">' + (item.date || '') + '</span></div>' +
          '<div class="text-slate-300 mt-1">' + (item.title || '') + '</div>' +
          '<div class="text-slate-400 mt-1">' + (item.details || '') + '</div>';
        host.appendChild(row);
      });
    }

    window.addEventListener('message', (event) => {
      const data = event.data || {};
      if (data.action === 'init') {
        post('getApiChangelog', { limit: Number($('limit').value || 20) });
      }
      if (data.action === 'apiChangelogLoaded') {
        renderEntries(data.payload || {});
      }
    });

    $('refresh').addEventListener('click', () => {
      post('getApiChangelog', { limit: Number($('limit').value || 20) });
    });
  </script>
</body>
</html>
