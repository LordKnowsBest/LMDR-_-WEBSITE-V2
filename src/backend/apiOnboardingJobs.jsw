import {
  processPartnerOnboardingFollowUps,
  initializePartnerOnboarding,
  listApiPartners
} from 'backend/apiPortalService';

export async function processApiPartnerOnboardingFollowUps() {
  try {
    // Ensure existing partners are enrolled before processing due follow-up steps.
    const partners = await listApiPartners(500);
    for (const partner of (partners?.items || [])) {
      await initializePartnerOnboarding(partner.partner_id).catch(() => null);
    }

    const result = await processPartnerOnboardingFollowUps(250);
    return {
      success: true,
      processed_count: Number(result?.processed_count || 0),
      processed: result?.processed || []
    };
  } catch (error) {
    return {
      success: false,
      error: error.message || 'Failed to process API onboarding follow-ups'
    };
  }
}
