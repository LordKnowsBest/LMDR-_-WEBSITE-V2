# Dependency Vulnerability Report
**Date:** 2024-05-22
**Analyst:** Supply Chain Security Analyst
**Status:** FAIL (High Severity Vulnerabilities Found)

## 1. Executive Summary

A dependency audit was performed on the LMDR project using `npm audit`. The analysis focused on known vulnerabilities, outdated packages, and specific high-risk dependencies related to payment processing, authentication, and AI.

| Severity | Count | Status |
| :--- | :--- | :--- |
| Critical | 0 | PASS |
| High | 5 | **FAIL** |
| Moderate | 4 | WARN |
| Low | 0 | PASS |
| **Total** | **9** | |

## 2. Detailed Findings

### 2.1. High Severity Vulnerabilities
The following high-severity vulnerabilities were identified, primarily stemming from the `@wix/cli` development dependency.

| Package | Vulnerability ID | Affected Version | Description | Path |
| :--- | :--- | :--- | :--- | :--- |
| **tar** | GHSA-8qq5-rm4j-mr97 | <= 7.5.6 | Arbitrary File Overwrite via Path Sanitization | `node_modules/tar` -> `@wix/cli` |
| **tar** | GHSA-r6q2-hw4h-h46w | <= 7.5.6 | Race Condition in Path Reservations | `node_modules/tar` -> `@wix/cli` |
| **tar** | GHSA-34x7-hfp2-rc4v | <= 7.5.6 | Arbitrary File Creation/Overwrite via Hardlink | `node_modules/tar` -> `@wix/cli` |

**Impact:** These vulnerabilities allow attackers to overwrite arbitrary files or create files outside the extraction directory if a malicious tar archive is processed. Since `@wix/cli` is a development tool, the risk is primarily to the developer's local environment during build/test processes, rather than the production runtime (Wix Velo environment).

**Root Cause:** `@wix/cli` depends on `node-gyp`, which depends on `make-fetch-happen`, which depends on `cacache`, which depends on the vulnerable `tar` version.

### 2.2. Moderate Severity Vulnerabilities
| Package | Vulnerability ID | Description | Path |
| :--- | :--- | :--- | :--- |
| **undici** | GHSA-g9mf-h72j-4rw9 | Unbounded decompression chain (DoS) | `node_modules/undici` -> `@wix/cli-app` |
| **vite** | GHSA-356w-63v5-8wf4 | `server.fs.deny` bypass | `node_modules/vite` -> `@wix/cli-app` |

### 2.3. Targeted Package Audit

| Category | Package | Status | Notes |
| :--- | :--- | :--- | :--- |
| **Authentication** | `@velo/wix-members-twilio-otp` | **Not Installed** | Present in `package.json.test-backup` but NOT in active `package.json`. No usage found in source code. |
| **Payment** | Stripe SDK | **Not Installed** | Project uses direct `fetch` to Stripe API in `src/backend/stripeService.jsw`. No `stripe` npm package vulnerability. |
| **AI** | OpenAI / Anthropic SDKs | **Not Installed** | Project uses direct `fetch` to AI providers. No SDK vulnerabilities. |
| **Platform** | `@wix/cli` | **Vulnerable** | version `^1.1.162` pulls in vulnerable transitive dependencies. |

### 2.4. Lockfile Status
- **`package-lock.json`**: Present and **Synced**.
- **`node_modules`**: Not present in the repository (standard practice), but dependency tree analysis confirms lockfile matches `package.json`.

## 3. Remediation Plan

### Immediate Actions
1.  **Do NOT run `npm audit fix --force`**: The automated fix suggests downgrading `@wix/cli` to version `1.0.1`, which is a breaking change and will likely break the development environment.
2.  **Monitor for `@wix/cli` Update**: The vulnerabilities are in transitive dependencies of `@wix/cli`. Await a patch from Wix that updates `node-gyp` or `make-fetch-happen` to versions that use a secure `tar`.
3.  **Local Mitigation**: Ensure developers do not process untrusted tar archives using the project's local `npm` scripts or `wix` CLI tools.

### Long-Term Recommendations
1.  **Dependency Management**: Regularly audit `package.json.test-backup` to ensure "phantom" dependencies don't re-enter the main `package.json` without review.
2.  **Tooling Update**: Keep `@wix/cli` updated to the latest version (`npm install @wix/cli@latest`) to pick up security patches as soon as they are released.

## 4. Conclusion
The project **FAILS** the dependency audit due to high-severity vulnerabilities in the development toolchain (`@wix/cli`). However, the **runtime** risk is low because these dependencies are not deployed to the Wix Velo production environment (which manages its own runtime dependencies). The critical payment and auth flows are implemented via direct API calls, avoiding the attack surface of those specific npm packages.
