# Dependency Vulnerability Check Final Report

## Goal
Audit the LMDR project's npm dependencies for known vulnerabilities, outdated packages, and supply chain risks, focusing on payment processing, authentication, and AI integrations.

## Executive Summary
**Status: FAIL**
The project currently fails the dependency security check due to critical synchronization issues between `package.json` and `package-lock.json`, missing credentials for private packages preventing a full audit, and outdated core libraries.

| Severity | Count | Primary Affected Packages |
| :--- | :--- | :--- |
| **Critical** | 0 | - |
| **High** | 6 | `@wix/cli`, `cacache`, `make-fetch-happen`, `minimatch`, `node-gyp`, `tar` |
| **Moderate** | 5 | `@wix/cli-app`, `ajv`, `miniflare`, `undici`, `vite` |
| **Low** | 0 | - |
| **Total** | **11** | |

## Critical Findings

### 1. `package-lock.json` Synchronization Failure
The `package-lock.json` file is critically out of sync with `package.json` and appears to be manually edited or corrupted.
- **UUID Mismatch:** `package.json` specifies `uuid: ^9.0.1`, but `package-lock.json` locks it to `13.0.0`. This major version jump could introduce breaking changes not accounted for in the code.
- **Dependency Scope Confusion:** `@wix/cli` is listed as a `devDependency` in `package.json` but appears in the `dependencies` (production) section of `package-lock.json`. This risks deploying development tools to production environments.
- **Missing Private Packages:** The private `@marketpushapps/*` dependencies listed in `package.json` are **completely absent** from `package-lock.json`. This means `npm audit` skipped scanning these packages entirely, leaving a significant blind spot in the security assessment.

### 2. Private Package Authentication Failure
Running `npm install` or `npm audit` fully fails because the environment lacks valid authentication tokens for the `@marketpushapps` scope.
- **Impact:** Cannot verify the integrity or version of critical business logic packages (`calendly-embed`, `airtable-connector`).
- **Risk:** Potential dependency confusion if a public package with the same name exists, though scoped packages mitigate this somewhat.

### 3. Outdated Dependencies
- **UUID:** Wanted `9.0.1`, Installed `13.0.0` (in lockfile), Latest `13.0.0`. The discrepancy suggests an intended downgrade in `package.json` that was not reflected in the lockfile.
- **React:** The project uses `react@16.14.0`, which is outdated and deprecated. This is likely due to Wix Velo platform constraints, but it poses a long-term maintenance risk.

## Payment, Auth, & AI Security Analysis

### Stripe (Payment Processing)
- **Status:** **Secure (Manual Implementation)**
- **Findings:** The project does **not** use the official `stripe` npm SDK. Instead, it uses direct HTTP calls via `fetch` in `src/backend/stripeService.jsw`.
- **Pros:** Reduces supply chain attack surface by avoiding a large dependency tree.
- **Cons:** Requires manual verification of API versions and security patches.
- **Verification:** `stripeService.jsw` was manually reviewed and found to implement signature verification (HMAC-SHA256) correctly using Node.js `crypto`.

### Twilio (Authentication)
- **Status:** **Secure (Manual Implementation)**
- **Findings:** The project does **not** use the `twilio` npm SDK or the `@velo/wix-members-twilio-otp` package (despite references in documentation). It uses direct `fetch` calls for SMS operations.
- **Verification:** Code search confirms usage of `fetch` for Twilio API interactions.

### AI Clients (OpenAI, Anthropic)
- **Status:** **Secure (Manual Implementation)**
- **Findings:** No official SDKs (`openai`, `@anthropic-ai/sdk`) are installed. The project uses direct `fetch` calls in adapter modules (e.g., `openaiAdapter.js` stubs).
- **Verification:** Reduces risk of malicious packages in the AI supply chain.

## Actionable Recommendations

### Immediate Actions (Must Do)
1.  **Obtain Registry Credentials:** Acquire a valid `.npmrc` configuration with an authentication token for the `@marketpushapps` scope.
2.  **Regenerate Lockfile:**
    ```bash
    rm package-lock.json
    npm install
    ```
    This will fix the synchronization issues, correctly place `@wix/cli` in `devDependencies`, and add `@marketpushapps` packages to the lockfile.
3.  **Run Full Audit:**
    ```bash
    npm audit
    ```
    Once the lockfile is fixed, run this again to scan the previously missing private packages.

### High Priority Fixes (Should Do)
1.  **Fix High Vulnerabilities:**
    - Run `npm audit fix` to automatically upgrade `@wix/cli` and its transitive dependencies (`tar`, `minimatch`) to safe versions.
    - If automatic fixes fail, manually upgrade `@wix/cli` in `package.json` to the latest version.
2.  **Resolve UUID Version:**
    - Decide on version `9.x` or `13.x`.
    - If `9.x` is required for compatibility, ensure `package-lock.json` reflects this after regeneration.

### Long Term (Could Do)
1.  **Dependency Pinning:** Consider pinning exact versions in `package.json` (remove `^`) for critical backend dependencies to prevent unexpected updates.
2.  **Automated Scanning:** Integrate `npm audit` into the CI/CD pipeline (e.g., GitHub Actions) to block builds with High/Critical vulnerabilities.
